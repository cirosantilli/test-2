<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
        Git Version Control Tutorial -
      
      Ciro Santilli
    </title>
    
    <link rel="shortcut icon" type="image/x-icon" href="https://www.gravatar.com/avatar/c979bd881b6755f84947a5a8ecc7c6f7.png" />
    <!-- #jquery. Must come *before* all its many dependencies. -->
      <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <!-- #bootstrap -->
      <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet"/>
      <script src="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <!-- #data table -->
      <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css"/>
      <style>
        table.dataTable tr.odd { background-color: white; }
        table.dataTable tr.even { background-color: white; }
        table.dataTable tr.odd td.sorting_1 { background-color: white; }
        table.dataTable tr.odd td.sorting_2 { background-color: white; }
        table.dataTable tr.odd td.sorting_3 { background-color: white; }
        table.dataTable tr.even td.sorting_1 { background-color: white; }
        table.dataTable tr.even td.sorting_2 { background-color: white; }
        table.dataTable tr.even td.sorting_3 { background-color: white; }
      </style>
    <!-- #font awesome font icons -->
      <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"/>
    <!-- Custom styles and scripts. Come at end to use and override libraries. -->
      <!--<script src="/assets/main.js"></script>-->
      <link rel="stylesheet" href="/assets/main.css"/>
      <link rel="stylesheet" href="/assets/header-link.css"/>
      <link rel="stylesheet" href="/assets/syntax.css"/>
  </head>
  <body>
    <header>
      <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header ">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Ciro Santilli</a>
          </div>
          <div class="collapse navbar-collapse" id="navbar">
            <ul class="nav navbar-nav">
              
              <li >
                <a href="/articles" title="">Articles</a>
              </li>
              
              <li >
                <a href="/projects" title="">Projects</a>
              </li>
              
              <li >
                <a href="/skills" title="">Skills</a>
              </li>
              
              <li >
                <a href="/interests" title="">Interests</a>
              </li>
              
              <li >
                <a href="/education" title="">Education</a>
              </li>
              
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <div class="article-and-sidebar">
      <div class="content">
        <aside>
          <div>
            <a href="/">
              <img style="width:100%;" src="/assets/me.jpg" alt="">
            </a>
          </div>
          <div>
            <a class="nav" href="https://stackoverflow.com/users/895245"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
            <a class="nav" href="https://github.com/cirosantilli"><i class="fa fa-github fa-fw"></i>GitHub</a>
            <a class="nav" href="https://www.linkedin.com/in/cirosantilli"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
            <a class="nav" href="https://www.youtube.com/channel/UCBrJjpKMpdrkA1VsAiR2wEg"><i class="fa fa-youtube fa-fw"></i>YouTube</a>
            <a class="nav" href="https://twitter.com/cirosantilli"><i class="fa fa-twitter fa-fw"></i>Twitter</a>
            
            <a class="nav" href="https://www.zhihu.com/people/cirosantilli/activities"><i class="fa fa-question-circle fa-fw"></i>Zhihu 知乎</a>
            <a class="nav" href="https://www.weibo.com/p/1005055601627311"><i class="fa fa-weibo fa-fw"></i>Weibo 微博</a>
            
            <a class="nav" href="/accounts"><i class="fa fa-ellipsis-h fa-fw"></i>Other accounts</a>
          </div>
          <div>
            
            
            
            
            
            <a class="nav" href="https://github.com/cirosantilli/cirosantilli.github.io/issues/new?title=Git+Version+Control+Tutorial%20-%20">
              <i class="fa fa-exclamation-circle fa-fw"></i>Report Issue
            </a>
          </div>
        </aside>
        <main>
          <h1 class="page-title">Git Version Control Tutorial</h1>
          
          <div id="sharethis">
            <!-- #ShareThis share -->
              <!-- #INVALID HTML5: https://getsatisfaction.com/sharethis/topics/attribute_displaytext_is_not_valid_xhtml -->
              <div class='st_twitter_hcount desktop' displayText='Tweet'></div>
              <div class='st_facebook_hcount desktop' displayText='Facebook'></div>
              <div class='st_googleplus_hcount desktop' displayText='Google +'></div>
              <div class='st_linkedin_hcount desktop' displayText='LinkedIn'></div>
              <div class='st_twitter_large mobile' displayText='Tweet'></div>
              <div class='st_facebook_large mobile' displayText='Facebook'></div>
              <div class='st_googleplus_large mobile' displayText='Google +'></div>
              <div class='st_linkedin_large mobile' displayText='LinkedIn'></div>
              <!--<span class='st_linkedin_hcount' displayText='LinkedIn'></span>-->
              <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
              <script type="text/javascript">stLight.options({publisher: "b6a81f16-5bb1-46de-83c8-6b4c3e94ec99", doNotHash:false, doNotCopy:true, hashAddressBar:false});</script>
          </div>
          
          
          <ol id="markdown-toc">
  <li><a href="#why-learn-git" id="markdown-toc-why-learn-git">Why learn Git</a></li>
  <li><a href="#how-to-learn-git" id="markdown-toc-how-to-learn-git">How to learn Git</a></li>
  <li><a href="#base-concepts" id="markdown-toc-base-concepts">Base concepts</a>    <ol>
      <li><a href="#repository" id="markdown-toc-repository">Repository</a></li>
      <li><a href="#three-trees" id="markdown-toc-three-trees">Three trees</a></li>
    </ol>
  </li>
  <li><a href="#setup" id="markdown-toc-setup">Setup</a></li>
  <li><a href="#init" id="markdown-toc-init">init</a></li>
  <li><a href="#create-version" id="markdown-toc-create-version">Create version</a></li>
  <li><a href="#status" id="markdown-toc-status">status</a></li>
  <li><a href="#working-tree" id="markdown-toc-working-tree">Working tree</a></li>
  <li><a href="#index" id="markdown-toc-index">Index</a>    <ol>
      <li><a href="#index-internals" id="markdown-toc-index-internals">Index internals</a></li>
      <li><a href="#checkout-index" id="markdown-toc-checkout-index">checkout-index</a></li>
      <li><a href="#update-index" id="markdown-toc-update-index">update-index</a></li>
      <li><a href="#read-tree" id="markdown-toc-read-tree">read-tree</a></li>
      <li><a href="#write-tree" id="markdown-toc-write-tree">write-tree</a></li>
    </ol>
  </li>
  <li><a href="#staged" id="markdown-toc-staged">Staged</a></li>
  <li><a href="#ls-files" id="markdown-toc-ls-files">ls-files</a></li>
  <li><a href="#binary-files" id="markdown-toc-binary-files">Binary files</a>    <ol>
      <li><a href="#how-git-determines-if-a-file-is-binary" id="markdown-toc-how-git-determines-if-a-file-is-binary">How Git determines if a file is binary</a></li>
      <li><a href="#list-all-text-files" id="markdown-toc-list-all-text-files">List all text files</a></li>
      <li><a href="#check-if-a-file-is-binary" id="markdown-toc-check-if-a-file-is-binary">Check if a file is binary</a></li>
      <li><a href="#force-file-to-be-treated-as-binary" id="markdown-toc-force-file-to-be-treated-as-binary">Force file to be treated as binary</a></li>
      <li><a href="#force-file-to-be-treated-as-text" id="markdown-toc-force-file-to-be-treated-as-text">Force file to be treated as text</a></li>
      <li><a href="#diff-for-binary-files" id="markdown-toc-diff-for-binary-files">Diff for binary files</a></li>
      <li><a href="#u" id="markdown-toc-u">U</a></li>
      <li><a href="#inter-hunk-context" id="markdown-toc-inter-hunk-context">inter-hunk-context</a></li>
      <li><a href="#hunk" id="markdown-toc-hunk">Hunk</a></li>
    </ol>
  </li>
  <li><a href="#blame" id="markdown-toc-blame">blame</a></li>
  <li><a href="#gitignore" id="markdown-toc-gitignore">gitignore</a>    <ol>
      <li><a href="#syntax" id="markdown-toc-syntax">syntax</a></li>
      <li><a href="#local-gitignore" id="markdown-toc-local-gitignore">local gitignore</a></li>
    </ol>
  </li>
  <li><a href="#gitfile" id="markdown-toc-gitfile">gitfile</a></li>
  <li><a href="#mailmap" id="markdown-toc-mailmap">mailmap</a></li>
  <li><a href="#add" id="markdown-toc-add">add</a>    <ol>
      <li><a href="#example-add" id="markdown-toc-example-add">Example: add</a></li>
      <li><a href="#add-and-gitignore" id="markdown-toc-add-and-gitignore">add and gitignore</a></li>
    </ol>
  </li>
  <li><a href="#rm" id="markdown-toc-rm">rm</a>    <ol>
      <li><a href="#example-rm" id="markdown-toc-example-rm">Example: rm</a></li>
      <li><a href="#rm-cached" id="markdown-toc-rm-cached">rm –cached</a></li>
      <li><a href="#rm--f" id="markdown-toc-rm--f">rm -f</a></li>
      <li><a href="#rm--r" id="markdown-toc-rm--r">rm -r</a></li>
    </ol>
  </li>
  <li><a href="#remove-file-from-repo-history" id="markdown-toc-remove-file-from-repo-history">Remove file from repo history</a></li>
  <li><a href="#clean" id="markdown-toc-clean">clean</a></li>
  <li><a href="#mv" id="markdown-toc-mv">mv</a></li>
  <li><a href="#reset" id="markdown-toc-reset">reset</a>    <ol>
      <li><a href="#hard-vs-soft" id="markdown-toc-hard-vs-soft">hard vs soft</a></li>
      <li><a href="#change-what-a-branch-points-to" id="markdown-toc-change-what-a-branch-points-to">change what a branch points to</a>        <ol>
          <li><a href="#dangling-commit" id="markdown-toc-dangling-commit">Dangling commit</a></li>
          <li><a href="#delete-last-commit-from-history" id="markdown-toc-delete-last-commit-from-history">Delete last commit from history</a></li>
        </ol>
      </li>
      <li><a href="#undo-a-reset-hard" id="markdown-toc-undo-a-reset-hard">Undo a reset hard</a></li>
      <li><a href="#remove-all-dangling-commits-permanently" id="markdown-toc-remove-all-dangling-commits-permanently">Remove all dangling commits permanently</a></li>
    </ol>
  </li>
  <li><a href="#reflog" id="markdown-toc-reflog">reflog</a></li>
  <li><a href="#fsck" id="markdown-toc-fsck">fsck</a></li>
  <li><a href="#revert" id="markdown-toc-revert">revert</a></li>
  <li><a href="#commit" id="markdown-toc-commit">commit</a>    <ol>
      <li><a href="#commit-message" id="markdown-toc-commit-message">Commit message</a></li>
      <li><a href="#amend" id="markdown-toc-amend">amend</a></li>
      <li><a href="#author" id="markdown-toc-author">author</a></li>
      <li><a href="#committer-change" id="markdown-toc-committer-change">Committer change</a></li>
      <li><a href="#date" id="markdown-toc-date">date</a></li>
      <li><a href="#commit-all-tracked-files" id="markdown-toc-commit-all-tracked-files">Commit all tracked files</a></li>
      <li><a href="#allow-empty" id="markdown-toc-allow-empty">allow-empty</a></li>
    </ol>
  </li>
  <li><a href="#shortlog" id="markdown-toc-shortlog">shortlog</a></li>
  <li><a href="#describe" id="markdown-toc-describe">describe</a></li>
  <li><a href="#show" id="markdown-toc-show">show</a>    <ol>
      <li><a href="#view-files-at-specific-version" id="markdown-toc-view-files-at-specific-version">View files at specific version</a></li>
    </ol>
  </li>
  <li><a href="#notes" id="markdown-toc-notes">notes</a></li>
  <li><a href="#gitk" id="markdown-toc-gitk">gitk</a>    <ol>
      <li><a href="#diff-index" id="markdown-toc-diff-index">diff-index</a></li>
      <li><a href="#diff-tree" id="markdown-toc-diff-tree">diff-tree</a></li>
      <li><a href="#diff-files" id="markdown-toc-diff-files">diff-files</a></li>
      <li><a href="#raw-diff-format" id="markdown-toc-raw-diff-format">raw diff format</a></li>
    </ol>
  </li>
  <li><a href="#revision" id="markdown-toc-revision">Revision</a>    <ol>
      <li><a href="#how-to-name-revisions" id="markdown-toc-how-to-name-revisions">How to name revisions</a>        <ol>
          <li><a href="#sha-1" id="markdown-toc-sha-1">SHA-1</a></li>
          <li><a href="#hash" id="markdown-toc-hash">Hash</a></li>
          <li><a href="#reference" id="markdown-toc-reference">Reference</a></li>
          <li><a href="#refs" id="markdown-toc-refs">Refs</a>            <ol>
              <li><a href="#head" id="markdown-toc-head">HEAD</a>                <ol>
                  <li><a href="#example-head" id="markdown-toc-example-head">Example: HEAD</a></li>
                </ol>
              </li>
              <li><a href="#orig_head" id="markdown-toc-orig_head">ORIG_HEAD</a></li>
            </ol>
          </li>
          <li><a href="#show-ref" id="markdown-toc-show-ref">show-ref</a></li>
          <li><a href="#update-ref" id="markdown-toc-update-ref">update-ref</a></li>
          <li><a href="#relative-to-another-revision" id="markdown-toc-relative-to-another-revision">Relative to another revision</a></li>
        </ol>
      </li>
      <li><a href="#name-rev" id="markdown-toc-name-rev">name-rev</a></li>
      <li><a href="#symbolic-ref" id="markdown-toc-symbolic-ref">symbolic-ref</a></li>
      <li><a href="#commit-ish" id="markdown-toc-commit-ish">commit-ish</a></li>
      <li><a href="#tree-ish" id="markdown-toc-tree-ish">tree-ish</a></li>
      <li><a href="#rev" id="markdown-toc-rev">rev</a></li>
    </ol>
  </li>
  <li><a href="#difftool" id="markdown-toc-difftool">difftool</a></li>
  <li><a href="#tag" id="markdown-toc-tag">tag</a>    <ol>
      <li><a href="#annotated-tag" id="markdown-toc-annotated-tag">Annotated tag</a>        <ol>
          <li><a href="#create-an-annotated-tag" id="markdown-toc-create-an-annotated-tag">Create an annotated tag</a></li>
        </ol>
      </li>
      <li><a href="#list-tags" id="markdown-toc-list-tags">List tags</a>        <ol>
          <li><a href="#list-tags-that-contain-a-given-commit" id="markdown-toc-list-tags-that-contain-a-given-commit">List tags that contain a given commit</a></li>
          <li><a href="#list-only-annotated-tags" id="markdown-toc-list-only-annotated-tags">List only annotated tags</a></li>
          <li><a href="#list-only-lightweight-tags" id="markdown-toc-list-only-lightweight-tags">List only lightweight tags</a></li>
          <li><a href="#sort-the-tag-listing" id="markdown-toc-sort-the-tag-listing">Sort the tag listing</a></li>
        </ol>
      </li>
      <li><a href="#create-tags" id="markdown-toc-create-tags">Create tags</a></li>
      <li><a href="#get-tag-info" id="markdown-toc-get-tag-info">Get tag info</a></li>
      <li><a href="#edit-tag" id="markdown-toc-edit-tag">Edit tag</a></li>
      <li><a href="#delete-tags" id="markdown-toc-delete-tags">Delete tags</a></li>
      <li><a href="#push-tags-to-remote" id="markdown-toc-push-tags-to-remote">Push tags to remote</a></li>
      <li><a href="#get-tags-from-remote" id="markdown-toc-get-tags-from-remote">Get tags from remote</a></li>
      <li><a href="#describe-1" id="markdown-toc-describe-1">describe</a></li>
    </ol>
  </li>
  <li><a href="#branch" id="markdown-toc-branch">branch</a>    <ol>
      <li><a href="#master" id="markdown-toc-master">master</a></li>
      <li><a href="#list-branches" id="markdown-toc-list-branches">List branches</a></li>
      <li><a href="#create-a-branch" id="markdown-toc-create-a-branch">Create a branch</a></li>
      <li><a href="#what-happens-when-you-create-a-branch" id="markdown-toc-what-happens-when-you-create-a-branch">What happens when you create a branch</a></li>
      <li><a href="#what-happens-to-a-branch-when-you-commit" id="markdown-toc-what-happens-to-a-branch-when-you-commit">What happens to a branch when you commit</a></li>
      <li><a href="#detached-head" id="markdown-toc-detached-head">Detached head</a>        <ol>
          <li><a href="#what-should-i-do-if-i-want-to-branch-from-the-detached-head" id="markdown-toc-what-should-i-do-if-i-want-to-branch-from-the-detached-head">What should I do if I want to branch from the detached head</a></li>
          <li><a href="#what-happens-if-i-commit-on-a-detached-head" id="markdown-toc-what-happens-if-i-commit-on-a-detached-head">What happens if I commit on a detached head</a>            <ol>
              <li><a href="#what-if-i-commit-and-checkout" id="markdown-toc-what-if-i-commit-and-checkout">What if I commit and checkout</a></li>
            </ol>
          </li>
        </ol>
      </li>
      <li><a href="#set-branch-commit" id="markdown-toc-set-branch-commit">Set branch commit</a></li>
      <li><a href="#slash-in-branch-name" id="markdown-toc-slash-in-branch-name">Slash in branch name</a></li>
      <li><a href="#rename-branch" id="markdown-toc-rename-branch">Rename branch</a></li>
      <li><a href="#branch-without-parent" id="markdown-toc-branch-without-parent">Branch without parent</a></li>
    </ol>
  </li>
  <li><a href="#check-ref-format" id="markdown-toc-check-ref-format">check-ref-format</a></li>
  <li><a href="#checkout" id="markdown-toc-checkout">checkout</a>    <ol>
      <li><a href="#entire-repo" id="markdown-toc-entire-repo">Entire repo</a></li>
      <li><a href="#to-previous-branch" id="markdown-toc-to-previous-branch">To previous branch</a>        <ol>
          <li><a href="#example-checkout-entire-repo" id="markdown-toc-example-checkout-entire-repo">Example: checkout entire repo</a></li>
          <li><a href="#untracked-files" id="markdown-toc-untracked-files">Untracked files</a></li>
          <li><a href="#uncommitted-changes" id="markdown-toc-uncommitted-changes">Uncommitted changes</a>            <ol>
              <li><a href="#checkout-uncommitted-modification" id="markdown-toc-checkout-uncommitted-modification">Checkout uncommitted modification</a></li>
              <li><a href="#checkout-file-overwrite" id="markdown-toc-checkout-file-overwrite">Checkout file overwrite</a></li>
            </ol>
          </li>
        </ol>
      </li>
      <li><a href="#single-file-or-dir" id="markdown-toc-single-file-or-dir">Single file or dir</a>        <ol>
          <li><a href="#checkout-single-file" id="markdown-toc-checkout-single-file">Checkout single file</a></li>
          <li><a href="#checkout-single-removed-file" id="markdown-toc-checkout-single-removed-file">Checkout single removed file</a></li>
          <li><a href="#checkout-after-remove" id="markdown-toc-checkout-after-remove">Checkout after remove</a></li>
          <li><a href="#uncommitted-changes-1" id="markdown-toc-uncommitted-changes-1">Uncommitted changes</a></li>
          <li><a href="#example-checkout-single-file-with-modifications" id="markdown-toc-example-checkout-single-file-with-modifications">Example: checkout single file with modifications</a></li>
        </ol>
      </li>
      <li><a href="#theirs" id="markdown-toc-theirs">theirs</a></li>
      <li><a href="#ours" id="markdown-toc-ours">ours</a>        <ol>
          <li><a href="#theirs-vs-ours-in-rebase-vs-merge" id="markdown-toc-theirs-vs-ours-in-rebase-vs-merge">theirs vs ours in rebase vs merge</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#bisect" id="markdown-toc-bisect">bisect</a></li>
  <li><a href="#bisect-run" id="markdown-toc-bisect-run">bisect run</a></li>
  <li><a href="#stash" id="markdown-toc-stash">stash</a></li>
  <li><a href="#for-each-ref" id="markdown-toc-for-each-ref">for-each-ref</a></li>
  <li><a href="#merge" id="markdown-toc-merge">merge</a>    <ol>
      <li><a href="#merge-strategies" id="markdown-toc-merge-strategies">Merge strategies</a>        <ol>
          <li><a href="#recursive-merge-strategy" id="markdown-toc-recursive-merge-strategy">Recursive merge strategy</a></li>
        </ol>
      </li>
      <li><a href="#conflicts" id="markdown-toc-conflicts">Conflicts</a></li>
      <li><a href="#merge-conflicts" id="markdown-toc-merge-conflicts">Merge conflicts</a>        <ol>
          <li><a href="#text-conflicts" id="markdown-toc-text-conflicts">Text conflicts</a>            <ol>
              <li><a href="#techniques-to-solve-text-conflicts" id="markdown-toc-techniques-to-solve-text-conflicts">Techniques to solve text conflicts</a></li>
            </ol>
          </li>
          <li><a href="#binary-conflicts" id="markdown-toc-binary-conflicts">Binary conflicts</a></li>
          <li><a href="#permission-conflicts" id="markdown-toc-permission-conflicts">Permission conflicts</a>            <ol>
              <li><a href="#directory-file-conflict" id="markdown-toc-directory-file-conflict">Directory file conflict</a></li>
              <li><a href="#symlink-file-conflict" id="markdown-toc-symlink-file-conflict">Symlink file conflict</a></li>
            </ol>
          </li>
        </ol>
      </li>
      <li><a href="#merge-target-branch" id="markdown-toc-merge-target-branch">Merge target branch</a></li>
      <li><a href="#ignore-certain-files-on-merge" id="markdown-toc-ignore-certain-files-on-merge">Ignore certain files on merge</a></li>
      <li><a href="#squash" id="markdown-toc-squash">squash</a></li>
      <li><a href="#programmatically-check-if-mergeable" id="markdown-toc-programmatically-check-if-mergeable">Programmatically check if mergeable</a></li>
      <li><a href="#resolve-merge-conflicts" id="markdown-toc-resolve-merge-conflicts">Resolve merge conflicts</a></li>
    </ol>
  </li>
  <li><a href="#merge-file" id="markdown-toc-merge-file">merge-file</a></li>
  <li><a href="#merge-base" id="markdown-toc-merge-base">merge-base</a></li>
  <li><a href="#mergetool" id="markdown-toc-mergetool">mergetool</a>    <ol>
      <li><a href="#prompt" id="markdown-toc-prompt">prompt</a></li>
      <li><a href="#keepbackup" id="markdown-toc-keepbackup">keepBackup</a></li>
    </ol>
  </li>
  <li><a href="#email-patches" id="markdown-toc-email-patches">Email patches</a>    <ol>
      <li><a href="#am" id="markdown-toc-am">am</a></li>
    </ol>
  </li>
  <li><a href="#archive" id="markdown-toc-archive">archive</a></li>
  <li><a href="#ls-remote" id="markdown-toc-ls-remote">ls-remote</a></li>
  <li><a href="#protocols" id="markdown-toc-protocols">Protocols</a>    <ol>
      <li><a href="#sources" id="markdown-toc-sources">Sources</a></li>
      <li><a href="#update-server-info" id="markdown-toc-update-server-info">update-server-info</a></li>
    </ol>
  </li>
  <li><a href="#http" id="markdown-toc-http">HTTP</a>    <ol>
      <li><a href="#dumb-http" id="markdown-toc-dumb-http">Dumb HTTP</a></li>
      <li><a href="#smart-http" id="markdown-toc-smart-http">Smart HTTP</a>        <ol>
          <li><a href="#http-backend" id="markdown-toc-http-backend">http-backend</a></li>
          <li><a href="#grack" id="markdown-toc-grack">Grack</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#ssh-protocol" id="markdown-toc-ssh-protocol">SSH protocol</a>    <ol>
      <li><a href="#git-shell-login-shell" id="markdown-toc-git-shell-login-shell">git-shell login shell</a></li>
      <li><a href="#authorized_keys-command-option" id="markdown-toc-authorized_keys-command-option">authorized_keys command` option</a></li>
    </ol>
  </li>
  <li><a href="#git-protocol" id="markdown-toc-git-protocol">Git protocol</a>    <ol>
      <li><a href="#git-daemon" id="markdown-toc-git-daemon">git daemon</a></li>
    </ol>
  </li>
  <li><a href="#authentication" id="markdown-toc-authentication">Authentication</a>    <ol>
      <li><a href="#credential" id="markdown-toc-credential">credential</a></li>
      <li><a href="#cache" id="markdown-toc-cache">cache</a></li>
      <li><a href="#credential-cache" id="markdown-toc-credential-cache">credential-cache</a></li>
      <li><a href="#store" id="markdown-toc-store">store</a></li>
      <li><a href="#credential-store" id="markdown-toc-credential-store">credential-store</a></li>
      <li><a href="#send-pack" id="markdown-toc-send-pack">send-pack</a></li>
      <li><a href="#fetch-pack" id="markdown-toc-fetch-pack">fetch-pack</a></li>
      <li><a href="#receive-pack" id="markdown-toc-receive-pack">receive-pack</a></li>
      <li><a href="#upload-pack" id="markdown-toc-upload-pack">upload-pack</a></li>
    </ol>
  </li>
  <li><a href="#bare" id="markdown-toc-bare">bare</a>    <ol>
      <li><a href="#current-branch" id="markdown-toc-current-branch">Current branch</a></li>
    </ol>
  </li>
  <li><a href="#pull" id="markdown-toc-pull">pull</a>    <ol>
      <li><a href="#basic-usage" id="markdown-toc-basic-usage">Basic usage</a></li>
    </ol>
  </li>
  <li><a href="#permissions" id="markdown-toc-permissions">Permissions</a></li>
  <li><a href="#file-permissions" id="markdown-toc-file-permissions">File permissions</a>    <ol>
      <li><a href="#symlinks" id="markdown-toc-symlinks">Symlinks</a></li>
    </ol>
  </li>
  <li><a href="#empty-directories" id="markdown-toc-empty-directories">Empty directories</a></li>
  <li><a href="#replace" id="markdown-toc-replace">replace</a></li>
  <li><a href="#filter-branch" id="markdown-toc-filter-branch">filter-branch</a>    <ol>
      <li><a href="#committer-vs-author" id="markdown-toc-committer-vs-author">Committer vs author</a></li>
    </ol>
  </li>
  <li><a href="#rerere" id="markdown-toc-rerere">rerere</a></li>
  <li><a href="#hooks" id="markdown-toc-hooks">hooks</a>    <ol>
      <li><a href="#path-gotcha" id="markdown-toc-path-gotcha">PATH gotcha</a></li>
      <li><a href="#pre-receive" id="markdown-toc-pre-receive">pre-receive</a></li>
    </ol>
  </li>
  <li><a href="#rev-parse" id="markdown-toc-rev-parse">rev-parse</a></li>
  <li><a href="#rev-list" id="markdown-toc-rev-list">rev-list</a>    <ol>
      <li><a href="#list-all-objects" id="markdown-toc-list-all-objects">List all objects</a></li>
    </ol>
  </li>
  <li><a href="#var" id="markdown-toc-var">var</a></li>
  <li><a href="#gitattributes" id="markdown-toc-gitattributes">gitattributes</a></li>
  <li><a href="#gc" id="markdown-toc-gc">gc</a></li>
  <li><a href="#plumbing" id="markdown-toc-plumbing">Plumbing</a></li>
  <li><a href="#porcelain" id="markdown-toc-porcelain">Porcelain</a></li>
  <li><a href="#git-options" id="markdown-toc-git-options">git options</a></li>
  <li><a href="#contrib" id="markdown-toc-contrib">contrib</a>    <ol>
      <li><a href="#subtree" id="markdown-toc-subtree">subtree</a></li>
      <li><a href="#diff-highlight" id="markdown-toc-diff-highlight">diff-highlight</a></li>
    </ol>
  </li>
  <li><a href="#third-party-tools" id="markdown-toc-third-party-tools">Third party tools</a>    <ol>
      <li><a href="#tig" id="markdown-toc-tig">tig</a>        <ol>
          <li><a href="#views" id="markdown-toc-views">Views</a></li>
          <li><a href="#generic" id="markdown-toc-generic">Generic</a></li>
          <li><a href="#refs-tig" id="markdown-toc-refs-tig">Refs tig</a></li>
          <li><a href="#blob" id="markdown-toc-blob">Blob</a></li>
        </ol>
      </li>
      <li><a href="#fugitive" id="markdown-toc-fugitive">fugitive</a></li>
      <li><a href="#fame" id="markdown-toc-fame">fame</a></li>
      <li><a href="#browse-remote" id="markdown-toc-browse-remote">browse remote</a></li>
      <li><a href="#git-cache-meta" id="markdown-toc-git-cache-meta">git-cache-meta</a></li>
    </ol>
  </li>
  <li><a href="#implementations" id="markdown-toc-implementations">Implementations</a>    <ol>
      <li><a href="#libgit2" id="markdown-toc-libgit2">libgit2</a></li>
      <li><a href="#jgit" id="markdown-toc-jgit">JGit</a></li>
    </ol>
  </li>
  <li><a href="#test-repos" id="markdown-toc-test-repos">Test repos</a>    <ol>
      <li><a href="#0" id="markdown-toc-0">0</a></li>
      <li><a href="#0du" id="markdown-toc-0du">0du</a></li>
      <li><a href="#1" id="markdown-toc-1">1</a></li>
      <li><a href="#1d" id="markdown-toc-1d">1d</a></li>
      <li><a href="#1u" id="markdown-toc-1u">1u</a></li>
      <li><a href="#1ub" id="markdown-toc-1ub">1ub</a></li>
      <li><a href="#2" id="markdown-toc-2">2</a></li>
      <li><a href="#2u" id="markdown-toc-2u">2u</a></li>
      <li><a href="#2b" id="markdown-toc-2b">2b</a></li>
      <li><a href="#3" id="markdown-toc-3">3</a></li>
      <li><a href="#0bare" id="markdown-toc-0bare">0bare</a></li>
      <li><a href="#multi" id="markdown-toc-multi">multi</a></li>
      <li><a href="#multiu" id="markdown-toc-multiu">multiu</a></li>
      <li><a href="#min-sane" id="markdown-toc-min-sane">min-sane</a></li>
    </ol>
  </li>
</ol>

<p>New multi-file organization being built:</p>

<ol>
  <li>Basic commands
    <ol>
      <li><a href="diff">diff</a></li>
      <li><a href="grep">grep</a></li>
      <li><a href="log">log</a></li>
      <li>Working with remotes
        <ol>
          <li><a href="clone">clone</a></li>
          <li><a href="push">push</a></li>
          <li><a href="fetch">fetch</a></li>
          <li><a href="remote">remote</a></li>
        </ol>
      </li>
      <li><a href="config">config</a></li>
      <li><a href="rebase">rebase</a></li>
    </ol>
  </li>
  <li>Less basic
    <ol>
      <li><a href="submodule.md">Submodule</a></li>
    </ol>
  </li>
  <li>Email patches
    <ol>
      <li><a href="format-patch">format-patch</a></li>
    </ol>
  </li>
  <li><a href="internals">Internals</a>
    <ol>
      <li><a href="packfiles">Packfiles</a></li>
    </ol>
  </li>
  <li>Git source code
    <ol>
      <li><a href="build">Build</a></li>
    </ol>
  </li>
  <li>Web interfaces
    <ol>
      <li><a href="github">GitHub</a></li>
      <li><a href="gerrit">Gerrit</a></li>
    </ol>
  </li>
  <li>Other version control systems
    <ol>
      <li><a href="svn">svn</a></li>
      <li><a href="hg">hg</a></li>
      <li><a href="cvs">cvs</a></li>
    </ol>
  </li>
</ol>

<h2 id="why-learn-git">Why learn Git</h2>

<p>Git + GitHub allows you to do the following quickly:</p>

<ul>
  <li>
    <p>create multiple versions (<em>commits</em> or <em>revisions</em> in Git jargon) of your work, and travel between them.</p>

    <p>This is useful for:</p>

    <ul>
      <li>
        <p>backup. If you delete a file by mistake, and the file was present in some past version, you can recover it.</p>
      </li>
      <li>
        <p>if a recent modification made a change that made things worse, you can just go back to a previous correct state and see what happened.</p>
      </li>
      <li>
        <p>refer to a specific version.</p>

        <p>Say you are writting a book, and you made a session called “motivation”.</p>

        <p>Other people liked it, and said, look at the motivation section!</p>

        <p>But one day, you decide that the motivation section should be called “advantages” instead.</p>

        <p>But then this breakes the references of other people…</p>

        <p>But not if the other person said: look at the “motivation” section of <strong>version</strong> XXX!</p>
      </li>
      <li>
        <p>you are working on a feature, when something more urgent comes up.</p>

        <p>The current state may not be stable, and may interfere with the more urgent state.</p>

        <p>No problem, make a version of your current work to save it, and switch to the more urgent matter.</p>

        <p>When you are done, just switch back.</p>
      </li>
      <li>
        <p>View differences between versions.</p>

        <p>It is easy to <a href="#differences">view <em>differences</em> between versions</a> to find out what was different on a different version</p>

        <p>This is useful when:</p>

        <ul>
          <li>
            <p>why was my program working then, but stopped working?</p>
          </li>
          <li>
            <p>what changes exactly did someone else made to my files and wants me to accept?</p>
          </li>
        </ul>
      </li>
    </ul>

    <p>There are many commands that deal with versions, but you should first learn:</p>

    <ul>
      <li><code class="highlighter-rouge">git add</code>, <code class="highlighter-rouge">git rm</code> and <code class="highlighter-rouge">git mv</code> decide which files to include on the next version</li>
      <li><code class="highlighter-rouge">git commit</code> creates versions</li>
      <li><code class="highlighter-rouge">git checkout</code> moves between versions</li>
      <li><code class="highlighter-rouge">git branch</code> deals with version names</li>
    </ul>
  </li>
  <li>
    <p>Upload your work to a server to:</p>

    <ul>
      <li>back it up</li>
      <li>publish it</li>
    </ul>

    <p>The main command to do those things is <code class="highlighter-rouge">git push</code>.</p>
  </li>
  <li>
    <p>Download something someone else made public. <code class="highlighter-rouge">git clone</code> is the way to go.</p>
  </li>
  <li>
    <p>Work in groups.</p>

    <p>Because of all its capacities, git is widely used in group projects. It was <em>created</em> for the Linux kernel.</p>

    <p>This means that:</p>

    <ul>
      <li>
        <p>you can make a very large project that need many people to work on the same code.</p>
      </li>
      <li>
        <p>you can learn from others.</p>
      </li>
      <li>
        <p>if you make a good work, you will get more famous, and will have better jobs.</p>
      </li>
    </ul>

    <p>For open source, this also means that:</p>

    <ul>
      <li>you can make modifications that you need to the program you use.</li>
    </ul>
  </li>
</ul>

<h2 id="how-to-learn-git">How to learn Git</h2>

<p>Git is hard to learn at first because</p>

<ul>
  <li>
    <p>it has inner state that is not obvious at first to visualize.</p>
  </li>
  <li>
    <p>concepts depend on one another egg and chicken style.</p>
  </li>
</ul>

<p>To learn it:</p>

<ul>
  <li>
    <p>make a bunch of standard test repos, copy them out, and <em>test away</em>.</p>

    <p>Use the standard repos generated in [test repos]</p>
  </li>
  <li>
    <p>visualize <em>everything</em> the commit tree whenever you don’t know what is going on.</p>

    <p>Once you see the tree, and how to modify it, everything falls into place!</p>
  </li>
</ul>

<h2 id="base-concepts">Base concepts</h2>

<h3 id="repository">Repository</h3>

<p>Git works inside the directories you tell it to work.</p>

<p>Those directories are called <em>repositories</em>, <em>repo</em> for short.</p>

<p>The only thing that makes a directory in to a repository is the presence of a <code class="highlighter-rouge">.git</code> folder with the correct files in it, which contains most of the <code class="highlighter-rouge">.git</code> data. Some more may be contained in config files outside <code class="highlighter-rouge">.git</code> like <code class="highlighter-rouge">.gititnore</code>.</p>

<p>To create a new repo, use <code class="highlighter-rouge">init</code>.</p>

<p>To copy an existing repo, use <code class="highlighter-rouge">clone</code>. No need to <code class="highlighter-rouge">git init</code> it after you clone it.</p>

<p>To transform a repo into a non repo, simply remove the <code class="highlighter-rouge">.git</code> dir (and maybe other files like <code class="highlighter-rouge">.gitignore</code>).</p>

<h3 id="three-trees">Three trees</h3>

<p>This is a confusing point for beginners, but it is a good design choice by Git, so understand it now and save lots of trouble later.</p>

<p>The three trees are:</p>

<ul>
  <li>working tree: regular files outside <code class="highlighter-rouge">.git</code>. Those files may not be tracked by Git.</li>
  <li>index: things that have been selected to be added to the next revision. Internally, not represented as a tree object.</li>
  <li><code class="highlighter-rouge">HEAD</code>: the last version. Internally, a tree object.</li>
</ul>

<p>Transitions:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+--------------+  +--------------+  +------+
| working tree |  | staging area |  | HEAD |
|--------------+  |--------------+  |------+
|                 |                 |
|                 |                 |
| -- add -------&gt; | -- commit ----&gt; |
|                 |                 |
|                 |                 |
| &lt;- reset ------ | &lt;- reset ------ |
</code></pre></div></div>

<h2 id="setup">Setup</h2>

<p>Before anything else install Git.</p>

<p>On on Ubuntu 12.04 do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get insatll git
</code></pre></div></div>

<p>Next configure git:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global user.name "Ciro Santilli"
git config --global user.email "ciro@mail.com"
</code></pre></div></div>

<p>You will also want to install a local GUI git viewer:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get insatll gitk
</code></pre></div></div>

<p>It makes it easier to see the version tree.</p>

<h2 id="init">init</h2>

<p>Create an empty git repository inside the current directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git init
</code></pre></div></div>

<p>This creates a <code class="highlighter-rouge">.git</code> dir that contains all the git information.</p>

<h2 id="create-version">Create version</h2>

<p>Most of git operations are based on versions, so you’d better know how to create them!</p>

<p>To create a version you need to:</p>

<ul>
  <li>decide what files will be included in the version with <code class="highlighter-rouge">add</code>, <code class="highlighter-rouge">rm</code>, <code class="highlighter-rouge">mv</code>, and many others.</li>
  <li>create the version with <code class="highlighter-rouge">commit</code></li>
</ul>

<p>You can see what would be included in the next version with <code class="highlighter-rouge">status</code></p>

<h2 id="status">status</h2>

<p>Lists:</p>

<ul>
  <li>differences between working tree and index, including files not present in the index</li>
  <li>differences between index and <code class="highlighter-rouge">HEAD</code></li>
</ul>

<p>Entire repository:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git status
</code></pre></div></div>

<p>Only in a given directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git status .
</code></pre></div></div>

<p>You can change what would be added with commands like <code class="highlighter-rouge">add</code>, <code class="highlighter-rouge">rm</code> or <code class="highlighter-rouge">reset</code></p>

<p>There are 3 most common possible sections:</p>

<ul>
  <li><code class="highlighter-rouge">Untracked files</code>: files which have never been added in any version.</li>
  <li><code class="highlighter-rouge">Changes not staged for commit</code>: files which have changed but will not be considered.</li>
  <li><code class="highlighter-rouge">Changes to be committed</code>: files which which have changed and will be considered</li>
</ul>

<p>Other sections also exist:</p>

<ul>
  <li><code class="highlighter-rouge">Unmerged paths</code>: while on a merge conflict resolution. You must first add those files and then <code class="highlighter-rouge">git rebase --continue</code>.</li>
</ul>

<p>And if nothing changes, it says so.</p>

<p>Check out the <code class="highlighter-rouge">add</code>, <code class="highlighter-rouge">rm</code> and <code class="highlighter-rouge">reset</code> commands to see how it behaves.</p>

<h2 id="working-tree">Working tree</h2>

<p>Is all the “regular” files that lie outside the <code class="highlighter-rouge">.git</code> directory.</p>

<h2 id="index">Index</h2>

<p>A temporary place where you can build the next commit little by little.</p>

<p>Its existence allows you for example to do several <code class="highlighter-rouge">git add</code> separately, edit some more, and only later create a new version. For this to work, operations like <code class="highlighter-rouge">git add</code> must store the files somewhere: this place is the index.</p>

<p>Usually modified with the following commands:</p>

<ul>
  <li><code class="highlighter-rouge">add</code>: add file so index. Don’t touch working tree.</li>
  <li><code class="highlighter-rouge">rm</code>, <code class="highlighter-rouge">mv</code>: remove and rename from both index and working tree.</li>
  <li><code class="highlighter-rouge">reset</code>: set the index to the same as last commit, therefore undoing operations like <code class="highlighter-rouge">git add</code>.</li>
  <li><code class="highlighter-rouge">checkout ref</code>: sets the index to the tree of the ref, therefore radically modifying it.</li>
</ul>

<p>The index is stored internally by Git in the <code class="highlighter-rouge">.git</code> directory. Therefore, after you <code class="highlighter-rouge">git add</code> a file for example, you can remove it from the working tree but you won’t lose any data.</p>

<h3 id="index-internals">Index internals</h3>

<p>See: <a href="http://stackoverflow.com/questions/4084921/what-does-the-git-index-exactly-contain">http://stackoverflow.com/questions/4084921/what-does-the-git-index-exactly-contain</a></p>

<h3 id="checkout-index">checkout-index</h3>

<p>Add files from the index to the working tree.</p>

<p>Plumbing.</p>

<h3 id="update-index">update-index</h3>

<p>Add files from working tree to index.</p>

<p>Plumbing.</p>

<h3 id="read-tree">read-tree</h3>

<p>Read given tree object into the index.</p>

<p>Plumbing.</p>

<h3 id="write-tree">write-tree</h3>

<p>Create a tree object form the index.</p>

<p>Plumbing.</p>

<h2 id="staged">Staged</h2>

<p>When a file on the working tree is added to the index, its changes are said to be <em>staged</em>.</p>

<p>By analogy, if you modify the working tree and don’t add it to the index,
the changes are said to be <em>unstaged</em>.</p>

<h2 id="ls-files">ls-files</h2>

<p>List files in the index and working tree recursively according to several criteria.</p>

<p>List all tracked files under current dir newline separated:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git ls-files
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.hidden
file
dir/file
</code></pre></div></div>

<p>Untracked files only:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git ls-files --other
</code></pre></div></div>

<p>TODO only files in current dir?</p>

<h2 id="binary-files">Binary files</h2>

<h3 id="how-git-determines-if-a-file-is-binary">How Git determines if a file is binary</h3>

<p>Git has an heuristic for determining if files are binary or text: it is not possible to do identify file types precisely.</p>

<p>If a file is binary affects such as not showing diffs in such files, which would be meaningless line-wise.</p>

<p>In 2014, the heuristic is: look up to 8000 bytes at the beginning of the file. Binary iff there is a <code class="highlighter-rouge">NUL</code> (<code class="highlighter-rouge">\0</code>).</p>

<p>This heuristic has the interesting property that it works for UTF-8, whose only 0 byte represents the NUL character. Unfortunately if fails for UTF-16.</p>

<p><a href="http://stackoverflow.com/questions/7110750/how-do-popular-source-control-systems-differentiate-binary-files-from-text-files">http://stackoverflow.com/questions/7110750/how-do-popular-source-control-systems-differentiate-binary-files-from-text-files</a></p>

<h3 id="list-all-text-files">List all text files</h3>

<p><a href="http://stackoverflow.com/questions/18973057/list-all-text-non-binary-files-in-repo">http://stackoverflow.com/questions/18973057/list-all-text-non-binary-files-in-repo</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git grep -Ile ''
</code></pre></div></div>

<p>Add trailing newlines to all text files that don’t have them:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git grep -Ile '' | xargs perl -lapi -e 's/.*/$&amp;/'
</code></pre></div></div>

<h3 id="check-if-a-file-is-binary">Check if a file is binary</h3>

<p><a href="http://stackoverflow.com/questions/6119956/how-to-determine-if-git-handles-a-file-as-binary-or-as-text">http://stackoverflow.com/questions/6119956/how-to-determine-if-git-handles-a-file-as-binary-or-as-text</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if [ -n "$(git grep -Ile "" -- "$file")" ]; then echo "Text"; fi
</code></pre></div></div>

<h3 id="force-file-to-be-treated-as-binary">Force file to be treated as binary</h3>

<p><a href="http://stackoverflow.com/questions/11162267/how-do-i-make-git-treat-a-file-as-binary">http://stackoverflow.com/questions/11162267/how-do-i-make-git-treat-a-file-as-binary</a></p>

<h3 id="force-file-to-be-treated-as-text">Force file to be treated as text</h3>

<p><a href="http://stackoverflow.com/questions/777949/can-i-make-git-recognize-a-utf-16-file-as-text">http://stackoverflow.com/questions/777949/can-i-make-git-recognize-a-utf-16-file-as-text</a></p>

<h3 id="diff-for-binary-files">Diff for binary files</h3>

<p>It is necessary to first convert the file to a text format if possible.</p>

<p>This can be done automatically through the <code class="highlighter-rouge">textconv</code> option for specified files.</p>

<p>There exist tools that do the conversion reasonably for documents such as <code class="highlighter-rouge">.doc</code> or <code class="highlighter-rouge">.odt</code>.</p>

<h3 id="u">U</h3>

<h3 id="inter-hunk-context">inter-hunk-context</h3>

<h3 id="hunk">Hunk</h3>

<p>The name of each contiguous modified chunk in a file.</p>

<p>Each hunk is delimited by an <code class="highlighter-rouge">@@</code> line on the default diff output format.</p>

<p>When Git merges two hunks is controlled by both the <code class="highlighter-rouge">-U</code> and <code class="highlighter-rouge">--inter-hunk-context</code> options.</p>

<p><code class="highlighter-rouge">-U</code> determines the minimum number of context lines to show. It defaults to 3.</p>

<p><code class="highlighter-rouge">--inter-hunk-context</code> determines the maximum extra number of lines between two contexts before the hunks are merged. It defaults to 0: hunks are only merged by default if the contexts touch.</p>

<p>Consider the following edit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 -&gt; a
2    2
3    3
4    4
5    5
6    6
7    7
8    a
</code></pre></div></div>

<p>Then:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git diff -U
</code></pre></div></div>

<p>shows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@@ -1,8 +1,8 @@
-1
+a
 2
 3
 4
 5
 6
 7
-8
+a
</code></pre></div></div>

<p>Hunks touched with 3 lines of context, and were merged.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git diff -U2
</code></pre></div></div>

<p>Gives:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@@ -1,3 +1,3 @@
-1
+a
2
3
@@ -6,3 +6,3 @@
6
7
-8
+a
</code></pre></div></div>

<p>Hunks did not touch anymore, so split up.</p>

<p>If we want to force them to merge anyways, we need to bridge two lines: 4 and 5. So we can do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdf --inter-hunk-context=2 -U2
</code></pre></div></div>

<p>And once again that gives:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@@ -1,8 +1,8 @@
-1
+a
 2
 3
 4
 5
 6
 7
-8
+a
</code></pre></div></div>

<p>It is sometimes possible to operate on separate hunks. E.g., <code class="highlighter-rouge">git add -i</code> allows that.</p>

<h2 id="blame">blame</h2>

<p>See who last modified each line of a given file and when (so you can blame for the bug the line caused…)</p>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2c37fa38 (Sergey Linnik          2012-11-19 02:36:50 +0400  71)     size = 40 if size.nil? || size &lt;= 0
2c37fa38 (Sergey Linnik          2012-11-19 02:36:50 +0400  72)
757c7a52 (Riyad Preukschas       2012-12-15 02:19:21 +0100  73)     if !Gitlab.config.gravatar.enabled || user_email.blank?
a9d1038f (Jeroen van Baarsen     2013-12-16 21:56:45 +0100  74)       '/assets/no_avatar.png'
65bcc41f (Robert Speicher        2012-08-15 21:06:08 -0400  75)     else
</code></pre></div></div>

<p>It does not seem possible to count how many lines each user changed in a single Git command as of 1.8.4, but the manual itself suggests a command to do so:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f=
git blame --line-porcelain "#f" | sed -n 's/^author //p' | sort | uniq -c | sort -rn
</code></pre></div></div>

<p>For the entire repo: <a href="http://stackoverflow.com/questions/4589731/git-blame-statistics">http://stackoverflow.com/questions/4589731/git-blame-statistics</a></p>

<p>See who last modified all files in project: <a href="http://serverfault.com/questions/401437/how-to-retrieve-the-last-modification-date-of-all-files-in-a-git-repository">http://serverfault.com/questions/401437/how-to-retrieve-the-last-modification-date-of-all-files-in-a-git-repository</a></p>

<p>Ignore whitespace only changes (e.g. indent):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git blame -w
</code></pre></div></div>

<p>Attribute moved lines to the original author, not the mover (TODO understand <code class="highlighter-rouge">C</code> and <code class="highlighter-rouge">M</code> precisely):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git blame -CM
</code></pre></div></div>

<h2 id="gitignore">gitignore</h2>

<p>See <code class="highlighter-rouge">man gitignore</code></p>

<p><code class="highlighter-rouge">.gitignore</code> are files that tell git to ignore certain files, typically output files so they won’t for example clutter your <code class="highlighter-rouge">git status</code>.</p>

<p>A <code class="highlighter-rouge">.gitignore</code> can be put anywhere in the repo and affects current dir and all descendants.</p>

<p>You should <em>always</em> put all output files inside a gitignore.</p>

<p>There are two common strategies to to that:</p>

<ul>
  <li>
    <p>by file extension</p>

    <p><code class="highlighter-rouge">*.o</code> to ignore all object files.</p>

    <p>This is has the downside that you may have to add lots of extensions to the gitignore.</p>
  </li>
  <li>
    <p>by directory</p>

    <p><code class="highlighter-rouge">_out/</code> to ignore all files in <code class="highlighter-rouge">_out/</code>.</p>

    <p>This is has the downside that some (bad) programs cannot output to or use files from other directories except the current…</p>
  </li>
</ul>

<h3 id="syntax">syntax</h3>

<p><code class="highlighter-rouge">.gitignore</code> uses slightly modified bash globbing. Reminders:</p>

<ul>
  <li>
    <p>bash globbing is strictly less powerful than regexes</p>
  </li>
  <li>
    <p>regex equivalence</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>glob        regex
--------    --------
`*`         `.*`
`*.o`       `.*\.o`
`[1-3]`     `[1-3]`
`[a-c]`     `[a-c]`
</code></pre></div>    </div>

    <p>so there is not equivalence for:</p>

    <ul>
      <li>regex Kleene star: <code class="highlighter-rouge">*</code></li>
      <li>regex alternatives: <code class="highlighter-rouge">(ab|cd)</code></li>
    </ul>
  </li>
</ul>

<p>If a pattern does not contain a slash <code class="highlighter-rouge">/</code>, it matches any entire basename in any subdir:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo a &gt; .gitignore
git status
    #untracked: b d/
git add d
git status
    #untracked: b
    #new file: d/b
</code></pre></div></div>

<p>If the pattern contains a slash <code class="highlighter-rouge">/</code>, only files under the given directory can match. E.g.: <code class="highlighter-rouge">d/*.c</code> matches <code class="highlighter-rouge">d/a.c</code> but not <code class="highlighter-rouge">d/e/a.c</code>.</p>

<p>If you want to ignore by basename under a given directory only, put a <code class="highlighter-rouge">.gitignore</code> into that directory.</p>

<p>If the pattern starts in <code class="highlighter-rouge">/</code>, only files under the same directory as the gitignore file can match. E.g.: <code class="highlighter-rouge">/*.c</code> matches <code class="highlighter-rouge">/a.c</code> but not <code class="highlighter-rouge">/d/a.c</code>.</p>

<p>Trying to add an ignored file gives an error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reset
git add a
    #error, a ignored, use -f if you really want to add it
</code></pre></div></div>

<p>You can ignore entire directories:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo d &gt; .gitignore
git status
    #untracked: a b
</code></pre></div></div>

<p><code class="highlighter-rouge">.gitignores</code> are valid on all subdirectories of which it is put only:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo a &gt; d/.gitignore
git status
    #untracked: a b d/
git add *
git status
    #new file: a b d/b
</code></pre></div></div>

<p>If a pattern starts with a <code class="highlighter-rouge">!</code>, it unignores files. Ignore all files except the gitignore itself:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*
!.gitignore
</code></pre></div></div>

<p>Ignore all files except the gitignore itself and another file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*
!.gitignore
!README.md
</code></pre></div></div>

<h3 id="local-gitignore">local gitignore</h3>

<p><code class="highlighter-rouge">.git/info/exclude</code></p>

<p>Does not get pushed to remote.</p>

<p>Same syntax as <code class="highlighter-rouge">.gitignore</code>.</p>

<h2 id="gitfile">gitfile</h2>

<p>A <code class="highlighter-rouge">.git</code> file, not the usual <code class="highlighter-rouge">.git</code> directory.</p>

<p><code class="highlighter-rouge">Documentation/glossary-content.txt</code> says that is contains the path to the actual git repository, much like a symlink.</p>

<p><code class="highlighter-rouge">t0002-gitfile</code> contains the exact behavior.</p>

<p>TODO different than <code class="highlighter-rouge">git --git-dir</code>?</p>

<p>The format is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo gitdir: &lt;path&gt;/.git
</code></pre></div></div>

<p>It must point to a valid Git bare repository, or you get:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fatal: Invalid gitfile format: .git
</code></pre></div></div>

<p>Now any operation, including changes you make, will act on the given <code class="highlighter-rouge">.git</code> bare repository.</p>

<h2 id="mailmap">mailmap</h2>

<p>Config file named <code class="highlighter-rouge">.mailmap</code> file at the repo root.</p>

<p>Allows authors to change emails / usernames while keeping a single identity.</p>

<p>Put lines like this in that file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Old Name &lt;old_email@mail.com&gt; New Name &lt;new_email@mail.com&gt;
</code></pre></div></div>

<p>Things will work well with this, for example [shortlog].</p>

<h2 id="add">add</h2>

<p>Make Git track files for next version</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add a
add a b
</code></pre></div></div>

<p>Check that it will be considered for next version with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git status
</code></pre></div></div>

<h3 id="example-add">Example: add</h3>

<p>Start with [1]:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo a2 &gt;&gt; a

git status
    #not staged: modified: a

git add a
git status
    #to be committed: modified: a
</code></pre></div></div>

<p>You must add after making the desired modifications.</p>

<p>If you add and then modify, only the first addition will be taken into account for next version.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo a2 &gt;&gt; a

git status
    #to be committed: modified: a
    #not staged:      modified: a

git add a

git status
    #to be committed: modified: a
</code></pre></div></div>

<p>Add is recursive on directories:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir d
echo a &gt; d/a
git status
    #to be committed: modified: a
    #untracked: d/

git add d
git status
    #to be committed: modified: a
    #to be committed: new: d/a
</code></pre></div></div>

<h3 id="add-and-gitignore">add and gitignore</h3>

<p>If you add a file that is in <code class="highlighter-rouge">.gitignore</code> directly, the add fail.</p>

<p>However, if you add a directory that contains gitignored files, then those files are ignored and the ignore succeeds.</p>

<p>Therefore, for example to add all files in the current it is better to use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add .
</code></pre></div></div>

<p>and not:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add *
</code></pre></div></div>

<p>which fails if there are gitignored files.</p>

<p><code class="highlighter-rouge">git add .</code> also has the advantage of including hidden dot files <code class="highlighter-rouge">.</code>.</p>

<h2 id="rm">rm</h2>

<p>If you want to remove a file that is tracked from future versions then use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rm a
</code></pre></div></div>

<p>A simple <code class="highlighter-rouge">rm a</code> will not remove it from next version.</p>

<p>If you already did <code class="highlighter-rouge">rm a</code>, then doing <code class="highlighter-rouge">git rm a</code> will work even if the file does not exist.</p>

<p>Note however that this file still can be accessed on older versions!</p>

<p>If you committed sensitive data like passwords like this by mistake, you need to remove it from history too!</p>

<p>To do that see [remove file from repo history].</p>

<h3 id="example-rm">Example: rm</h3>

<p>Start with [1]</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm a
git status
    #not staged: removed a
echo b2 &gt;&gt; b
git add b
git commit -m 2
</code></pre></div></div>

<p>Then <code class="highlighter-rouge">a</code> is still in the repo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout a
</code></pre></div></div>

<p>Restores a.</p>

<p>If you use <code class="highlighter-rouge">commit -a</code>, it gets removed anyway:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm a
git status
    #not staged: removed a
echo b2 &gt;&gt; b
git add b
git commit -am 2
</code></pre></div></div>

<p>You could also <code class="highlighter-rouge">git add</code> or <code class="highlighter-rouge">git rm</code> after a bare <code class="highlighter-rouge">rm</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm a
git add a
</code></pre></div></div>

<p>Or</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm a
git rm a
</code></pre></div></div>

<p>And a will be removed.</p>

<h3 id="rm-cached">rm –cached</h3>

<p>Don’t remove the file from working tree, but stop tracking it for next commit.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./copy.sh 1
git rm --cached b
git status
    #to be committed: deleted: b
    #untracked: b
git add b
git status
    #nothing to be committed
</code></pre></div></div>

<h3 id="rm--f">rm -f</h3>

<p>Remove even if it has local changes.</p>

<p>By default this is not permitted.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./copy.sh 1
echo a2 &gt;&gt; a
git rm a
    #error: a has local modifications
git rm -r a
ls
    #b
</code></pre></div></div>

<h3 id="rm--r">rm -r</h3>

<p>Remove all files descendants of a dir recursively.</p>

<p>By default, <code class="highlighter-rouge">git rm</code> won’t remove directories.</p>

<h2 id="remove-file-from-repo-history">Remove file from repo history</h2>

<p><code class="highlighter-rouge">rm</code> does not remove files from repo history, only from future versions.</p>

<p>So if you mistakenly committed:</p>

<ul>
  <li>
    <p>sensitive data like a password</p>
  </li>
  <li>
    <p>some large output file like an <code class="highlighter-rouge">.ogv</code></p>
  </li>
</ul>

<p>Do this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UNAME=cirosantilli
REPONAME=cpp
REPOURL=https://github.com/$UNAME/$REPONAME.git
RMFILE="*.ogv"

git filter-branch --index-filter "git rm --cached --ignore-unmatch \"$RMFILE\"" --prune-empty -- --all
</code></pre></div></div>

<p>Remove from local dir</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm -rf .git/refs/original/
git reflog expire --expire=now --all
git gc --prune=now
git gc --aggressive --prune=now
</code></pre></div></div>

<p>Remove from repo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push origin master -f
</code></pre></div></div>

<p><strong>Mail all colaborators</strong> and tell them to git rebase</p>

<h2 id="clean">clean</h2>

<p><strong>danger</strong>: remove all untracked files in repo that are not in gitignore:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./copy.sh 1

echo c &gt; c
echo c &gt; d/c
</code></pre></div></div>

<p>Dry run with <code class="highlighter-rouge">-n</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clean -n
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>would remove c
would not remove d/
</code></pre></div></div>

<p>Since this is a very dangerous operation, in <code class="highlighter-rouge">Git 1.8</code> the default is to do dry runs. This can be controlled by the <code class="highlighter-rouge">clean.requireForce</code> configuration option, and an <code class="highlighter-rouge">-f</code> is required to actually clean. Do not rely on the value of this option.</p>

<p>Remove entire directories with <code class="highlighter-rouge">-d</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clean -dn
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>would remove c
would remove d/
</code></pre></div></div>

<p>Not dry run with <code class="highlighter-rouge">-f</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clean -df
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>would remove c
would remove d/
</code></pre></div></div>

<p>By default, to make a non dry run, you have to add <code class="highlighter-rouge">-f</code>, but this depends on your git configurations.</p>

<p>Also remove untracked files listed in <code class="highlighter-rouge">.gitignore</code> with <code class="highlighter-rouge">-x</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clean -dfx
</code></pre></div></div>

<h2 id="mv">mv</h2>

<p>Similar to [rm].</p>

<p>If you do a normal <code class="highlighter-rouge">mv</code>, then it is as if the old file was removed and a new one was created:</p>

<p>Start with [1].</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mv b c
git status
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>removed: b
untracked: b
</code></pre></div></div>

<p>If you do <code class="highlighter-rouge">git mv</code>, git acknowledges it was moved:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mv b c
git status
    #renamed: b -&gt; c
</code></pre></div></div>

<p>With <code class="highlighter-rouge">-f</code>, if the new path exists, it is overwritten:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git mv -f "$OLD_PATH" "$NEW_PATH"
</code></pre></div></div>

<p>With <code class="highlighter-rouge">-k</code>, if moving would lead to an error (overwrite without -f or file not tracked), skip the move:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git mv -k "$OLD_PATH" "$NEW_PATH"
</code></pre></div></div>

<h2 id="reset">reset</h2>

<p>Move the current branch and possibly index and working directory to one of its ancestor commits.</p>

<p>Changes history.</p>

<p>Create explanation: <a href="http://git-scm.com/blog">http://git-scm.com/blog</a></p>

<p>Without paths <code class="highlighter-rouge">git reset [option]</code>:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">--soft</code> moves the current branch to given ancestor commit.</p>

    <p>It does not touch the index nor the working directory.</p>

    <p><code class="highlighter-rouge">git status</code> will show staged changes.</p>
  </li>
  <li>
    <p>neither <code class="highlighter-rouge">--soft</code> nor <code class="highlighter-rouge">--hard</code> does what <code class="highlighter-rouge">--soft</code> does <em>and</em> changes the index to that commit. The working directory is unchanged.</p>

    <p><code class="highlighter-rouge">git status</code> will show unstaged changes.</p>
  </li>
  <li>
    <p>neither <code class="highlighter-rouge">--hard</code> will move the current branch, the index <em>and</em> the working directory to the given commit.</p>

    <p><code class="highlighter-rouge">git status</code> does not show any changes.</p>

    <p>Changes were lost forever.</p>
  </li>
</ul>

<h3 id="hard-vs-soft">hard vs soft</h3>

<p>Hard also modifies the actual files and the index!</p>

<p>Soft does not.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./copy.sh 2u
echo a3 &gt;&gt; a
echo b3 &gt;&gt; b
git add a b c
git status
    #to be committed: a, b and c
</code></pre></div></div>

<p>With soft:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reset
    #unstaged: a, b
    #untracked: c
ls
    #a b c

cat a
    #a1
    #a2
    #a3

cat b
    #b1
    #b2
    #b3

cat c
    #c
</code></pre></div></div>

<p>So all files stayed the same as they were, but they became unstaged.</p>

<p>This is how you unstage a file.</p>

<p>With hard:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reset --hard
ls
    #a b c

cat a
    #a1
    #a2

cat b
    #b1
    #b2

cat c
    #c
</code></pre></div></div>

<ul>
  <li>
    <p>tracked files went back to as they were at last commit.</p>

    <p>Changes you made on the working tree were discarded!!</p>
  </li>
  <li>
    <p>untracked files (<code class="highlighter-rouge">c</code>) are unchanged, but they are unstaged.</p>
  </li>
</ul>

<h3 id="change-what-a-branch-points-to">change what a branch points to</h3>

<p>This changes history and as any history changing, if you do this after you [push] and someone else [fetche]d, there will be problems!</p>

<p>With reset, you can change the commit a branch points to to any other commit, even if the other commit is not an ancestor of the parent!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./copy.sh b2
git reset --hard b2
git status
    #no changes
</code></pre></div></div>

<p>The tree:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)
 |
 |
 |
 +------(b2)
         |
         master *
         b
</code></pre></div></div>

<h4 id="dangling-commit">Dangling commit</h4>

<p><code class="highlighter-rouge">(2)</code> in this example is called a <em>dangling commit</em>.</p>

<p>It is a commit with no descendant branch.</p>

<h4 id="delete-last-commit-from-history">Delete last commit from history</h4>

<p>Start with [2]:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./copy.sh 2
echo a3 &gt;&gt; a
echo b3 &gt;&gt; b
echo c &gt; c
git reset --hard HEAD~
ls
    #a b c

cat a
    #a1

cat b
    #b1

cat c
    #c

git show-refs -h HEAD
    #hash2

git log --pretty=oneline
    # Only one per commit.
</code></pre></div></div>

<p>The tree:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)
 |
 master *
</code></pre></div></div>

<p>And <code class="highlighter-rouge">(2)</code> is called a dangling commit.</p>

<h3 id="undo-a-reset-hard">Undo a reset hard</h3>

<p><a href="http://stackoverflow.com/questions/5473/undoing-a-git-reset-hard-head1">http://stackoverflow.com/questions/5473/undoing-a-git-reset-hard-head1</a></p>

<p>You can undo a reset hard if your are fast enough: a few weeks on default configurations.</p>

<p>First find out the hash of the deleted commit on the reflog:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reflog
</code></pre></div></div>

<p>Then reset hard to it:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reset --hard HEAD@{1}
</code></pre></div></div>

<p>And if you just did the <code class="highlighter-rouge">reste --hard</code> to any commit, you might also be able to get away simply with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reset --hard ORIG_HEAD
</code></pre></div></div>

<p>They should show up as <em>dangling commits</em>. This is what they are: commits that have no descendant branch.</p>

<p>Now merge away with the have you just found.</p>

<p>But <em>don’t rely on this!</em>: dangling commits are removed from time to time depending on your configs.</p>

<h3 id="remove-all-dangling-commits-permanently">Remove all dangling commits permanently</h3>

<p><a href="http://stackoverflow.com/questions/3765234/listing-and-deleting-git-commits-that-are-under-no-branch-dangling">http://stackoverflow.com/questions/3765234/listing-and-deleting-git-commits-that-are-under-no-branch-dangling</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reflog expire --expire=now --all
git gc --prune=now
</code></pre></div></div>

<p>But be sure this is what you want! There is no turning back.</p>

<h2 id="reflog">reflog</h2>

<p>See all that was done on all branches of the repository linearly in time:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reflog
</code></pre></div></div>

<p>Contains events like:</p>

<ul>
  <li>commits</li>
  <li>checkouts</li>
  <li>resets</li>
</ul>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>7c7afb3 HEAD@{0}: reset: moving to 7c7afb3
06887ac HEAD@{1}: commit (amend): Commit message.
7c7afb3 HEAD@{2}: checkout: moving from branch1 to branch2
</code></pre></div></div>

<p>The given SHA is for the <code class="highlighter-rouge">HEAD</code> after the operation on the line was carried out.</p>

<p><code class="highlighter-rouge">HEAD@{N}</code> are valid revisions and can be used for any command.</p>

<p>The <code class="highlighter-rouge">reflog</code> also stores times, so you can use revision names like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>master@{yesterday}
HEAD@{5 minutes ago}
</code></pre></div></div>

<p>Internally, the reflog is stored under <code class="highlighter-rouge">.git/logs</code>.</p>

<p>One major goal of the <code class="highlighter-rouge">reflog</code> is to prevent accidental data loss: for example, you can undo a <code class="highlighter-rouge">reset --hard</code> by using it to find the dangling commit.</p>

<h2 id="fsck">fsck</h2>

<p>Check reachability and validity of objects.</p>

<h2 id="revert">revert</h2>

<p>Create new commit(s) that undo what previous commits have done.</p>

<p>May generate merge conflicts.</p>

<p>Old commit tree for all examples:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)-----(3)
                 |
                 master *
</code></pre></div></div>

<p>Revert a single commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git revert 3
</code></pre></div></div>

<p>Never generates merge conflicts.</p>

<p>New commit tree:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)-----(3)-----(4)
                         |
                         master *
</code></pre></div></div>

<p>And the tree is exactly as it was on <code class="highlighter-rouge">(2)</code>.</p>

<p>You can also revert a commit other than the last one, but it may generate merge conflicts:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git revert 1
</code></pre></div></div>

<p>Revert multiple commits with multiple commits:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git revert 1..3
</code></pre></div></div>

<p>New commit tree:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)-----(3)-----(4)-----(5)
                                 |
                                 master *
</code></pre></div></div>

<p>And the working tree is exactly as it was on <code class="highlighter-rouge">(1)</code>. One new commit is generated for each reverted commit.</p>

<p><code class="highlighter-rouge">-n</code>: revert multiple commits with a single new commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git revert -n 1..3
git commit -m 4
</code></pre></div></div>

<p>New commit tree:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)-----(3)-----(4)
                         |
                         master *
</code></pre></div></div>

<p>And the working tree is exactly as it was on <code class="highlighter-rouge">(1)</code>.</p>

<h2 id="commit">commit</h2>

<p>Creates a new version from the content of the index.</p>

<p>You must first tell Git which files will be included in the next version by adding them to the index with commands like <code class="highlighter-rouge">add</code>, <code class="highlighter-rouge">rm</code>, <code class="highlighter-rouge">mv</code> and <code class="highlighter-rouge">reset</code>.</p>

<p>After you have decided what will be included or not, you are ready to commit.</p>

<p>This will be important later on to know what a version contains.</p>

<p>So from the <a href="#0">0</a> do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add a
git commit -m 'added a'
git status
</code></pre></div></div>

<p>To give it a message ‘added a’.</p>

<p>Now status only says that <code class="highlighter-rouge">b</code> is untracked and nothing about <code class="highlighter-rouge">a</code>.</p>

<h3 id="commit-message">Commit message</h3>

<p>It is recommended that the commit message be like:</p>

<ul>
  <li>
    <p>start with a summary line of max 50 characters</p>

    <p>To achieve the character limit, <strong>don’t</strong> use <code class="highlighter-rouge">-m</code>, and edit the message in Vim.</p>

    <p>The initial line should:</p>

    <ul>
      <li>be in the imperative, e.g., <code class="highlighter-rouge">Make</code> instead of <code class="highlighter-rouge">Made</code>.</li>
      <li>start with a capital letter.</li>
      <li>end with a period.</li>
    </ul>

    <p>The first line is treated specially by many tools which makes that line even more preeminent, e.g., Git itself has <code class="highlighter-rouge">git log --oneline</code>. So make that line count.</p>
  </li>
  <li>
    <p>blank line</p>
  </li>
  <li>
    <p>detailed explanation of the non-trivial changes.</p>

    <p>In practice, commits rely on the pull request or fixed issue description for the extended information.</p>
  </li>
</ul>

<p>E.g. of good commit message:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Add new super feature.

The feature behaves that way on case X because without that behavior,
case Y would fail miserably.
</code></pre></div></div>

<h3 id="amend">amend</h3>

<p>Instead of creating a new commit, add modifications to the last existing commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git commit --amend -m 'New msg.'
</code></pre></div></div>

<p>Modifies history.</p>

<p>The best way to correct a commit before submitting a change, while keeping the change to a single commit.</p>

<p>To change the commit commits further in the past, use <code class="highlighter-rouge">git rebase</code>.</p>

<p>Reuse old message:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git commit --amend --no-text
</code></pre></div></div>

<h3 id="author">author</h3>

<p>Change author:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git commit --author 'Ciro Santilli &lt;ciro@mail.com&gt;'
</code></pre></div></div>

<p>This does not change the committer.</p>

<p>To correct the name of an author on an entire repository, see: <a href="http://stackoverflow.com/questions/750172/how-do-i-change-the-author-of-a-commit-in-git">http://stackoverflow.com/questions/750172/how-do-i-change-the-author-of-a-commit-in-git</a></p>

<h3 id="committer-change">Committer change</h3>

<p><a href="http://stackoverflow.com/questions/18750808/difference-between-author-and-committer-in-git">http://stackoverflow.com/questions/18750808/difference-between-author-and-committer-in-git</a></p>

<p>The only way to do this seems to be with the environment variables <code class="highlighter-rouge">GIT_COMMITER_{AUTHOR,EMAIL}</code>.</p>

<h3 id="date">date</h3>

<p>Format: <a href="http://stackoverflow.com/questions/19742345/what-is-the-format-for-date-parameter-of-git-commit">http://stackoverflow.com/questions/19742345/what-is-the-format-for-date-parameter-of-git-commit</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git commit --date '2000-01-01T00:00:00 +0000'
</code></pre></div></div>

<h3 id="commit-all-tracked-files">Commit all tracked files</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add -am 'message'
</code></pre></div></div>

<p>Will create a new version, considering all files that are tracked (even if they were not added with add).</p>

<p>It is a very common default commit command.</p>

<p>If you use this all the time, you only add files once.</p>

<h3 id="allow-empty">allow-empty</h3>

<p>Allow “empty” commits that just reuse the last tree.</p>

<h2 id="shortlog">shortlog</h2>

<p>Summarizes log information.</p>

<p>Group by author, count by author:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Aaron France (1):
    Fixed JSON description of system hook

Aaron Stone (2):
    Tiny fix to the add/edit groups form path field
    Allow the OmniAuth provider args parameter to pass through as either an Array or a Hash.

Abe Hassan (1):
    Fix the sigil for merge request email
</code></pre></div></div>

<p>See how many commits each author did:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git shortlog -nse
</code></pre></div></div>

<h2 id="describe">describe</h2>

<p>Show the most recent tag reachable from current branch.</p>

<p>Any tag:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git describe --tags
</code></pre></div></div>

<p>Only annotated tags:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git describe
</code></pre></div></div>

<p>TODO understand <code class="highlighter-rouge">--abbrev</code>.</p>

<p>Very useful to check out to the most recent stable version before building:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout "$(git describe --tags --abbrev=0)"
</code></pre></div></div>

<h2 id="show">show</h2>

<p>Show human readable information on various types of objects.</p>

<h3 id="view-files-at-specific-version">View files at specific version</h3>

<p>Show specific versions of files and other infos.</p>

<p>View file at an specific version, path relative to root:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git show HEAD^:path/to/file
</code></pre></div></div>

<p>Relative to current directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git show HEAD^:./path/to/file
</code></pre></div></div>

<p>Application: checkout a file with a different name:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git show HEAD^:path/to/file &gt; new/path/to/file
</code></pre></div></div>

<h2 id="notes">notes</h2>

<p>TODO</p>

<h2 id="gitk">gitk</h2>

<p>Gitk is a GUI for git. Part of the Git source tree.</p>

<p>Consider tig for a very good curses version of gitk</p>

<p>Most of what it does can be done better from the git the command line interface, except for:</p>

<ul>
  <li>visualizing the commit tree, since this requires lines too fine for a terminal.</li>
  <li>look at the log for interesting changes, then click on a potentially interesting change to see its diff.</li>
</ul>

<p>All of the above are also possible via curses based tig.</p>

<p>What you almost always want is to use with <code class="highlighter-rouge">--all</code> to see all branches marked:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gitk --all
</code></pre></div></div>

<h3 id="diff-index">diff-index</h3>

<p>Plumbing.</p>

<p>Compares blobs between index and repository.</p>

<h3 id="diff-tree">diff-tree</h3>

<p>Plumbing.</p>

<h3 id="diff-files">diff-files</h3>

<p>Plumbing.</p>

<p>Compares files between the working tree and the index.</p>

<h3 id="raw-diff-format">raw diff format</h3>

<p>A raw diff is a summarized diff output format that only shows file level modifications, not changed lines. It also shows the similarity index for renamed files.</p>

<p>It can be viewed with <code class="highlighter-rouge">git diff --raw</code>, or as the output of the diff plumbing commands.</p>

<p>The format is documented at <code class="highlighter-rouge">man git-diff-index</code>.</p>

<h2 id="revision">Revision</h2>

<p>A revision is the git name for a version. It is also known informally as a commit.</p>

<h3 id="how-to-name-revisions">How to name revisions</h3>

<p>To actually go to another version, you have to be able to tell git which one is it, so that git can go back to it.</p>

<p>For the manual see:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man gitrevisions
</code></pre></div></div>

<p>There are a two ways to do that:</p>

<ul>
  <li>SHA-1 hash</li>
  <li>refs: names that points to SHA-1 hashes</li>
</ul>

<h4 id="sha-1">SHA-1</h4>

<h4 id="hash">Hash</h4>

<p>SHA-1 of the commit object.</p>

<p>If you don’t know what a SHA hash is learn it now. <a href="http://en.wikipedia.org/wiki/SHA-1">http://en.wikipedia.org/wiki/SHA-1</a>. The key properties of a SHA functions are that:</p>

<ul>
  <li>
    <p>it is very unlikely that two inputs give the same output.
There are no known conflicts as of 2014.</p>
  </li>
  <li>
    <p>small changes in the input make large unpredictable changes on the output.</p>
  </li>
</ul>

<p>In this way, even if SHAs contain much less information than the entire repository itself (only a few bytes), it is very unlikely that two different repositories will have the same SHA.</p>

<p>The SHA input includes file contents, filenames, commit timestamps, authors and tags. Therefore, even if the files are the same, SHAs will probably be different.</p>

<p>The most precise way of specifying a version is with the full 40 byte SHA:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1ba8fcebbff0eb6140740c8e1cdb4f9ab5fb73b6
</code></pre></div></div>

<p>If this is the only version that starts with <code class="highlighter-rouge">1ba8fc</code> or <code class="highlighter-rouge">1ba8</code>, you could use those as well. 6 digits is common for manual use.</p>

<p>Get the hash of the latest commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git log -n1 --pretty=format:%H
</code></pre></div></div>

<h4 id="reference">Reference</h4>

<h4 id="refs">Refs</h4>

<p>Refs are names that point to SHA-1 hashes, and therefore to revisions.</p>

<p>There are many types of references.</p>

<p>Most of them are represented in in files under <code class="highlighter-rouge">.git/refs/</code> which contain only the SHA they point to. E.g.:</p>

<ul>
  <li>
    <p><em>branches</em> like <code class="highlighter-rouge">master</code>: by default at <code class="highlighter-rouge">.git/refs/heads/master</code>, modified by <code class="highlighter-rouge">git branch</code>, <code class="highlighter-rouge">git fetch</code>, etc.</p>
  </li>
  <li>
    <p><em>tags</em> like <code class="highlighter-rouge">1.0.1</code>: by default at <code class="highlighter-rouge">.git/refs/tags/1.0.1</code>, modified by <code class="highlighter-rouge">git tag</code>. Point to the SHA of the tag object, not the commit.</p>
  </li>
  <li>
    <p><em>remote</em> branches like <code class="highlighter-rouge">remotes/feature</code>: by default at <code class="highlighter-rouge">.git/refs/remotes/feature</code>, modified by <code class="highlighter-rouge">git fetch</code>.</p>
  </li>
</ul>

<p>If a ref is not found there, it is also searched for on the <code class="highlighter-rouge">.git/packed-refs</code>: this can be more space efficient since each file has metadata associated to it. See Packfile.</p>

<p>But there are also some special ones like <code class="highlighter-rouge">HEAD</code> which live outside of of <code class="highlighter-rouge">refs</code>, at: <code class="highlighter-rouge">.git/HEAD</code>.</p>

<p>TODO how to create refs outside those subdirectories? GitHub creates under <code class="highlighter-rouge">.git/refs/pull</code> for e.g..</p>

<p>Although refs live in subdirectories of <code class="highlighter-rouge">refs</code>, you don’t usually need to specify the subdirectory: just saying <code class="highlighter-rouge">master</code> is often enough to specify <code class="highlighter-rouge">refs/heads/master</code>. Git uses the following search order, documented at <code class="highlighter-rouge">man gitrevisions</code>:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">$GIT_DIR/&lt;name&gt;</code> Usually useful only for special branches like
<code class="highlighter-rouge">HEAD</code>, <code class="highlighter-rouge">FETCH_HEAD</code>, <code class="highlighter-rouge">ORIG_HEAD</code>, <code class="highlighter-rouge">MERGE_HEAD</code> and <code class="highlighter-rouge">CHERRY_PICK_HEAD</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">refs/&lt;name&gt;</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">refs/tags/&lt;refname&gt;</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">refs/heads/&lt;name&gt;</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">refs/remotes/&lt;name&gt;</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">refs/remotes/&lt;name&gt;/HEAD</code></p>
  </li>
</ul>

<h5 id="head">HEAD</h5>

<p>The <code class="highlighter-rouge">HEAD</code> is the current commit we are on.</p>

<p>Lives at <code class="highlighter-rouge">.git/HEAD</code>.</p>

<p>It is possible to determine the current <code class="highlighter-rouge">HEAD</code> by doing <code class="highlighter-rouge">git branch</code>: the head will be the branch with an asterisk in front of it.</p>

<p>Internally, the head is determined by the content of the file <code class="highlighter-rouge">$GIT/HEAD</code>, which is the hash of the current head commit.</p>

<h6 id="example-head">Example: HEAD</h6>

<p>Start with [1]. We have:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)
 |
 HEAD
</code></pre></div></div>

<p>After another commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)
         |
         HEAD
</code></pre></div></div>

<p>After another commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)-----(3)
                 |
                 HEAD
</code></pre></div></div>

<h5 id="orig_head">ORIG_HEAD</h5>

<p><code class="highlighter-rouge">man gitrevisions</code> says:</p>

<blockquote>
  <p>ORIG_HEAD is created by commands that move your HEAD in a drastic way, to record the position of the HEAD before their operation, so that you can easily change the tip of the branch back to the state before you ran them.</p>
</blockquote>

<p><code class="highlighter-rouge">git reset --hard</code> is a drastic change, and <code class="highlighter-rouge">man git-reset</code> says that <code class="highlighter-rouge">ORIG_HEAD</code> is created on that operation.</p>

<p>So you can just redo the last <code class="highlighter-rouge">reset --hard</code> as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reset --hard something
git reset --hard ORIG_HEAD
</code></pre></div></div>

<h4 id="show-ref">show-ref</h4>

<p>Low-level references listing:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git show-refs
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>9b7dd8b4c04c427de22543fec7f52be26decdb22 refs/heads/up
861fa5553de736af945a78b4bf951f6f5d2618e9 refs/remotes/mine/zz/public-user
9b7dd8b4c04c427de22543fec7f52be26decdb22 refs/remotes/origin/master
52d771167707552d8e2a50f602c669e2ad135722 refs/tags/v1.0.1
</code></pre></div></div>

<h4 id="update-ref">update-ref</h4>

<p>Low-level reference manipulation.</p>

<h4 id="relative-to-another-revision">Relative to another revision</h4>

<p>One commit before:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HEAD~
</code></pre></div></div>

<p>Two commits before:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HEAD~~
HEAD~2
</code></pre></div></div>

<p>Three commits before:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HEAD~~~
HEAD~3
</code></pre></div></div>

<p>Also work:</p>

<ul>
  <li>hash:        <code class="highlighter-rouge">1ba8f~3</code></li>
  <li>branch:      <code class="highlighter-rouge">master~3</code></li>
  <li>tag:         <code class="highlighter-rouge">1.0~3</code></li>
  <li>remote head: <code class="highlighter-rouge">origin/master~3</code></li>
  <li>the previous position of branch <code class="highlighter-rouge">master</code>: <code class="highlighter-rouge">master@{1}</code></li>
</ul>

<p>Moving forward is not unique since branch can split and have multiple children, so it is more complicated.</p>

<h3 id="name-rev">name-rev</h3>

<p>If you have the hash of a commit and you want a symbolic name for it, <code class="highlighter-rouge">name-rev</code> does that for you, probably looking for the closest named reference ahead of the commit.</p>

<p>Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git name-rev 012345
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>012345 master~2
</code></pre></div></div>

<p>Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git name-rev HEAD
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>012345 some-branch
</code></pre></div></div>

<h3 id="symbolic-ref">symbolic-ref</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git symbolic-ref 'master2' 'refs/heads/master'
</code></pre></div></div>

<h3 id="commit-ish">commit-ish</h3>

<h3 id="tree-ish">tree-ish</h3>

<h3 id="rev">rev</h3>

<p>The terms:</p>

<ul>
  <li><code class="highlighter-rouge">&lt;commit-ish&gt;</code></li>
  <li><code class="highlighter-rouge">&lt;tree-ish&gt;</code></li>
  <li><code class="highlighter-rouge">&lt;rev&gt;</code></li>
</ul>

<p>are used on command specifications throughout Git, so it is crucial to grasp their meaning.</p>

<p><code class="highlighter-rouge">&lt;commmit-ish&gt;</code> is a name that ultimately resolves to a commit, e.g.:</p>

<ul>
  <li>directly: the SHA-1 of the commit</li>
  <li>indirectly: a tag that points to a commit</li>
</ul>

<p>Most of the naming described a <code class="highlighter-rouge">man gitrevisions</code> are commit-ishes.</p>

<p><code class="highlighter-rouge">&lt;tree-ish&gt;</code> is a name that ultimately resolves to a tree, which <code class="highlighter-rouge">man gitrevisions</code> defines as either a directory or a file (blob). Every commit-ish is also a tree-ish that refers to the top-level tree of the commit, but a few tree-ishes are not commit-ishes, e.g.:</p>

<ul>
  <li>master:path/to/tree</li>
  <li>SHA-1 of a tree object</li>
</ul>

<p>TODO <code class="highlighter-rouge">&lt;rev&gt;</code> vs <code class="highlighter-rouge">&lt;commit&gt;</code> vs <code class="highlighter-rouge">&lt;commit-ish&gt;</code>?</p>

<h2 id="difftool">difftool</h2>

<p>Use configured <code class="highlighter-rouge">diff</code> tool so see the diff.</p>

<h2 id="tag">tag</h2>

<p>Tags are a type of ref: names for commits commits.</p>

<p>They live under <code class="highlighter-rouge">.git/refs/tags</code>.</p>

<p>Difference from branches:</p>

<ul>
  <li>tags don’t move automatically with commits, so you can refer to a commit forever by its tag, unless an evil developer changes the tag, which should almost never be done.</li>
  <li>tags occupy a single namespace: there is no <code class="highlighter-rouge">remotes</code>. As a consequence, you have to be very careful with which tags you push to a remote so as to not overwrite other people’s local tags.</li>
</ul>

<p>Typical usage: give version numbers: <code class="highlighter-rouge">1.0</code>, <code class="highlighter-rouge">1.1</code>, <code class="highlighter-rouge">2.0</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./copy 2
</code></pre></div></div>

<p>You cannot give a tag twice:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag 1.0
git tag 1.0 HEAD~
</code></pre></div></div>

<p>So you must delete the old tag before.</p>

<p>A single commit can however have multiple tags.</p>

<h3 id="annotated-tag">Annotated tag</h3>

<p>There are two types of tags, annotated and lightweight (not annotated).</p>

<p>Annotated tags have an associated message, author and creation date.</p>

<p>For internals and when to use see: <a href="http://stackoverflow.com/a/25996877/895245">http://stackoverflow.com/a/25996877/895245</a></p>

<p>Annotated tags are tags that point to tag objects that point to commits.</p>

<p>Because of this, they have more metadata than just the commit they point to, including a message (possibly with a GPG signature at the end if you use <code class="highlighter-rouge">-s</code>) and tagger identity and timestamp.</p>

<p>Use annotated tags to all tags you will publish, e.g. version numbers as they contain more useful information.</p>

<p>Some commands treat annotated and lightweight tags differently. The general semantics of such differentiation suggests the following rule, which you should always follow:</p>

<p><code class="highlighter-rouge">man git</code> says:</p>

<blockquote>
  <p>Annotated tags are meant for release while lightweight tags are meant for private or temporary object labels</p>
</blockquote>

<ul>
  <li>
    <p><code class="highlighter-rouge">git describe</code> goes back to the first annotated tag ancestor, not lightweight, by default.</p>

    <p>Therefore, <code class="highlighter-rouge">git describe HEAD</code> will always go the latest stable version if you follow the above convention, even if you have private development only tags.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git push --follow-tags</code> only pushes annotated tags.</p>
  </li>
</ul>

<h4 id="create-an-annotated-tag">Create an annotated tag</h4>

<p>Create annotated tag to <code class="highlighter-rouge">HEAD</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag -m 'message'
</code></pre></div></div>

<p>The message is mandatory: if not given an editor will open up for you to type it in.</p>

<p>If <code class="highlighter-rouge">-m</code> is given, <code class="highlighter-rouge">-a</code> is implied which generates an annotated tag.</p>

<h3 id="list-tags">List tags</h3>

<h4 id="list-tags-that-contain-a-given-commit">List tags that contain a given commit</h4>

<p>Get a newline separated list of all tags for the latest commit, or empty if no tags are available:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag --contains &lt;commit&gt;
</code></pre></div></div>

<p><code class="highlighter-rouge">&lt;commit&gt;</code> defaults to <code class="highlighter-rouge">HEAD</code>.</p>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tag1
tag2
</code></pre></div></div>

<h4 id="list-only-annotated-tags">List only annotated tags</h4>

<h4 id="list-only-lightweight-tags">List only lightweight tags</h4>

<p><a href="http://stackoverflow.com/questions/21031201/how-can-i-list-all-lightweight-tags">http://stackoverflow.com/questions/21031201/how-can-i-list-all-lightweight-tags</a></p>

<p>Only annotated:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git for-each-ref refs/tags/ --format '%(objecttype) %(refname:short)' | awk '$1 == "tag" {print $2}'
</code></pre></div></div>

<p>Only lightweight:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git for-each-ref refs/tags/ --format '%(objecttype) %(refname:short)' | awk '$1 == "commit" {print $2}'
</code></pre></div></div>

<h4 id="sort-the-tag-listing">Sort the tag listing</h4>

<p>By default, lexicographical order is used.</p>

<p>There many more sensible ways of doing that to reflect “time”:</p>

<ul>
  <li>date of annotated tag creation. Only works for annotated tags, as lightweight don’t have an object with metadata. <a href="http://stackoverflow.com/questions/6269927/how-can-i-list-all-tags-in-my-git-repository-by-the-date-they-were-created">http://stackoverflow.com/questions/6269927/how-can-i-list-all-tags-in-my-git-repository-by-the-date-they-were-created</a></li>
  <li>topological order or the object pointed to <a href="http://stackoverflow.com/questions/6900328/git-command-to-show-all-lightweight-tags-creation-dates">http://stackoverflow.com/questions/6900328/git-command-to-show-all-lightweight-tags-creation-dates</a></li>
  <li>simple version string parsing order. Does not use any Git information, and could be done with <code class="highlighter-rouge">| sort -V</code>. Git 2 added <code class="highlighter-rouge">--sort=version:refname "foo*"</code> <a href="http://stackoverflow.com/questions/14273531/how-to-sort-git-tags-by-version-string-order-of-form-rc-x-y-z-w">http://stackoverflow.com/questions/14273531/how-to-sort-git-tags-by-version-string-order-of-form-rc-x-y-z-w</a></li>
</ul>

<h3 id="create-tags">Create tags</h3>

<p>Give lightweight tag to <code class="highlighter-rouge">HEAD</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag 2.0
</code></pre></div></div>

<p>View associated information of annotated tag:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git show 2.0
</code></pre></div></div>

<p>Give tag to another commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag 1.0 HEAD~
</code></pre></div></div>

<p>Give another tag to that commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag 1.1 HEAD~
</code></pre></div></div>

<h3 id="get-tag-info">Get tag info</h3>

<p>List all tags:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.0
1.0a
1.1
</code></pre></div></div>

<p>List tags and corresponding hashes side by side:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git show-ref --tags
</code></pre></div></div>

<p>List with tags with corresponding commit messages side by side: not possible without a for loop: <a href="http://stackoverflow.com/questions/5358336/have-git-list-all-tags-along-with-the-full-message">http://stackoverflow.com/questions/5358336/have-git-list-all-tags-along-with-the-full-message</a></p>

<p>List tags with date side by side and on commit tree:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git log --date-order --graph --tags --simplify-by-decoration --pretty=format:'%ai %h %d'
</code></pre></div></div>

<h3 id="edit-tag">Edit tag</h3>

<p>Strictly speaking there is no tag editing, only overwriting tags with new ones of the same name:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag -f tagname
git tag -af -m tagname
</code></pre></div></div>

<p>This requires the <code class="highlighter-rouge">-f</code> flag or else the command fails.</p>

<h3 id="delete-tags">Delete tags</h3>

<p>Delete a tag:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git tag -d 1.0
</code></pre></div></div>

<h3 id="push-tags-to-remote">Push tags to remote</h3>

<p>By default <code class="highlighter-rouge">git push</code> does not push tags to the remote.</p>

<p>The sanest way is to push explicit tags:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push &lt;remote&gt; &lt;tagname&gt;&gt;
</code></pre></div></div>

<p>Another sane option introduced around 1.8 is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push --follow-tags
</code></pre></div></div>

<p>which only pushes annotated tags that can be reached from the newly pushed commits.</p>

<p>Push all tags with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push --tags
</code></pre></div></div>

<p>but this is bad because it might push unwanted development tags, which could conflict with the local tags of other developers.</p>

<p>Delete a remote tag with either of:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push --delete tagname
git push :tagname
</code></pre></div></div>

<h3 id="get-tags-from-remote">Get tags from remote</h3>

<p><code class="highlighter-rouge">clone</code> automatically gets all the tags.</p>

<p><code class="highlighter-rouge">fetch</code>:</p>

<ul>
  <li>
    <p>by default gets all tags that point to objects that exist on the local repository. Does not overwrite existing tags.</p>
  </li>
  <li>
    <p>with <code class="highlighter-rouge">--tags</code> fetches all tags and overwrite if existing locally.</p>

    <p>When overwriting shows a message like:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- [tag update]      tagname          -&gt; tagname
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">git fetch tag</code> fetches only a single tag</p>
  </li>
</ul>

<h3 id="describe-1">describe</h3>

<p>Get the most recent annotated tag reachable from a given commit. Defaults to <code class="highlighter-rouge">HEAD</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git describe
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>v6.4.0.pre2-16-g41ae328
</code></pre></div></div>

<p>Format:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;tag&gt;-&lt;commits_ahead&gt;-g&lt;hash_start&gt;
</code></pre></div></div>

<p>Not necessarily annotated tag:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git describe --tags
</code></pre></div></div>

<p>If you want to use this programmatically you could:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git describe --abbrev=0 --tags 2&gt;/dev/null
</code></pre></div></div>

<p>Which ignores the error message in case there are no tags, so you get an empty result if there are no tags, and the latest tag if there is at least one tag.</p>

<h2 id="branch">branch</h2>

<p>Branches are a type of ref: a name for a commit.</p>

<p>Branches live under <code class="highlighter-rouge">.git/refs/heads</code>.</p>

<p>Unlike tags, branches are movable: when you commit on a branch the branch moves. Therefore, you cannot refer to a single revision forever with a branch.</p>

<p>Branches are used to creates alternate realities so you can test changes without one affecting the other.</p>

<h3 id="master">master</h3>

<p><code class="highlighter-rouge">master</code> is the name of the branch created by default on new repositories.</p>

<p>There is nothing else special about it.</p>

<p>By convention, In many work flows, it represents the most recent unstable version of the software, so it is where you will develop the software.</p>

<p>There are also some work flows that only leave stable versions at <code class="highlighter-rouge">master</code>, and develop on the <code class="highlighter-rouge">dev</code> branch.</p>

<h3 id="list-branches">List branches</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch
</code></pre></div></div>

<p>Not the asterisk indicating which is the current branch.</p>

<p>More info:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch -v
</code></pre></div></div>

<p>Also shows start of SHA and last commit message:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>api-attach   7dc296b Update note attachment from API.
api-username 35da7b8 API get user by username.
demo         9c1aebe Marked markdown preview as you type.
</code></pre></div></div>

<p>One very important way is to do is graphically:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gitk --all
</code></pre></div></div>

<p>Will show you who is the descendant of whom!</p>

<h3 id="create-a-branch">Create a branch</h3>

<p>The most common way to create a branch is via:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout -b branchname
</code></pre></div></div>

<p>which already sets that branch as the current.</p>

<p>Create a branch without setting it to current:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch branchname
</code></pre></div></div>

<h3 id="what-happens-when-you-create-a-branch">What happens when you create a branch</h3>

<p>To the files, nothing.</p>

<p>To the tree, suppose we are [1u]</p>

<p>Then after:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch b
</code></pre></div></div>

<p>It becomes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)
 |
 master *
 b
</code></pre></div></div>

<h3 id="what-happens-to-a-branch-when-you-commit">What happens to a branch when you commit</h3>

<p>The <em>current</em> branch moves forward and continues being current.</p>

<p>Ex: start at <a href="#1ub">1ub</a> now:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add c
git commit -am 'c'
</code></pre></div></div>

<p>Gives:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(c)
         |
         master *
</code></pre></div></div>

<p>Now try:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout b
</code></pre></div></div>

<p>Which gives:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)
 |       |
 b *     master
</code></pre></div></div>

<p>C disappears because it was not tracked in <code class="highlighter-rouge">b</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a b
echo c1 &gt; c
git add c
git commit -m 'cb'
</code></pre></div></div>

<p>And now we have:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+---------------(cb)
|                |    (1)-----(2)       b *
        |
        master
</code></pre></div></div>

<p>Which makes it obvious why a branch is called a branch.</p>

<h3 id="detached-head">Detached head</h3>

<p>Is when you checkout to a commit that has no branch associated.</p>

<p>E.g.: start with [2]</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout HEAD^
</code></pre></div></div>

<p>Now see:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch
</code></pre></div></div>

<p>Shows current branch as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(no branch) *
</code></pre></div></div>

<h4 id="what-should-i-do-if-i-want-to-branch-from-the-detached-head">What should I do if I want to branch from the detached head</h4>

<p>If you are on it, you should first create a branch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch b
</code></pre></div></div>

<p>Then work normally.</p>

<p>You can also create a branch before going to it with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch &lt;hash&gt;
</code></pre></div></div>

<h4 id="what-happens-if-i-commit-on-a-detached-head">What happens if I commit on a detached head</h4>

<p>Bad things! Never do this!</p>

<p>Git does commit, but stays on a undefined state.</p>

<p>To correct it you can create a branch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch b
</code></pre></div></div>

<p>And since you were on no branch, git automatically changes to <code class="highlighter-rouge">b</code>.</p>

<h5 id="what-if-i-commit-and-checkout">What if I commit and checkout</h5>

<p>Worse things.</p>

<p>Your old commit still exists, but does not show even on <code class="highlighter-rouge">git log --all</code>.</p>

<p>Git warns you: this might be a good time to give it a branch, and you should as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch b hash
</code></pre></div></div>

<h3 id="set-branch-commit">Set branch commit</h3>

<p>You can also create a branch at any commit other than the current one:</p>

<p>Take [2]</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch b HEAD~
</code></pre></div></div>

<p>Now</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch -v
</code></pre></div></div>

<p>To create switch to it directly:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout -b b HEAD~
</code></pre></div></div>

<h3 id="slash-in-branch-name">Slash in branch name</h3>

<p>Inside the <code class="highlighter-rouge">.git</code>, branches are placed under <code class="highlighter-rouge">refs</code>.</p>

<p>If you name a branch <code class="highlighter-rouge">a/b</code> it will create a file under <code class="highlighter-rouge">refs/a/b</code>.</p>

<p>Therefore you can’t both:</p>

<ul>
  <li>have a branch named <code class="highlighter-rouge">a</code></li>
  <li>have a branch names <code class="highlighter-rouge">a/b</code></li>
</ul>

<p>since <code class="highlighter-rouge">a</code> would have to be both a directory and a file at the same time for that to work.</p>

<h3 id="rename-branch">Rename branch</h3>

<p>Rename a given branch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch -m oldname newname
</code></pre></div></div>

<p>Rename the current branch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch -m newname
</code></pre></div></div>

<h3 id="branch-without-parent">Branch without parent</h3>

<p>If two repositories are strictly linked, it is possible to use a single repository with unrelated branches for both.</p>

<p>To achieve this, you must create a branch without a parent, which can be done with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout --orphan branchname
</code></pre></div></div>

<p>This command takes the tree:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>( )-----( )
         |
         master *
</code></pre></div></div>

<p>and generates:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>( )-----( )
         |
         master *

( )
 |
 branchname
</code></pre></div></div>

<p>This is notably the case of GitHub Pages which requires an orphan branch called <code class="highlighter-rouge">gh-pages</code>.</p>

<p>Before you do this however, take into account its downsides:</p>

<ul>
  <li>you cannot view file from both branches simultaneously (unless you copy the repository)</li>
  <li>its more confusing for new users</li>
</ul>

<h2 id="check-ref-format">check-ref-format</h2>

<p>Plumbing command to check if a <code class="highlighter-rouge">ref</code> is a valid name.</p>

<p>Git imposes several restrictions on <code class="highlighter-rouge">refs</code>, such as not containing spaces, even is those don’t have a specific technical reason like name a conflict, e.g. no spaces: <a href="http://stackoverflow.com/questions/6619073/why-cant-a-branch-name-contain-the-space-char">http://stackoverflow.com/questions/6619073/why-cant-a-branch-name-contain-the-space-char</a></p>

<p>On the other hand, except for the small restriction list, UTF-8 names are allowed.</p>

<p>TODO why does:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git check-ref-format 'master'
</code></pre></div></div>

<p>fail, but:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git check-ref-format --branch 'master'
</code></pre></div></div>

<p>pass? What does the first form do?</p>

<h2 id="checkout">checkout</h2>

<p>Goes to another version</p>

<p>Before you go to another version, you must see which versions you can go back with <code class="highlighter-rouge">log</code> or <code class="highlighter-rouge">gitk</code>.</p>

<h3 id="entire-repo">Entire repo</h3>

<p>Use the <code class="highlighter-rouge">checkout</code> command with some version name as explained in <a href="#revisions">Revisions</a> for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout 494b
git checkout HEAD~
git checkout master~
</code></pre></div></div>

<p>The command is called <code class="highlighter-rouge">checkout</code>, because we are going to “check out” what another version was like.</p>

<p>If you checkout the entire repo, <code class="highlighter-rouge">HEAD</code> moves!</p>

<p>If you omit the version, defaults to <code class="highlighter-rouge">HEAD</code> so:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout
git checkout HEAD
</code></pre></div></div>

<p>Are the same.</p>

<h3 id="to-previous-branch">To previous branch</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout -
</code></pre></div></div>

<p>which is the same as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout @{-1}
</code></pre></div></div>

<h4 id="example-checkout-entire-repo">Example: checkout entire repo</h4>

<p>Start with [3].</p>

<p>It looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)-----(3)
                 |
                 master
                 HEAD
</code></pre></div></div>

<p>Now do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout HEAD~~
</code></pre></div></div>

<p>The files <code class="highlighter-rouge">a</code> and <code class="highlighter-rouge">b</code> now both contain one line!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat a
    #a1

cat b
    #b1
</code></pre></div></div>

<p>The tree looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)-----(3)
 |               |
 HEAD            master
</code></pre></div></div>

<p>Note how the <code class="highlighter-rouge">HEAD</code> moved, but <code class="highlighter-rouge">master</code> did not!</p>

<p>Now do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout master
</code></pre></div></div>

<p>And <code class="highlighter-rouge">a</code> and <code class="highlighter-rouge">b</code> contain three lines again. This is how things look:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)-----(3)
                 |
                 master
                 HEAD

cat a
    #a1

cat b
    #b1
</code></pre></div></div>

<p>Files that are not tracked stay the same.</p>

<h4 id="untracked-files">Untracked files</h4>

<p>Start with [2]</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo -e 'c1\nc2' &gt; c
</code></pre></div></div>

<p>Now checkout:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout HEAD~
</code></pre></div></div>

<p><code class="highlighter-rouge">a</code> and <code class="highlighter-rouge">b</code> have changed</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat a
    #a1

cat b
    #b1
</code></pre></div></div>

<p>But the untracked <code class="highlighter-rouge">c</code> stays the same:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat c
    #c1
    #c2
</code></pre></div></div>

<h4 id="uncommitted-changes">Uncommitted changes</h4>

<p>If you have not yet committed changes, git warns you and does not checkout.</p>

<h5 id="checkout-uncommitted-modification">Checkout uncommitted modification</h5>

<p>Start with [2].</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo a3 &gt;&gt; a
</code></pre></div></div>

<p>Then try:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout HEAD~
</code></pre></div></div>

<p>Git says that there is a change, and does nothing.</p>

<h5 id="checkout-file-overwrite">Checkout file overwrite</h5>

<p>Start with [2]</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rm a
git commit -am '-a'

git echo -e 'a1\na2' &gt; a
</code></pre></div></div>

<p>Then try:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout HEAD~~
</code></pre></div></div>

<p>This fails again, because file a would be overwritten, even if its contents did not change.</p>

<h3 id="single-file-or-dir">Single file or dir</h3>

<p>Just like checking out the dir, but you also specify the files:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout HEAD~ a b
</code></pre></div></div>

<p>The head does not move now! This is different from the behaviour of checking out without a path.</p>

<p>New files that appear are just like untracked ones.</p>

<h4 id="checkout-single-file">Checkout single file</h4>

<p>Start from [2]:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout HEAD^ a

cat a
    #a1
</code></pre></div></div>

<p>But we are still at master:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch
    #* master
</code></pre></div></div>

<h4 id="checkout-single-removed-file">Checkout single removed file</h4>

<p>Start from [2]</p>

<p>Remove <code class="highlighter-rouge">b</code> and commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rm b
git commit -am '-b'
</code></pre></div></div>

<p>Now restore it:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout HEAD~ b

cat b
    #b1
    #b2
</code></pre></div></div>

<p>The file must exist in the version you want to checkout to.</p>

<h4 id="checkout-after-remove">Checkout after remove</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>start with [1]

git rm a
git commit -am 'noa`
</code></pre></div></div>

<p>Now try:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout a
</code></pre></div></div>

<p>Which is the same as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout HEAD -- a
</code></pre></div></div>

<p>And it fails, because in <code class="highlighter-rouge">HEAD</code> a was removed from the repo.</p>

<h4 id="uncommitted-changes-1">Uncommitted changes</h4>

<p>Unlike when checking out the entire repo, Git does not prompt you in case of non-committed modifications when checking out individual files!</p>

<p>This is a great way to achieve data loss.</p>

<h4 id="example-checkout-single-file-with-modifications">Example: checkout single file with modifications</h4>

<p>Start from [2]</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo a3 &gt;&gt; a
git checkout
</code></pre></div></div>

<h3 id="theirs">theirs</h3>

<h3 id="ours">ours</h3>

<p>Will be discussed together with merge conflicts.</p>

<h4 id="theirs-vs-ours-in-rebase-vs-merge">theirs vs ours in rebase vs merge</h4>

<p>Confusingly, during <code class="highlighter-rouge">git rebase</code>, <code class="highlighter-rouge">theirs</code> means the previous current branch.</p>

<p>See also: <a href="http://stackoverflow.com/questions/2959443/why-is-the-meaning-of-ours-and-theirs-reversed-with-git-svn">http://stackoverflow.com/questions/2959443/why-is-the-meaning-of-ours-and-theirs-reversed-with-git-svn</a> and <code class="highlighter-rouge">man git-rebase</code>.</p>

<h2 id="bisect">bisect</h2>

<p>Checkout interactively to binary search between two commits for an error.</p>

<p>Given:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(A)---(B)---(C)---(D)---(E)
</code></pre></div></div>

<p>When you:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git bisect start
git bisect bad
git bisect good A
</code></pre></div></div>

<p>It will checkout to <code class="highlighter-rouge">C</code>, you will test the program. If it fails, you will do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git bisect bad
</code></pre></div></div>

<p>And if it works:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git bisect good
</code></pre></div></div>

<p>And the binary search continues!</p>

<h2 id="bisect-run">bisect run</h2>

<p><a href="http://stackoverflow.com/questions/4713088/how-to-use-git-bisect/22592593#22592593">http://stackoverflow.com/questions/4713088/how-to-use-git-bisect/22592593#22592593</a></p>

<h2 id="stash">stash</h2>

<p>Saves all unstaged modifications of the working tree, and returns the working tree to <code class="highlighter-rouge">HEAD</code> into a modification stack called <em>stash</em>.</p>

<p>The changes can be applied to any branch afterwards.</p>

<p>This is a common operation when:</p>

<ul>
  <li>you are working on a branch, when a more urgent branch needs fixing, but you don’t want to create a commit just to save the current state</li>
  <li>you want to apply working tree modifications to another branch</li>
</ul>

<p>Push changes to the top of the stash:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git stash
</code></pre></div></div>

<p>List stash:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git stash list
</code></pre></div></div>

<p>Apply change at the top of the stash:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git stash apply
</code></pre></div></div>

<h2 id="for-each-ref">for-each-ref</h2>

<p>List all refs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git for-each-ref
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>54a4e1ccba10229e4ade6501cdaf2da74f68e97e commit refs/heads/master
295acc240d15982eba2969026054658164ad2c19 tag    refs/tags/a
54a4e1ccba10229e4ade6501cdaf2da74f68e97e commit refs/tags/l
</code></pre></div></div>

<p>Where:</p>

<ul>
  <li><code class="highlighter-rouge">master</code> is a branch</li>
  <li><code class="highlighter-rouge">a</code> is an annotated tag</li>
  <li><code class="highlighter-rouge">l</code> is an lightweight tag</li>
</ul>

<h2 id="merge">merge</h2>

<p>Is when you take two branches and make a new one that is child of both.</p>

<h3 id="merge-strategies">Merge strategies</h3>

<p>Git attempts to merge automatically using one of different merge strategies.</p>

<p>Some strategies may require user intervention, while others never do.</p>

<p>Some important strategies are:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">ours</code>: keeps local changes</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git merge -s ours ref
</code></pre></div>    </div>

    <p>Can be used on more than 2 branches.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">theirs</code>: keeps remote changes. Must be used with <code class="highlighter-rouge">-X</code> instead of <code class="highlighter-rouge">-s</code>, as discussed at:
<a href="http://stackoverflow.com/questions/173919/git-merge-s-ours-what-about-theirs">http://stackoverflow.com/questions/173919/git-merge-s-ours-what-about-theirs</a></p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git merge -X theirs ref
</code></pre></div>    </div>

    <p>Can be used on more than 2 branches.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">octopus</code>: able to merge more than 2 branches, but only if there are no conflicts.</p>

    <p>The generated commit will have multiple parents. E.g.:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   +--B
   |
A--+--C
   |
   +--D
</code></pre></div>    </div>

    <p>Then:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout B
git merge -Xoctopus C D
</code></pre></div>    </div>

    <p>Gives:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   +--B--+
   |     |
A--+--C--+--E
   |     |
   +--D--+
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="recursive-merge-strategy">Recursive merge strategy</h4>

<p>The default strategy.</p>

<p>Uses the <code class="highlighter-rouge">diff3</code> merge algorithm recursively.</p>

<p>The <code class="highlighter-rouge">diff3</code> algorithm takes 3 file versions as input: the base, and the two conflict heads.</p>

<p>If there is a single common ancestor for the conflict heads, it is the base.</p>

<p>If there are multiple, it recursively creates a new tree TODO details, leading up to a new virtual branch that will be the base. <code class="highlighter-rouge">man git</code> says that this tends to lead to less merge conflicts than directly using either ancestor.</p>

<p>E.g., start with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(A)----(B)----(C)-----(F)
        |      |       |
        |      |   +---+
        |      |   |
        |      +-------+
        |          |   |
        |      +---+   |
        |      |       |
        +-----(D)-----(E)
</code></pre></div></div>

<p>Then:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout E
git merge F
</code></pre></div></div>

<p>There are 2 best common ancestors, <code class="highlighter-rouge">C</code> and <code class="highlighter-rouge">D</code>. Git merges them into a new virtual branch <code class="highlighter-rouge">V</code>, and then uses <code class="highlighter-rouge">V</code> as the base.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(A)----(B)----(C)--------(F)
        |      |          |
        |      |      +---+
        |      |      |
        |      +----------+
        |      |      |   |
        |      +--(V) |   |
        |          |  |   |
        |      +---+  |   |
        |      |      |   |
        |      +------+   |
        |      |          |
        +-----(D)--------(E)
</code></pre></div></div>

<p>Example why it is a good choice: <a href="http://codicesoftware.blogspot.com/2011/09/merge-recursive-strategy.html">http://codicesoftware.blogspot.com/2011/09/merge-recursive-strategy.html</a></p>

<h3 id="conflicts">Conflicts</h3>

<h3 id="merge-conflicts">Merge conflicts</h3>

<p>Certain modifications can be made automatically, provided they are only done on one of the branches to be merged:</p>

<ul>
  <li>given line of non-binary file modified</li>
  <li>file added</li>
  <li>mode changed</li>
</ul>

<p>If all merges can be done automatically, then you are prompted for a commit message and the current HEAD branch advances automatically to a new commit. This type of simple merge is called fast-forward.</p>

<h4 id="text-conflicts">Text conflicts</h4>

<p>If a conflict happens happens on two regular text files <code class="highlighter-rouge">git merge</code> outputs either:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Auto-merging path/to/file.md
CONFLICT (content): Merge conflict in path/to/file.txt
</code></pre></div></div>

<p>if the file existed already, or:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Auto-merging path/to/file.md
CONFLICT (add/add): Merge conflict in path/to/file.txt
</code></pre></div></div>

<p>if two different files with the same path were created in the different branches.</p>

<p>The file on the working tree is modified to contain:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
    config.password_length = 1..128
=======
    config.password_length = 8..128
&gt;&gt;&gt;&gt;&gt;&gt;&gt; other-branch
</code></pre></div></div>

<p>and if you do <code class="highlighter-rouge">git status</code> you will either of:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>both modified: path/to/file.txt
both added: path/to/file.txt
</code></pre></div></div>

<p>To finish the merge you have to look into each file with a conflict, correct them, <code class="highlighter-rouge">git add</code> and then <code class="highlighter-rouge">git commit</code>.</p>

<p>To put the file into one of the two versions, you can do either:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout --ours filename
git checkout --theirs filename
</code></pre></div></div>

<p>This is the most common solution for binary file conflicts.</p>

<p>To go back to the merge conflict version with the <code class="highlighter-rouge">&lt;&lt;&lt;&lt;&lt;&lt; HEAD</code> markers you can do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout -m filename
</code></pre></div></div>

<p>See both branches and the base in a merge marker style:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout --conflict=diff3 filename
</code></pre></div></div>

<p>The file then becomes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; ours
int a = 1;
||||||| base
int a = 0;
=======
int a = 2;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; theirs
</code></pre></div></div>

<p>and <code class="highlighter-rouge">git diff</code> automatically shows a special diff mode called <em>combined diff</em> as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>++&lt;&lt;&lt;&lt;&lt;&lt;&lt; ours
 +int a = 1;
++||||||| base
++int a = 0;
++=======
+ int a = 2;
++&gt;&gt;&gt;&gt;&gt;&gt;&gt; theirs
</code></pre></div></div>

<p>In the case of <code class="highlighter-rouge">add/add</code> the base will be empty:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; ours
int a = 1;
||||||| base
=======
int a = 2;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; theirs
</code></pre></div></div>

<p>TODO: possible to <code class="highlighter-rouge">git checkout --base</code>?</p>

<p>Stop the merge resolution process and go back to previous state:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git merge --abort
</code></pre></div></div>

<h5 id="techniques-to-solve-text-conflicts">Techniques to solve text conflicts</h5>

<p>If the conflict is very simple, just do <code class="highlighter-rouge">git status</code>, and go on the conflicting files one by one on the default <code class="highlighter-rouge">checkout -m</code> style.</p>

<p>For slightly more complicated issues, the way to go is to decide what changed between the base and each conflicting side, and then try to incorporate both of those changes.</p>

<p>For simpler conflicts, <code class="highlighter-rouge">git checkout --conflict=diff3</code> may be enough.</p>

<p>If the conflict is larger however, you will want to do a diff between the base and each side with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git diff :1:./foo.txt :2:./foo.txt
git diff :1:./foo.txt :3:./foo.txt
</code></pre></div></div>

<p>See also:
<a href="http://stackoverflow.com/questions/8488365/git-compare-base-version-with-theirs-version-of-a-conflicted-file">http://stackoverflow.com/questions/8488365/git-compare-base-version-with-theirs-version-of-a-conflicted-file</a></p>

<h4 id="binary-conflicts">Binary conflicts</h4>

<p>Git does not do anything smart in the case of binary files: it is up to you to use the right tool to view the file and edit it to work.</p>

<p>You can use <code class="highlighter-rouge">checkout --ours</code> and <code class="highlighter-rouge">checkout --theirs</code> normally, <code class="highlighter-rouge">checkout --conflict=diff3</code> does not modify the file tree and outputs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>warning: Cannot merge binary files: conflict/binary-preview.png (ours vs. theirs)
</code></pre></div></div>

<h4 id="permission-conflicts">Permission conflicts</h4>

<h5 id="directory-file-conflict">Directory file conflict</h5>

<p>Appears as <code class="highlighter-rouge">CONFLICT (file/directory)</code> on <code class="highlighter-rouge">git merge</code>, and <code class="highlighter-rouge">both added</code> on <code class="highlighter-rouge">git status</code>,</p>

<p>If a file is changed into a directory with the same name, the working is left as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir-path
dir-path~other-branch
</code></pre></div></div>

<p>from the side that contains the directory, or:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir-path
dir-path~HEAD
</code></pre></div></div>

<p>from the side that contains the file.</p>

<p>If <code class="highlighter-rouge">dir-path~other-branch</code> already exists, another names is chosen from the first free name amongst:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir-path~other-branch_0
dir-path~other-branch_1
...
</code></pre></div></div>

<p><code class="highlighter-rouge">--ours</code> and <code class="highlighter-rouge">--theirs</code> are half broken since you cannot do <code class="highlighter-rouge">git checkout --ours dir-path</code> to the side that contains the directory: you have to reference the files it contains.</p>

<p><code class="highlighter-rouge">--conflict=diff3 -- path</code> fails with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error: path 'conflict/perms-dir' does not have all necessary versions
</code></pre></div></div>

<h5 id="symlink-file-conflict">Symlink file conflict</h5>

<p>Appears as <code class="highlighter-rouge">CONFLICT (add/add)</code> on <code class="highlighter-rouge">git merge</code>, and <code class="highlighter-rouge">both added</code> on <code class="highlighter-rouge">git status</code>, i.e., indistinguishable from regular file conflicts.</p>

<p>On the working tree, the file is always a regular file.</p>

<p><code class="highlighter-rouge">--ours</code> and <code class="highlighter-rouge">--theirs</code> work as expected.</p>

<p>Depending from which side you do <code class="highlighter-rouge">--conflict=diff3</code> it may generate a symlink pointing to a file path with conflict markers!</p>

<h3 id="merge-target-branch">Merge target branch</h3>

<p><a href="http://stackoverflow.com/questions/3216360/merge-update-and-pull-git-branches-without-using-checkouts">http://stackoverflow.com/questions/3216360/merge-update-and-pull-git-branches-without-using-checkouts</a></p>

<p>It is not possible to <code class="highlighter-rouge">git merge</code> into a target branch other than the current because if there were merge conflicts there would be no way to solve them.</p>

<p>If it is just a fast forward, you can use <code class="highlighter-rouge">fetch</code> instead:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git fetch origin master:target-branch
</code></pre></div></div>

<h3 id="ignore-certain-files-on-merge">Ignore certain files on merge</h3>

<p>Run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`git config merge.ours.driver true`
</code></pre></div></div>

<p>and use a <code class="highlighter-rouge">.gitattributes</code> as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file_to_ignore merge=ours
</code></pre></div></div>

<h3 id="squash">squash</h3>

<p>Create a single commit on top of the current branch, such that the new commit contains exactly what would be the contents of the merge.</p>

<p>Given:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(A)----(B)----(C)
        |      |
        |      master *
        |
        +-----(D)-----(E)
                       |
                       feature
</code></pre></div></div>

<p>After:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout master
git merge --squash feature
</code></pre></div></div>

<p>We get: TODO does the new commit have multiple parents?
Is the author of the feature credited in the <code class="highlighter-rouge">log</code>?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(A)----(B)----(C)-----(F)
        |              |
        |              master *
        |
        +-----(D)-----(E)
                       |
                       feature
</code></pre></div></div>

<h3 id="programmatically-check-if-mergeable">Programmatically check if mergeable</h3>

<p><a href="http://stackoverflow.com/questions/501407/is-there-a-git-merge-dry-run-option">http://stackoverflow.com/questions/501407/is-there-a-git-merge-dry-run-option</a></p>

<h3 id="resolve-merge-conflicts">Resolve merge conflicts</h3>

<p>To resolve merge conflicts, you have to <code class="highlighter-rouge">git add file</code>.</p>

<p>There are several techniques that help you to find what is the correct resolution.</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">git diff topic...master</code>: show only changes that happened on <code class="highlighter-rouge">master</code> after <code class="highlighter-rouge">topic</code> branched out, and which are therefore the cause of the conflict. Useful, since usually you know what you have changed, and you need to know what others have changed since.</p>

    <p>This is specified in <code class="highlighter-rouge">man git-diff</code>. The notation resembles that of commit sets, of <code class="highlighter-rouge">man gitrevisions</code>, but this is a special since diff operates two commits, not commit sets.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">mergetool</code> open an external conflict resolution tool, possibly GUI</p>
  </li>
</ul>

<h2 id="merge-file">merge-file</h2>

<p>Plumbing command that runs a 3-way merge on the three given input files.</p>

<p>It is therefore a subset of the more complex <code class="highlighter-rouge">merge</code> recursive operation, which generates all the required files by checkout and runs on all required files.</p>

<h2 id="merge-base">merge-base</h2>

<p>Plumbing command that finds a best common ancestor commit between two candidates, thus suitable for a 3-way merge.</p>

<p>A common ancestor is better than another if it is a descendant of the other.</p>

<p>It is possible to have multiple best common ancestors. For example, both <code class="highlighter-rouge">C</code> and <code class="highlighter-rouge">D</code> are best common ancestors of <code class="highlighter-rouge">E</code> and <code class="highlighter-rouge">F</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(A)----(B)----(C)----------(D)
        |      |            |
        |      |            |
        |      |            |
        |      +-----(E)    |
        |             |     |
        |             |     |
        |             |     |
       (F)------------+-----+
</code></pre></div></div>

<p>Output all merge bases with <code class="highlighter-rouge">-a</code> instead of just one:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git merge-base -a E F
</code></pre></div></div>

<h2 id="mergetool">mergetool</h2>

<p>Start running a conflict resolution tool, typically a 3-way merge tool to solve all merge conflicts for the merge the is currently taking place:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git mergetool -t vimdiff
git mergetool -t kdiff3
</code></pre></div></div>

<p>Resolve conflicts on a single file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git mergetool -t kdiff3 -- file
</code></pre></div></div>

<p>Git already knows about certain tools, and you must choose amongst them.</p>

<p>Git checks out all necessary versions in current directory with basename prefixes, and calls the merge tool on them.</p>

<p>If the tool is not given, Git uses:</p>

<ul>
  <li><code class="highlighter-rouge">git config --global merge.tool kdiff3</code> configuration option tool</li>
  <li>a suitable tool found in the path</li>
</ul>

<h3 id="prompt">prompt</h3>

<p>Before opening the merge tool, by default git prompts you to enter a key to open it.</p>

<p>To avoid that use either:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global mergetool.prompt false
</code></pre></div></div>

<p>or for a single invocation:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git mergetool -y
</code></pre></div></div>

<h3 id="keepbackup">keepBackup</h3>

<p>Git generates 3 temporary files which it passes to the 3-merge tool for each conflicting file:</p>

<ul>
  <li>the parent, before conflicting changes were made</li>
  <li>each conflicting child</li>
</ul>

<p>You then have to save the output on the merge resolution tool.</p>

<p>After the merge, Git keeps by default the original file with the conflict markers with a <code class="highlighter-rouge">.orig</code> extension.</p>

<p>To prevent that, do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global mergetool.keepBackup false
</code></pre></div></div>

<h2 id="email-patches">Email patches</h2>

<p>Tools only used in projects that exchange patches via email, not in those that use web interfaces like GitHub.</p>

<h3 id="am">am</h3>

<p>TODO</p>

<h2 id="archive">archive</h2>

<p>Generate an archive file from a repository at a given version.</p>

<p>Possible way to generate source code distribution releases at an specific version while omitting history.</p>

<p>Make a source code release for version 1.2.3:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git archive --format zip -o output-1.2.3.zip 1.2.3
</code></pre></div></div>

<p>Generates a file called <code class="highlighter-rouge">output-1.2.3.zip</code> containing the code.</p>

<h2 id="ls-remote">ls-remote</h2>

<p>List remote references:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git ls-remote origin
git ls-remote https://github.com/gitlabhq/gitlabhq
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>e46b644a8857a53ed3f6c3f64b224bb74b06fd8e    refs/heads/6-9-stable
ec8d39897c76439c71b79738c5a348b36a03753b    refs/heads/master
4647177cb5d7d8c13f28c79a91ff2894353d25e9    refs/pull/999/head
5de75111249e1b06a03ff140c95b49dc06f7521c    refs/pull/999/merge
52d771167707552d8e2a50f602c669e2ad135722    refs/tags/v1.0.1
7b5799a97998b68416f1b6233ce427135c99165a    refs/tags/v1.0.1^{}
</code></pre></div></div>

<ul>
  <li>
    <p><code class="highlighter-rouge">^{}</code> is explained in <code class="highlighter-rouge">man gitrevisions</code>: dereference tags until a non-tag is found (remember that tags can tag anything, including other tags)</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">7b5799a97998b68416f1b6233ce427135c99165a</code> is the SHA-1 of the tag object</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">52d771167707552d8e2a50f602c669e2ad135722</code> is the SHA-1 for the actual commit, which is most likely to interest you.</p>
  </li>
</ul>

<h2 id="protocols">Protocols</h2>

<h3 id="sources">Sources</h3>

<p><code class="highlighter-rouge">Documentation/technical</code></p>

<p><a href="http://git-scm.com/book/en/v2/Git-Internals-Transfer-Protocols">http://git-scm.com/book/en/v2/Git-Internals-Transfer-Protocols</a></p>

<h3 id="update-server-info">update-server-info</h3>

<p>Generate extra files required by the dumb client under <code class="highlighter-rouge">/info</code>, including <code class="highlighter-rouge">info/refs</code>.</p>

<hr />

<p>Git supports the following transfer protocols:</p>

<ul>
  <li>local</li>
  <li>file://</li>
  <li>HTTP dumb</li>
  <li>HTTP smart</li>
  <li>SSH</li>
  <li>Git</li>
</ul>

<p>If you can connect via SSH to a computer as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh username@host
</code></pre></div></div>

<p>Then you can do git operations as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git username@host:/path/to/repo
</code></pre></div></div>

<p>GitHub git repo directories always end in <code class="highlighter-rouge">.git</code>, but this is just a convention. Also, in GitHub there is a single Git user called <code class="highlighter-rouge">git</code>.</p>

<p>Other methods of connection include:</p>

<h2 id="http">HTTP</h2>

<p>Works over URLs of type <code class="highlighter-rouge">http://</code> or <code class="highlighter-rouge">https://</code>. There are two types of HTTP: dumb and smart.</p>

<p>One advantage of the HTTP protocols is that it is easy to control access for them from web applications, which have wide support for HTTP authentication methods.</p>

<h3 id="dumb-http">Dumb HTTP</h3>

<p>Works directly from a file tree served directly, but inefficient.</p>

<p>At first enabled by GitHub, but disabled at some point of its history.</p>

<p>TODO: why does:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd repository
python -m SimpleHTTPServer
cd
git clone localhost:8000
git clone localhost:8000/.git
</code></pre></div></div>

<p>fail? Related for push: <a href="http://stackoverflow.com/questions/15974286/pushing-to-a-git-repository-hosted-locally-over-http">http://stackoverflow.com/questions/15974286/pushing-to-a-git-repository-hosted-locally-over-http</a></p>

<h3 id="smart-http">Smart HTTP</h3>

<p>The server needs Git specific knowledge. More efficient.</p>

<p>For HTTP, authentication is done by giving an username password from the command line.</p>

<p>Git can remember the credentials for a given amount of time so you don’t have to re-enter them.</p>

<p>Credentials can be managed with <code class="highlighter-rouge">git credential</code> and family.</p>

<p>The first step is to list the available references:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://github.com/cirosantilli/test.git/info/refs?service=git-upload-pack
</code></pre></div></div>

<p>The head is something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: application/x-git-upload-pack-advertisement
...
</code></pre></div></div>

<p>And the body is the output of <code class="highlighter-rouge">git-upload-pack</code>.</p>

<p>Now make the request as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>printf 'POST /cirosantilli/test.git/git-upload-pack HTTP/1.0\r
Host: github.com\r
Accept: application/x-git-upload-pack-result\r
\r
0032want 4883d362e99ed5cdd51dfacfb17152eae29734cd
00000009done
' | ncat --ssl github.com 443
</code></pre></div></div>

<p>TODO get working. This returns 200 with an empty body (contains only <code class="highlighter-rouge">0</code> with <code class="highlighter-rouge">Transfer-Encoding: chunked</code>). Worked on a local Grack:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>printf 'POST /tests/example/test_repo/git-upload-pack HTTP/1.0\r
Content-Type: application/x-git-upload-pack-request\r
Host: 127.0.0.1:9292\r
\r
0032want cb067e06bdf6e34d4abebf6cf2de85d65a52c65e
00000009done
' | nc 127.0.0.1 9292
</code></pre></div></div>

<p>Here is the hexdump of <code class="highlighter-rouge">git clone http://127.0.0.1:9292/tests/example/test_repo/</code> on the Grack test repository https://github.com/schacon/grack/tree/613acd237ab7f522a02953c310aad0d484873bd7/tests/example obtained with Wireshark. It only contains the data request and reply: the initial advertisement was made before that and was omitted.</p>

<p>Git request sent:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /tests/example/test_repo/git-upload-pack HTTP/1.1
User-Agent: git/1.9.1
Host: 127.0.0.1:9292
Accept-Encoding: gzip
Content-Type: application/x-git-upload-pack-request
Accept: application/x-git-upload-pack-result
Content-Length: 190

007fwant cb067e06bdf6e34d4abebf6cf2de85d65a52c65e multi_ack_detailed no-done side-band-64k thin-pack ofs-delta agent=git/1.9.1
0032want cb067e06bdf6e34d4abebf6cf2de85d65a52c65e
00000009done
</code></pre></div></div>

<p>TODO why was the same <code class="highlighter-rouge">want</code> line requested twice?</p>

<p>Hexdump (heading TCP data removed):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0040        50 4f 53 54 20 2f 74 65 73 74 73 2f 65 78     POST /tests/ex
0050  61 6d 70 6c 65 2f 74 65 73 74 5f 72 65 70 6f 2f   ample/test_repo/
0060  67 69 74 2d 75 70 6c 6f 61 64 2d 70 61 63 6b 20   git-upload-pack 
0070  48 54 54 50 2f 31 2e 31 0d 0a 55 73 65 72 2d 41   HTTP/1.1..User-A
0080  67 65 6e 74 3a 20 67 69 74 2f 31 2e 39 2e 31 0d   gent: git/1.9.1.
0090  0a 48 6f 73 74 3a 20 31 32 37 2e 30 2e 30 2e 31   .Host: 127.0.0.1
00a0  3a 39 32 39 32 0d 0a 41 63 63 65 70 74 2d 45 6e   :9292..Accept-En
00b0  63 6f 64 69 6e 67 3a 20 67 7a 69 70 0d 0a 43 6f   coding: gzip..Co
00c0  6e 74 65 6e 74 2d 54 79 70 65 3a 20 61 70 70 6c   ntent-Type: appl
00d0  69 63 61 74 69 6f 6e 2f 78 2d 67 69 74 2d 75 70   ication/x-git-up
00e0  6c 6f 61 64 2d 70 61 63 6b 2d 72 65 71 75 65 73   load-pack-reques
00f0  74 0d 0a 41 63 63 65 70 74 3a 20 61 70 70 6c 69   t..Accept: appli
0100  63 61 74 69 6f 6e 2f 78 2d 67 69 74 2d 75 70 6c   cation/x-git-upl
0110  6f 61 64 2d 70 61 63 6b 2d 72 65 73 75 6c 74 0d   oad-pack-result.
0120  0a 43 6f 6e 74 65 6e 74 2d 4c 65 6e 67 74 68 3a   .Content-Length:
0130  20 31 39 30 0d 0a 0d 0a 30 30 37 66 77 61 6e 74    190....007fwant
0140  20 63 62 30 36 37 65 30 36 62 64 66 36 65 33 34    cb067e06bdf6e34
0150  64 34 61 62 65 62 66 36 63 66 32 64 65 38 35 64   d4abebf6cf2de85d
0160  36 35 61 35 32 63 36 35 65 20 6d 75 6c 74 69 5f   65a52c65e multi_
0170  61 63 6b 5f 64 65 74 61 69 6c 65 64 20 6e 6f 2d   ack_detailed no-
0180  64 6f 6e 65 20 73 69 64 65 2d 62 61 6e 64 2d 36   done side-band-6
0190  34 6b 20 74 68 69 6e 2d 70 61 63 6b 20 6f 66 73   4k thin-pack ofs
01a0  2d 64 65 6c 74 61 20 61 67 65 6e 74 3d 67 69 74   -delta agent=git
01b0  2f 31 2e 39 2e 31 0a 30 30 33 32 77 61 6e 74 20   /1.9.1.0032want 
01c0  63 62 30 36 37 65 30 36 62 64 66 36 65 33 34 64   cb067e06bdf6e34d
01d0  34 61 62 65 62 66 36 63 66 32 64 65 38 35 64 36   4abebf6cf2de85d6
01e0  35 61 35 32 63 36 35 65 0a 30 30 30 30 30 30 30   5a52c65e.0000000
01f0  39 64 6f 6e 65 0a                                 9done.
</code></pre></div></div>

<p>Reply (de-chunked C-style backslash escapes body):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: application/x-git-upload-pack-result
Transfer-Encoding: chunked
Connection: close
Server: thin 1.6.1 codename Death Proof

0008NAK
0046\2Counting objects: 3, done.
Total 3 (delta 0), reused 3 (delta 0)
00e0\1PACK
</code></pre></div></div>

<p>The rest of the body contained binary data given by the following hexdump:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0050           50 41 43 4b 00 00 00 02 00 00 00 03 99      PACK.........
0060  0b 78 9c 9d cb 41 0e c2 20 10 40 d1 3d a7 98 bd   .x...A.. .@.=...
0070  09 99 29 08 6d 62 8c 0b 5d bb f1 02 50 a6 69 13   ..).mb..]...P.i.
0080  90 a6 0e d1 e3 db 78 04 77 ff 2d be 6c cc 60 28   ......x.w.-.l.`(
0090  79 c3 d1 0e 64 43 9f 52 74 63 44 b6 21 4d dd 11   y...dC.RtcD.!M..
00a0  bd f7 e4 88 a8 9f 06 54 a1 c9 5c 37 b8 86 77 80   .......T..\7..w.
00b0  7b 61 91 0a a7 b4 43 d7 1f 2e eb bc 64 dd 9a 7e   {a....C.....d..~
00c0  e6 33 90 f1 d8 a1 f3 48 70 d8 03 d5 58 4b 59 44   .3.....Hp...XKYD
00d0  f8 df 5f 3d f8 25 70 fb 84 b2 66 56 5f a0 9f 38   .._=.%p...fV_..8
00e0  7e a0 02 78 9c 33 34 30 30 33 31 51 28 49 2d 2e   ~..x.340031Q(I-.
00f0  61 38 c7 68 a6 ca cc bd e2 f6 4a b6 ef 61 d3 ea   a8.h......J..a..
0100  e7 cd 59 3c c5 cd 0b 00 a3 c4 0b dd 36 78 9c cb   ..Y&lt;........6x..
0110  48 cd c9 c9 e7 02 00 08 4b 02 1f 38 34 30 b8 ad   H.......K..840..
0120  e1 b0 f1 72 cf 4e a5 79 2c 4e 1a 9e f8 ec 30 30   ...r.N.y,N....00
0130  30 36 01 2f 30 30 30 30                           06./0000
</code></pre></div></div>

<p>which is likely the packfile.</p>

<p>Line 2:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Counting objects: 3, done.
Total 3 (delta 0), reused 3 (delta 0)
</code></pre></div></div>

<p>is what git outputs on the command line as a server reply.</p>

<h4 id="http-backend">http-backend</h4>

<p>CGI script that implements smart HTTP, so you can run it on any server that supports CGI.</p>

<p>It is a wrapper interface for <code class="highlighter-rouge">git-upload-pack</code> and <code class="highlighter-rouge">git-receive-pack</code>.</p>

<h4 id="grack">Grack</h4>

<p><a href="https://github.com/schacon/grack">https://github.com/schacon/grack</a></p>

<p>Grack is a Rack based alternate implementation of <code class="highlighter-rouge">git-http-backend</code> in pure Ruby.</p>

<p>It was / is used by GitHub and GitLab 7.0,
as it is much easier to integrate in a Rails project, since it can be accessed
as a library.</p>

<p>To start the test, simply:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rackup
</code></pre></div></div>

<p>and then:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone http://localhost:9292/tests/example/test_repo/
</code></pre></div></div>

<h2 id="ssh-protocol">SSH protocol</h2>

<p>Git works out of the box if you have SSH.</p>

<p>On the server, just add the user’s public keys under <code class="highlighter-rouge">/home/git/.ssh/authorized_keys</code>.</p>

<p>Not the users can simply to:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone ssh://user@server.com/path/to/project.git
</code></pre></div></div>

<p>which git allows to simplify to:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone user@server.com/path/to/project.git
</code></pre></div></div>

<p>Note that every user will be logged in as the <code class="highlighter-rouge">git</code> user.</p>

<p>The problem with this method is that it allows people to start shells on you server, which you might not want, e.g. on a public server like GitHub. Solutions include using the <code class="highlighter-rouge">git-shell</code> login shell and <code class="highlighter-rouge">authorized_keys</code> <code class="highlighter-rouge">command</code> option.</p>

<h3 id="git-shell-login-shell">git-shell login shell</h3>

<p>If you set the login shell of the Git user to <code class="highlighter-rouge">git-shell</code>, an executable that comes with Git, it runs a restricted shell that only allows the git operation to be done.</p>

<h3 id="authorized_keys-command-option">authorized_keys command` option</h3>

<p>See <code class="highlighter-rouge">man authorized_keys</code> for the details.</p>

<p>This only allows the given command to be run when the Git user logs in, which allows you to write an arbitrary access control script.</p>

<p>This is how GitLab 7.0 works, the script being inside GitLab Shell.</p>

<h2 id="git-protocol">Git protocol</h2>

<p>Git specific protocol with URLs of form <code class="highlighter-rouge">git://</code>.</p>

<p>Happens over SSH, so you need to add you SSH key on the server. TODO check.</p>

<p>Does not have built-in authentication, or any simple way to do it.</p>

<h3 id="git-daemon">git daemon</h3>

<p>Standalone server that implements the git protocol.</p>

<h2 id="authentication">Authentication</h2>

<p>Git has mechanisms to store you authentication so you don’t have to type in username / password pairs every time.</p>

<p>The mechanism to be used is stored under:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global credential.helper
</code></pre></div></div>

<p>Git has a few built-in mechanisms, see:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man gitcredentials
</code></pre></div></div>

<p>for the documentation. Currently, there is:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">cache</code>, which uses <code class="highlighter-rouge">git credential-cache</code>, and stores the password only for a given amount of time. The default is 15 minutes.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">store</code>, which uses <code class="highlighter-rouge">git credential-store</code>, stores the password on disk forever, so it’s less safe.</p>
  </li>
</ul>

<h3 id="credential">credential</h3>

<p>TODO</p>

<h3 id="cache">cache</h3>

<h3 id="credential-cache">credential-cache</h3>

<p>Configure the timeout:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global credential.helper "cache --timeout=0"
</code></pre></div></div>

<h3 id="store">store</h3>

<h3 id="credential-store">credential-store</h3>

<p>TODO</p>

<p><code class="highlighter-rouge">.git-credential-cache/socket</code></p>

<h3 id="send-pack">send-pack</h3>

<p>Plumbing for <code class="highlighter-rouge">git push</code>.</p>

<p>Invokes <code class="highlighter-rouge">git receive-pack</code> on the remote.</p>

<h3 id="fetch-pack">fetch-pack</h3>

<p>Plumbing of <code class="highlighter-rouge">git clone</code> and other operations that retrieve server data.</p>

<p>Invokes <code class="highlighter-rouge">git upload-pack</code> on the remote.</p>

<h3 id="receive-pack">receive-pack</h3>

<p>TODO</p>

<h3 id="upload-pack">upload-pack</h3>

<p>If you run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git upload-pack .
</code></pre></div></div>

<p>on a Git repository, it returns something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>001e# service=git-upload-pack
000000e74883d362e99ed5cdd51dfacfb17152eae29734cd HEAD\0multi_ack thin-pack side-band side-band-64k ofs-delta shallow no-progress include-tag multi_ack_detailed no-done symref=HEAD:refs/heads/master agent=git/2:2.1.3+github-642-g667ea60
003f4883d362e99ed5cdd51dfacfb17152eae29734cd refs/heads/master
003ba90828ca4b50a7064a650915b2d0bf2bc642aab0 refs/tags/1.0
0000
</code></pre></div></div>

<p>and then hangs, where <code class="highlighter-rouge">\0</code> is a literal NUL character.</p>

<ul>
  <li>
    <p>Each line, e.g. that for <code class="highlighter-rouge">master</code> is prefixed by a 4 byte length of the entire line, including the 4 bytes of the length and the trailing newline.</p>

    <p>E.g.:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>printf '4883d362e99ed5cdd51dfacfb17152eae29734cd refs/heads/master' | wc -c
</code></pre></div>    </div>

    <p>says <code class="highlighter-rouge">58</code>, and <code class="highlighter-rouge">003f</code> is <code class="highlighter-rouge">63</code> (plus the 4 bytes of the length and the trailing newline).</p>

    <p>The only exception is line 2, whose length has 8 bytes <code class="highlighter-rouge">000000e7</code>, including the NUL character up to the newline</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">multi_ack</code>, <code class="highlighter-rouge">thin-pack</code>, etc. are the upload pack capabilities as documented at <code class="highlighter-rouge">Documentation/technical/protocol-capabilities.txt</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">0000</code> at the end says it’s the end of the request.</p>

    <p>It can never happen anywhere else, since no line can be smaller than 4 bytes.</p>
  </li>
</ul>

<p>TODO:</p>

<ul>
  <li>
    <p>why the <code class="highlighter-rouge">#</code> on line 1?</p>
  </li>
  <li>
    <p>why the <code class="highlighter-rouge">HEAD</code> on the first line is separated by a NUL character from the options?</p>
  </li>
  <li>
    <p>what is <code class="highlighter-rouge">symref</code> ?</p>
  </li>
  <li>
    <p>what is <code class="highlighter-rouge">+github-642-g667ea60</code> ?</p>
  </li>
</ul>

<p>TODO</p>

<h2 id="bare">bare</h2>

<p>A bare repository is one that:</p>

<ul>
  <li>
    <p>only contains files that are inside <code class="highlighter-rouge">.git</code>: in particular, it has no working tree nor index.</p>
  </li>
  <li>
    <p>has <code class="highlighter-rouge">core.bare</code> set to <code class="highlighter-rouge">true</code>. This option is set automatically by commands that create repositories: <code class="highlighter-rouge">init</code> and <code class="highlighter-rouge">clone</code> will leave it on <code class="highlighter-rouge">false</code>, while <code class="highlighter-rouge">clone --bare</code> will set it to <code class="highlighter-rouge">true</code>.</p>

    <p>Because of this configuration variable you cannot directly push to the <code class="highlighter-rouge">.git</code> of a repository created with <code class="highlighter-rouge">git init</code>.</p>
  </li>
</ul>

<p>This is what GitHub stores for you: no need to store the files also!</p>

<p>There are some operations that you can only do/cannot do on a bare repo:</p>

<ul>
  <li>
    <p>you can only push to a bare repo if pushing to the checked out branch.</p>

    <p>This means that using git to deploy a project requires a bare repository on the server + a post commit hook that will update the tree where desired.</p>
  </li>
  <li>
    <p>you cannot to any operation that involves the working tree from a bare repo, including <code class="highlighter-rouge">pull</code></p>
  </li>
</ul>

<p>To create a bare repo from scratch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git init --bare
</code></pre></div></div>

<p>To create a bare repo that is a clone of another repo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone --bare other
</code></pre></div></div>

<h3 id="current-branch">Current branch</h3>

<p>The active or current branch of a bare repository is what its <code class="highlighter-rouge">HEAD</code> points to.</p>

<p>This has the following effects:</p>

<ul>
  <li><code class="highlighter-rouge">clone</code> automatically checks out one of the branches which are on the same ref as the <code class="highlighter-rouge">HEAD</code></li>
  <li>when deleting remotes with <code class="highlighter-rouge">git push remote --delete branch</code>, it is not possible to delete the current remote.</li>
  <li>it is the branch that GitHub shows by default.</li>
</ul>

<p>It is not possible to use <code class="highlighter-rouge">checkout</code> on a remote branch since checkout also acts on the working tree. You must use <code class="highlighter-rouge">update-ref</code> or better <code class="highlighter-rouge">symbolic-ref</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git update-ref   HEAD &lt;hash&gt;
git symbolic-ref HEAD refs/heads/something
</code></pre></div></div>

<p>As of 1.8.4, there seems to be no way to conveniently change the current remote branch: <a href="http://stackoverflow.com/questions/1485578/how-do-i-change-a-git-remote-head-to-point-to-something-besides-master">http://stackoverflow.com/questions/1485578/how-do-i-change-a-git-remote-head-to-point-to-something-besides-master</a></p>

<h2 id="pull">pull</h2>

<p><code class="highlighter-rouge">pull</code> is exactly the same as fetch + merge on given branch and merges with current branch.</p>

<p><code class="highlighter-rouge">pull --rebase</code> does <code class="highlighter-rouge">rebase</code> instead of <code class="highlighter-rouge">merge</code>. You need that after someone did a <code class="highlighter-rouge">push -f</code>.</p>

<p>Does not update remote heads like fetch does.</p>

<h3 id="basic-usage">Basic usage</h3>

<p>State of the remote:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(A)----(B)----(C)----(H)
               |      |
               |      master *
               |
               +-----(E)
                      |
                      feature
</code></pre></div></div>

<p>Your repo after a clone:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone path/to/repo

(A)----(B)----(C)----(D)
               |      |
               |      master *
               |      origin/master
               |
               +-----(E)
                      |
                      origin/feature
</code></pre></div></div>

<p>New state of the remote:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(A)----(B)----(C)----(D)----(H)
               |             |
               |             master *
               |
               +-----(E)----(F)--------(G)
                                        |
                                        feature
</code></pre></div></div>

<p>Local repo after a <code class="highlighter-rouge">merge</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git pull origin master

(A)----(B)----(C)----(D)--------(H)
               |                 |
               |                 master *
               |                 origin/master
               |
               +-----(E)--------(F)--------(G)
                      |                     |
                      feature               origin/feature
</code></pre></div></div>

<p>So you current branch <code class="highlighter-rouge">master</code> has been merged into the branch <code class="highlighter-rouge">master</code> from repo <code class="highlighter-rouge">origin</code>.</p>

<h2 id="permissions">Permissions</h2>

<h2 id="file-permissions">File permissions</h2>

<p>Git can only store a few UNIX permissions and file types.</p>

<p>Git uses the same data as UNIX numeric permissions to store the subset of permissions it allows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0100000000000000 (040000): Directory
1000000110100100 (100644): Regular non-executable file
1000000111101101 (100755): Regular executable file
1010000000000000 (120000): Symbolic link
1110000000000000 (160000): Gitlink (submodule)
</code></pre></div></div>

<p>It also has one special notation not present in UNIX for the Git specific concept of submodule.</p>

<p>There is also another permission mentioned <a href="https://github.com/gitster/git/blob/9d02150cf4d833935161ef265e4dc03807caa800/fsck.c#L188">in the source code</a>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1000000110110100 (100664): Regular non-executable group-writeable file
</code></pre></div></div>

<p>but a comment says that it is only for backwards compatibility, and it is only enabled if <code class="highlighter-rouge">strict</code> is true (TODO how to set that?). That mode is not tracked by default.</p>

<p>Those permissions are visible on the output of certain porcelain commands like <code class="highlighter-rouge">diff</code>,
so knowing them is not just internals.</p>

<p>Taken from: <a href="http://stackoverflow.com/questions/737673/how-to-read-the-mode-field-of-git-ls-trees-output">http://stackoverflow.com/questions/737673/how-to-read-the-mode-field-of-git-ls-trees-output</a></p>

<p>Therefore, the only permissions that can be kept are executable and group write.</p>

<p>TODO why is group right here and not most other permissions? Is there an important use case?</p>

<p>How to get around it: <a href="http://stackoverflow.bcom/questions/3207728/retaining-file-permissions-with-git">http://stackoverflow.bcom/questions/3207728/retaining-file-permissions-with-git</a>.</p>

<p>The best solution seems to be the <code class="highlighter-rouge">git-cache-meta</code> third-party tool.</p>

<h3 id="symlinks">Symlinks</h3>

<p>Git stores represents symlinks on the same <code class="highlighter-rouge">struct</code> that it stores regular files except that:</p>

<ul>
  <li>the permission is <code class="highlighter-rouge">120000</code> instead of <code class="highlighter-rouge">644</code> and <code class="highlighter-rouge">755</code> which are used for files.</li>
  <li>the content is the destination path. Note that this is not in general how symlink destinations are stored in all filesystems. E.g., ext3 stores symlinks directly in the inode, not with file contents.</li>
</ul>

<p>On clone, git reads it’s internal data in the repository, recreates the working tree using the type of symlinks supported by the local filesystem, just like it does for directories for example.</p>

<h2 id="empty-directories">Empty directories</h2>

<p><a href="http://stackoverflow.com/questions/115983/add-empty-directory-to-git-repository">http://stackoverflow.com/questions/115983/add-empty-directory-to-git-repository</a></p>

<p>Although Git can represent empty directories through the empty tree object, the reference implementation ignores such directories for most commands, so you should never rely on them.</p>

<p>To force git to keep a dir, add a file to it.</p>

<p>Popular possibilities are:</p>

<ul>
  <li><code class="highlighter-rouge">README</code> file explaining why the dir is there after all. Best option.</li>
  <li><code class="highlighter-rouge">.gitkeep</code> file. It has absolutely no special meaning for Git, but is a common convention.</li>
</ul>

<h2 id="replace">replace</h2>

<p>Magic mechanism to alter a single commit anywhere in the repository without affecting history, (if you change a commit in the middle of the repository, it’s parent SHA changes, so you have to change it’s children and so on).</p>

<p>Works because for every <code class="highlighter-rouge">git</code> command without <code class="highlighter-rouge">--no-replace-objects</code> Git looks at a separate list of replacements kept under <code class="highlighter-rouge">.git/refs/replace</code>.</p>

<h2 id="filter-branch">filter-branch</h2>

<p>Mass history rewrite using arbitrary Bash function.</p>

<p>Like any mass modification operations: <strong>make a backup before you start</strong>.</p>

<p>By default acts on current branch only. To act on all branches do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git-filter-branch [options] -- --all
</code></pre></div></div>

<p>Correct the name of one of the authors:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OLD_NAME=""
NEW_NAME=""
NEW_EMAIL=""
git filter-branch --commit-filter '
    if [ "$GIT_COMMITTER_NAME" = "'"$OLD_NAME"'" ]; then
        GIT_COMMITTER_NAME="'"$NEW_NAME"'";
        GIT_AUTHOR_NAME="$GIT_COMMITTER_NAME";
        GIT_COMMITTER_EMAIL="'"$NEW_EMAIL"'";
        GIT_AUTHOR_EMAIL="$GIT_COMMITTER_EMAIL";
        git commit-tree "$@";
    else
        git commit-tree "$@";
    fi' HEAD
</code></pre></div></div>

<h3 id="committer-vs-author">Committer vs author</h3>

<p>The author is who actually wrote the commit.</p>

<p>The committer is who committed it on behalf of the author.</p>

<p>It is usually the same person in most cases, but they might differ when:</p>

<p>One important case where committer and author differ is in projects where patches are generated by <code class="highlighter-rouge">git format-patch</code>, sent by email, and applied by another person with <code class="highlighter-rouge">git am</code>. In that case, the committer is taken from the local configuration, while the authors comes from the patch, so nothing special needs to be done about it.</p>

<p>With web interfaces like GitHub, which hold all the repositories on a single machine and apply patches with <code class="highlighter-rouge">git merge</code>, this is not necessary: the commit appears directly on history, in addition to the merge commit. This is the case for most modern projects.</p>

<h2 id="rerere">rerere</h2>

<p>Reuse merge strategies from previous merges.</p>

<h2 id="hooks">hooks</h2>

<p>Take an action whenever something happens (a commit for example).</p>

<p>Create a hook, just add an executable file with a known hook name under <code class="highlighter-rouge">.git/hooks/</code>.</p>

<p>This executable may receive command line arguments which Git uses to pass useful info to the executable.</p>

<p>Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd .git/hooks/
echo '#!/usr/bin/env bash

echo abc' &gt; post-commit
chmod +x post-commit
</code></pre></div></div>

<p>Now whenever you commit, you will see <code class="highlighter-rouge">abc</code> on the terminal!</p>

<p>See: <a href="http://git-scm.com/book/en/Customizing-Git-Git-Hooks">http://git-scm.com/book/en/Customizing-Git-Git-Hooks</a> for other hook names.</p>

<p>When hooks are executed on the remote they echo on the local shell as: <code class="highlighter-rouge">remote: &lt;stdout&gt;</code>.</p>

<p>Hooks are not transmitted on clone.</p>

<p>There are not global hooks. The best one can do is either:</p>

<ul>
  <li>set up <code class="highlighter-rouge">init.templatedir</code> with the desired hooks. But if you ever modify them, you have to modify each existing project…</li>
  <li>add the <code class="highlighter-rouge">hooks</code> to the repository itself on a <code class="highlighter-rouge">.git-hooks</code> directory and require one extra setup action from developers. Probably the least bad option.</li>
</ul>

<h3 id="path-gotcha">PATH gotcha</h3>

<p>Git automatically changes the <code class="highlighter-rouge">PATH</code> in hooks, which may lead to unexpected effects, in particular if you rely on dependency management systems like RVM or virtualenv: <a href="http://permalink.gmane.org/gmane.comp.version-control.git/258454">http://permalink.gmane.org/gmane.comp.version-control.git/258454</a></p>

<h3 id="pre-receive">pre-receive</h3>

<p>If returns false, commit is aborted. This can be used to enforce push permissions, which is exactly what GitLab is doing.</p>

<p>The stdin contains the inputs which are of the form:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;old-value&gt; SP &lt;new-value&gt; SP &lt;ref-name&gt; LF
</code></pre></div></div>

<p>e.g.:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0000000000000000000000000000000000000000 1111111111111111111111111111111111111111 refs/heads/master
</code></pre></div></div>

<h2 id="rev-parse">rev-parse</h2>

<p>Some useful commands to automate Git.</p>

<p>Get full path of repo root:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rev-parse --show-toplevel
</code></pre></div></div>

<p>Get relative path to the top level:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rev-parse --show-cdup
</code></pre></div></div>

<p>Path to <code class="highlighter-rouge">.git</code> dir:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rev-parse --git-dir
</code></pre></div></div>

<h2 id="rev-list">rev-list</h2>

<p>Lists commit objects.</p>

<h3 id="list-all-objects">List all objects</h3>

<p><a href="http://stackoverflow.com/questions/7348698/git-how-to-list-all-objects-in-the-database">http://stackoverflow.com/questions/7348698/git-how-to-list-all-objects-in-the-database</a></p>

<p>Good approximation: list all objects reachable from <code class="highlighter-rouge">refs</code> (including trees and blobs):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rev-list --objects --all
</code></pre></div></div>

<h2 id="var">var</h2>

<p>Show values of Git configuration variables and all Git-specific environment variables:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git var
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote.origin.url=git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*
branch.master.remote=origin
branch.master.merge=refs/heads/master
GIT_COMMITTER_IDENT=Your Name &lt;you.@gmail.com&gt; 1410298645 +0200
GIT_AUTHOR_IDENT=Your Name &lt;you@gmail.com&gt; 1410298645 +0200
GIT_EDITOR=/usr/bin/vim
GIT_PAGER=less -r
</code></pre></div></div>

<h2 id="gitattributes">gitattributes</h2>

<p>Good tutorial: <a href="http://git-scm.com/book/en/v2/Customizing-Git-Git-Attributes">http://git-scm.com/book/en/v2/Customizing-Git-Git-Attributes</a></p>

<p>Configs that apply only to specific paths, not the entire repo.</p>

<p>It can be put at:</p>

<ul>
  <li><code class="highlighter-rouge">.gitattributes</code> file in any directory of the working tree</li>
  <li><code class="highlighter-rouge">.git/info/attributes</code></li>
</ul>

<p>Examples:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*.md diff=word
</code></pre></div></div>

<p>Always ignore remote version of certain files on merge run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config merge.ours.driver true
</code></pre></div></div>

<p>and then use <code class="highlighter-rouge">.gitattributes</code> lines like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path/to/file merge=ours
</code></pre></div></div>

<p>Other interesting stuff:</p>

<ul>
  <li>index clean and smudge, including the built-in <code class="highlighter-rouge">ident</code> smudge.</li>
  <li><code class="highlighter-rouge">archive</code> customization, including smudge-like effects</li>
</ul>

<h2 id="gc">gc</h2>

<p>Tries to optimize the way git stores files internally.</p>

<p>Mnemonic: Garbage Collection. This is classic when talking about garbage collection of programming languages.</p>

<p>Runs several different plumbing commands to do that. TODO which?</p>

<p>Can considerably reduce the size of the repository:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git gc
</code></pre></div></div>

<p>Some commands automatically run <code class="highlighter-rouge">git gc</code>. When this is done depends on the value of the <code class="highlighter-rouge">gc.auto</code> configuration.</p>

<p>TODO what does that do exactly? Possible use case: <a href="http://stackoverflow.com/questions/1072171/how-do-you-remove-an-invalid-remote-branch-reference-from-git">http://stackoverflow.com/questions/1072171/how-do-you-remove-an-invalid-remote-branch-reference-from-git</a> By default it does:</p>

<ul>
  <li><code class="highlighter-rouge">repack</code> + <code class="highlighter-rouge">git prune-packed</code></li>
</ul>

<h2 id="plumbing">Plumbing</h2>

<h2 id="porcelain">Porcelain</h2>

<p>Plumbing commands are low level, porcelain are high level and more commonly used, built upon plumbing commands.</p>

<p>The distinction is made on <code class="highlighter-rouge">man git</code> itself, which classifies commands as such.</p>

<p>When using Git programmatically, plumbing commands should be used instead of porcelain, since their interface is more stable. Quoting <code class="highlighter-rouge">man git</code>:</p>

<blockquote>
  <p>The interface (input, output, set of options and the semantics) to these low-level commands are meant to be a lot more stable than Porcelain level commands, because these commands are primarily for scripted use. The interface to Porcelain commands on the other hand are subject to change in order to improve the end user experience.</p>
</blockquote>

<h2 id="git-options">git options</h2>

<p>Options that apply directly to <code class="highlighter-rouge">git</code> and therefore can be used with any subcommand.</p>

<p>Set path to a custom working tree and bare repository (like a <code class="highlighter-rouge">.git</code> directory in a working tree):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git --work-tree='repo.git' --work-tree='repo' status
</code></pre></div></div>

<h2 id="contrib">contrib</h2>

<p>Under the git source tree there is a directory called contrib which includes features that are not yet part of the main distribution, but are being considered.</p>

<p>Any information contained on this section is more volatile than the others.</p>

<p>Since these commands are so recent, they may not be installed with the Git version that comes from your package manager.</p>

<p>Git subcommands must be available as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/lib/git-core/git-SUBCOMMAND_NAME_NO_EXTENSION
</code></pre></div></div>

<p>for example as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/lib/git-core/git-tag
</code></pre></div></div>

<p>Other commands may simply need to be in the PATH.</p>

<h3 id="subtree">subtree</h3>

<p>Split a directory of a repository into another repository.</p>

<p><em>Maintains</em> history in the new repository.</p>

<p>Great tutorial: <a href="http://stackoverflow.com/a/17864475/895245">http://stackoverflow.com/a/17864475/895245</a></p>

<p>Install:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p ~/bin &amp;&amp; cd ~/bin &amp;&amp; wget -O git-subtree https://raw.githubusercontent.com/git/git/master/contrib/subtree/git-subtree.sh &amp;&amp; chmod +x git-subtree
sudo ln -s git-subtree /usr/lib/git-core/git-subtree
</code></pre></div></div>

<p>Create a new branch containing only commits that affected the given directory, and put the subdirectory at the root of the repo on that branch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git subtree split -P &lt;subdirectory&gt; -b &lt;new-branch&gt;
</code></pre></div></div>

<p>History of the large repository is untouched.</p>

<p>The <code class="highlighter-rouge">&lt;subdirectory&gt;</code> directory may still exist because of gitignored files it contains.</p>

<p>To extract it just:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ..
git clone &lt;big-repo&gt; -b &lt;new-branch&gt; &lt;new-repo&gt;
cd &lt;new-repo&gt;
git branch -m &lt;new-branch&gt; master
</code></pre></div></div>

<p>And don’t forget to clean up the big directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch -D &lt;new-branch&gt;
git rm -r &lt;subdirectory&gt;
rm -rf &lt;subdirectory&gt;
</code></pre></div></div>

<p>You also probably want to reuse part of the <code class="highlighter-rouge">.gitignore</code> and other top-level git config files from the larger directory.</p>

<h3 id="diff-highlight">diff-highlight</h3>

<p><code class="highlighter-rouge">git diff --word-diff=color</code> is probably better than this when you are sure that you want a word diff for a file: the advantage of this solution is that it works well for both prose and programming languages.</p>

<p>Highlight which parts of a line were modified, similar to by most web interfaces today.</p>

<p><img src="diff-highlight.png" alt="diff-highlight" /></p>

<p>It does a regular line-wise diff, but highlights the words changed between two lines.</p>

<p>It is simply a Perl script, and you can install it with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/bin &amp;&amp; curl -O https://raw.github.com/git/git/master/contrib/diff-highlight/diff-highlight &amp;&amp; chmod +x diff-highlight
git config --global pager.log 'diff-highlight | less'
git config --global pager.show 'diff-highlight | less'
git config --global pager.diff 'diff-highlight | less'
</code></pre></div></div>

<p>Now when using <code class="highlighter-rouge">git diff --color</code>, this will work automatically.</p>

<h2 id="third-party-tools">Third party tools</h2>

<h3 id="tig">tig</h3>

<p>Powerful curses gitk written in C: <a href="https://github.com/jonas/tig">https://github.com/jonas/tig</a>.</p>

<p>Install Ubuntu 12.04:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo aptitude install tig
</code></pre></div></div>

<p>Manpages:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man tig
man tigrc
</code></pre></div></div>

<p>And help inside tig:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>h
</code></pre></div></div>

<h4 id="views">Views</h4>

<p>Tig has many views:</p>

<ul>
  <li>log (initial view)</li>
  <li>branches</li>
  <li>tree (directory)</li>
  <li>blob (file)</li>
</ul>

<p>The bindings you can use depend on which view you are currently on.</p>

<p>For instance, it only makes sense to view a blame <code class="highlighter-rouge">B</code> if you are either on a tree or blob view.</p>

<p>There is currently no <code class="highlighter-rouge">remotes</code> view: <a href="https://github.com/jonas/tig/issues/199">https://github.com/jonas/tig/issues/199</a></p>

<h4 id="generic">Generic</h4>

<p>General mappings:</p>

<ul>
  <li><code class="highlighter-rouge">Space</code>: one screen down</li>
  <li><code class="highlighter-rouge">b</code>: one screen up</li>
  <li><code class="highlighter-rouge">H</code>: see a list of branches.</li>
</ul>

<h4 id="refs-tig">Refs tig</h4>

<p>These bindings are available on views that shows revisions such as the log view or the branches view.</p>

<ul>
  <li><code class="highlighter-rouge">C</code>: checkout to the commit.</li>
  <li><code class="highlighter-rouge">&lt;enter&gt;</code>: open a list of the commits inline.</li>
</ul>

<h4 id="blob">Blob</h4>

<ul>
  <li><code class="highlighter-rouge">e</code>: open file in editor. Default: <code class="highlighter-rouge">vim</code>.</li>
  <li><code class="highlighter-rouge">B</code>: blame view of file
    <ul>
      <li><code class="highlighter-rouge">Enter</code>: open <code class="highlighter-rouge">log -p</code> of current line’s commit inline.</li>
    </ul>
  </li>
</ul>

<h3 id="fugitive">fugitive</h3>

<p>Vim plug-in with large overlap with tig functionality: <a href="https://github.com/tpope/vim-fugitive">https://github.com/tpope/vim-fugitive</a></p>

<h3 id="fame">fame</h3>

<p>Get stats on file / line and commit percents per author.</p>

<p>Home: <a href="https://github.com/oleander/git-fame-rb">https://github.com/oleander/git-fame-rb</a></p>

<p>Install:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem install git_fame
</code></pre></div></div>

<p>Usage:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git fame
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+------------------------+--------+---------+-------+--------------------+
| name                   | loc    | commits | files | distribution       |
+------------------------+--------+---------+-------+--------------------+
| Johan Sørensen         | 22,272 | 1,814   | 414   | 35.3 / 41.9 / 20.2 |
| Marius Mathiesen       | 10,387 | 502     | 229   | 16.5 / 11.6 / 11.2 |
| Jesper Josefsson       | 9,689  | 519     | 191   | 15.3 / 12.0 / 9.3  |
| Ole Martin Kristiansen | 6,632  | 24      | 60    | 10.5 / 0.6 / 2.9   |
| Linus Oleander         | 5,769  | 705     | 277   | 9.1 / 16.3 / 13.5  |
| Fabio Akita            | 2,122  | 24      | 60    | 3.4 / 0.6 / 2.9    |
| August Lilleaas        | 1,572  | 123     | 63    | 2.5 / 2.8 / 3.1    |
| David A. Cuadrado      | 731    | 111     | 35    | 1.2 / 2.6 / 1.7    |
| Jonas Ängeslevä        | 705    | 148     | 51    | 1.1 / 3.4 / 2.5    |
| Diego Algorta          | 650    | 6       | 5     | 1.0 / 0.1 / 0.2    |
| Arash Rouhani          | 629    | 95      | 31    | 1.0 / 2.2 / 1.5    |
| Sofia Larsson          | 595    | 70      | 77    | 0.9 / 1.6 / 3.8    |
| Tor Arne Vestbø        | 527    | 51      | 97    | 0.8 / 1.2 / 4.7    |
| spontus                | 339    | 18      | 42    | 0.5 / 0.4 / 2.0    |
| Pontus                 | 225    | 49      | 34    | 0.4 / 1.1 / 1.7    |
+------------------------+--------+---------+-------+--------------------+
</code></pre></div></div>

<h3 id="browse-remote">browse remote</h3>

<p>Open current remote on browser.</p>

<p>Smart: considers current branch / revision. More intelligent than <code class="highlighter-rouge">hub browse</code>.</p>

<p>Home: <a href="https://github.com/motemen/git-browse-remote">https://github.com/motemen/git-browse-remote</a></p>

<p>Install:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem install git-browse-remote
</code></pre></div></div>

<p>Usage:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git browse-remote
</code></pre></div></div>

<h3 id="git-cache-meta">git-cache-meta</h3>

<p>Save and apply all UNIX permissions. Git only keeps <code class="highlighter-rouge">x</code> and symlink bits.</p>

<p>Save all permissions to file <code class="highlighter-rouge">.git_cache_meta</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git-cache-meta --store
</code></pre></div></div>

<p>Apply permissions after clone:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git-cache-meta --apply
</code></pre></div></div>

<p>Not sure who wrote it originally, but there are some Gists containing the script:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/bin
wget https://gist.githubusercontent.com/andris9/1978266/raw/git-cache-meta.sh
chmod +x git-cache-meta.sh
</code></pre></div></div>

<p>One downside is that this script always stores file owner, but when publishing a file to other users, we are only interested in storing read write permissions.</p>

<p>The situation is complicated because sometimes we do want the owner to be kept: e.g. when a file must be owned by <code class="highlighter-rouge">root</code>.</p>

<h2 id="implementations">Implementations</h2>

<p>The git repository data format and transfer protocols have had other implementations besides the original Git implementations. As of December 2014, the most preeminent are:</p>

<ul>
  <li>libgit2</li>
  <li>JGit</li>
</ul>

<h3 id="libgit2">libgit2</h3>

<p><a href="https://github.com/libgit2/libgit2">https://github.com/libgit2/libgit2</a></p>

<p>Reimplementation of the Git core methods. Differences from Git:</p>

<ul>
  <li>
    <p>meant to be used from a C directly as a linked library: does not have a native command line interface</p>
  </li>
  <li>
    <p>is GPLv2 with linking exception: proprietary projects can link to it unmodified.</p>

    <p>This is the perfect move for GitHub, since it forces other companies to merge back if they want to modify it, this improving the software.</p>

    <p>Git is pure GPLv2.</p>
  </li>
</ul>

<p>It uses the exact same <code class="highlighter-rouge">.git</code> repository format as Git.</p>

<p>Has bindings in many higher level languages like Rugged for Ruby. This is one of the greatest things about libgit2: since it implements a C interface, other languages will just have wrappers around it, making all those other libraries more uniform, thus easier to learn, and less buggy.</p>

<p>Its development was started and is strongly backed by GitHub which uses it internally. Its license is more open than Git’s, as it can be used by proprietary software if not modified.</p>

<p>libgit2 has reused a small portion of the code in the original Git source from authors that allowed the new license: <a href="http://stackoverflow.com/questions/17151597/which-code-is-shared-between-the-original-git-and-libgit2">http://stackoverflow.com/questions/17151597/which-code-is-shared-between-the-original-git-and-libgit2</a> It is worth noting that many major authors have allowed such usage, including Linus and Hamano.</p>

<p>It was designed to replace the Ruby Grit library which initially powered GitHub. Grit only parsed Git output from stdin, so it is much slower than the new native C implementation of libgit2 which works directly with the repository.</p>

<h3 id="jgit">JGit</h3>

<p><a href="https://eclipse.org/jgit/">https://eclipse.org/jgit/</a></p>

<p>Pure Java implementation.</p>

<p>Developed in the context of the Eclipse project.</p>

<h2 id="test-repos">Test repos</h2>

<p>Use those to test stuff.</p>

<p>They can be generated with the <code class="highlighter-rouge">generate-test-repos.sh</code> script</p>

<p>They are described here.</p>

<h3 id="0">0</h3>

<p>2 files uncommitted</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a b
cat a
    #a1
cat b
    #b1
git status
    #untracked: a b
</code></pre></div></div>

<h3 id="0du">0du</h3>

<p>Same as <code class="highlighter-rouge">0</code>, but with an untracked subdir <code class="highlighter-rouge">d</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a b d
ls d
    #a b
cat d/a
    #da
cat d/b
    #db

git status
    #untracked: a b d/
</code></pre></div></div>

<h3 id="1">1</h3>

<p>Same as <code class="highlighter-rouge">0</code>, but committed.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a b
cat a
    #a1
cat b
    #b1
git status
    #no changes

(1)
 |
 master
</code></pre></div></div>

<h3 id="1d">1d</h3>

<p>Same as <code class="highlighter-rouge">0d</code>, but with all tracked.</p>

<h3 id="1u">1u</h3>

<p>Same as <code class="highlighter-rouge">1</code>, but one untracked file <code class="highlighter-rouge">c</code> added.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a b c
cat a
    #a1
cat b
    #b1
cat c
    #c1

git status
    #untracked: c

(1)
 |
 master
 HEAD
</code></pre></div></div>

<h3 id="1ub">1ub</h3>

<p>Same as <code class="highlighter-rouge">1ub</code> + one branch.</p>

<p>Current branch is <code class="highlighter-rouge">master</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a b c
cat a
    #a1
cat b
    #b1
cat c
    #c1

git status
    #untracked: c

(1)
 |
 master *
 b
</code></pre></div></div>

<h3 id="2">2</h3>

<p>2 commits and 2 files committed.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a b
cat a
    #a1
    #a2
cat b
    #b1
    #b2

git status
    #no changes

(1)-----(2)
         |
         HEAD
         master
</code></pre></div></div>

<h3 id="2u">2u</h3>

<p>Same as <code class="highlighter-rouge">2</code> + 1 file uncommitted.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a b c
cat a
    #a1
    #a2
cat b
    #b1
    #b2
cat c
    #c1
    #c2

git status
    #untracked: c

(1)-----(2)
         |
         HEAD
         master
</code></pre></div></div>

<h3 id="2b">2b</h3>

<p>Two branches unmerged, no uncommitted files.</p>

<p>Tree:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)-----(2)
 |       |
 |       master *
 |
 +------(b2)
         |
         b
</code></pre></div></div>

<p>Files:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout master

ls
    #a b c
cat a
    #a1
cat b
    #b1
cat c
    #c1

git checkout b

ls
    #a b c
cat a
    #a1
    #a2
cat b
    #
cat d
    #d1
</code></pre></div></div>

<h3 id="3">3</h3>

<p>3 commits 2 files.</p>

<p>Looks like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a b
cat a
    #a1
    #a2
    #a3
cat b
    #b1
    #b2
    #b3

git status
    #no changes

(1)-----(2)-----(3)
                 |
                 master *
</code></pre></div></div>

<h3 id="0bare">0bare</h3>

<p>Bare repo.</p>

<h3 id="multi">multi</h3>

<p>Contains multiple repos for inter repo tests.</p>

<p>It looks just like the GitHub fork model.</p>

<p>The repos are:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
    #a ao b bo
</code></pre></div></div>

<p>Where:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">a</code>: original local repository</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">ao</code>: bare uploaded repository of <code class="highlighter-rouge">a</code>.</p>

    <p><code class="highlighter-rouge">origin</code> of <code class="highlighter-rouge">a</code> and <code class="highlighter-rouge">bo</code>, <code class="highlighter-rouge">upstream</code> of <code class="highlighter-rouge">b</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">bo</code>: remote fork of <code class="highlighter-rouge">ao</code>.</p>

    <p>Origin of <code class="highlighter-rouge">b</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">b</code>: local clone of fork.</p>
  </li>
</ul>

<p>Also:</p>

<ul>
  <li><code class="highlighter-rouge">a</code> has a branch <code class="highlighter-rouge">master</code> and a branch <code class="highlighter-rouge">b</code></li>
</ul>

<h3 id="multiu">multiu</h3>

<p>Like <code class="highlighter-rouge">multi</code>, but both master branches have committed unmerged modifications.</p>

<h3 id="min-sane">min-sane</h3>

<p>Minimal, sane, deterministic repository.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git init
touch a
git add .
date='2000-01-01T00:00:00+0000'
GIT_COMMITTER_NAME='a' GIT_COMMITTER_EMAIL='a' GIT_COMMITTER_DATE="$date" \
  git commit -m a --author 'a &lt;a&gt;' --date="$date"
</code></pre></div></div>

<p>Since this repository is deterministic,
you will want to have the following object SHAs in mind:</p>

<ul>
  <li><code class="highlighter-rouge">07cd7fe596afc90d9a2c9f7ae30b6b9e7a7b3760</code>: commit</li>
  <li><code class="highlighter-rouge">496d6428b9cf92981dc9495211e6e1120fb6f2ba</code>: tree</li>
  <li><code class="highlighter-rouge">e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</code>: empty blob</li>
</ul>


        </main>
      </div>
      <footer>
        <p>Content licence: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> unless otherwise noted on the article.</p>
        <p>Website powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a> and <a href="https://pages.github.com/">GitHub Pages</a>. Source at: <a href="https://github.com/cirosantilli/cirosantilli.github.io">https://github.com/cirosantilli/cirosantilli.github.io</a></p>
        <p>To contact me publicly about any general subject, including saying hi or suggestions about this website, please <a href="https://github.com/cirosantilli/cirosantilli.github.io/issues/new">create a GitHub issue in the cirosantilli.github.io repo</a>.</p>
        <p>
          For comments about China, please first read
          <a href="https://github.com/cirosantilli/china-dictatorship#faq">the FAQ</a> and
          <a href="https://github.com/cirosantilli/china-dictatorship/blob/master/CONTRIBUTING.md">the CONTRIBUTING</a> and then
          <a href="https://github.com/cirosantilli/china-dictatorship/issues/new">create a GitHub issue in the china-dictatorship repo</a>.
        </p>
        <p>If you absolutely need private contact, extract my email from my GitHub repos or use LinkedIn.</p>
        <p>
          <a href="https://en.wikipedia.org/wiki/Disqus">Disqus comments</a> were removed from this website in 2019-05-04,
          a manual dump is <a href="/disqus-archive/">available here</a>.
          <a href="https://github.com/cirosantilli/cirosantilli.github.io/tree/fee98be02a34d5d4ccf829c4df89f1a5140881fc#why-i-removed-disqus-comments-from-the-website-in-2019-05-04">Rationale</a>.
        </p>
        <p>Opinions and content are my own, not my employer's.</p>
      </footer>
        
    </div>
    <!-- Scripts -->
      <!--data table-->
        <script src="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js" ></script>
        <script>
          $('.data-table').dataTable({
            //"aaSorting": [[0,'asc'], [1,'asc'], [2, 'asc'], [3, 'asc']],
            "aaSorting": [],
            "bFilter": false,
            "bInfo": false,
            "bPaginate": false
          });
        </script>
      <!--mathjax-->
        <script
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
        ></script>
        <script>
          MathJax.Hub.Config({
              jax: ["input/TeX","output/HTML-CSS"],
              displayAlign: "left",
              displayIndent: "20px"
          });
        </script>
      <!--google analytics-->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-47867706-1', 'auto');
          ga('require', 'displayfeatures');
          ga('send', 'pageview');

        </script>
  </body>
</html>
