<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
        MySQL Cheat -
      
      Ciro Santilli
    </title>
    
    <link rel="shortcut icon" type="image/x-icon" href="https://www.gravatar.com/avatar/c979bd881b6755f84947a5a8ecc7c6f7.png" />
    <!-- #jquery. Must come *before* all its many dependencies. -->
      <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <!-- #bootstrap -->
      <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet"/>
      <script src="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <!-- #data table -->
      <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css"/>
      <style>
        table.dataTable tr.odd { background-color: white; }
        table.dataTable tr.even { background-color: white; }
        table.dataTable tr.odd td.sorting_1 { background-color: white; }
        table.dataTable tr.odd td.sorting_2 { background-color: white; }
        table.dataTable tr.odd td.sorting_3 { background-color: white; }
        table.dataTable tr.even td.sorting_1 { background-color: white; }
        table.dataTable tr.even td.sorting_2 { background-color: white; }
        table.dataTable tr.even td.sorting_3 { background-color: white; }
      </style>
    <!-- #font awesome font icons -->
      <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"/>
    <!-- Custom styles and scripts. Come at end to use and override libraries. -->
      <!--<script src="/assets/main.js"></script>-->
      <link rel="stylesheet" href="/assets/main.css"/>
      <link rel="stylesheet" href="/assets/header-link.css"/>
      <link rel="stylesheet" href="/assets/syntax.css"/>
  </head>
  <body>
    <header>
      <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header ">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Ciro Santilli</a>
          </div>
          <div class="collapse navbar-collapse" id="navbar">
            <ul class="nav navbar-nav">
              
              <li >
                <a href="/articles" title="">Articles</a>
              </li>
              
              <li >
                <a href="/projects" title="">Projects</a>
              </li>
              
              <li >
                <a href="/skills" title="">Skills</a>
              </li>
              
              <li >
                <a href="/interests" title="">Interests</a>
              </li>
              
              <li >
                <a href="/education" title="">Education</a>
              </li>
              
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <div class="article-and-sidebar">
      <div class="content">
        <aside>
          <div>
            <a href="/">
              <img style="width:100%;" src="/assets/me.jpg" alt="">
            </a>
          </div>
          <div>
            <a class="nav" href="https://stackoverflow.com/users/895245"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
            <a class="nav" href="https://github.com/cirosantilli"><i class="fa fa-github fa-fw"></i>GitHub</a>
            <a class="nav" href="https://www.linkedin.com/in/cirosantilli"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
            <a class="nav" href="https://www.youtube.com/channel/UCBrJjpKMpdrkA1VsAiR2wEg"><i class="fa fa-youtube fa-fw"></i>YouTube</a>
            <a class="nav" href="https://twitter.com/cirosantilli"><i class="fa fa-twitter fa-fw"></i>Twitter</a>
            
            <a class="nav" href="https://www.zhihu.com/people/cirosantilli/activities"><i class="fa fa-question-circle fa-fw"></i>Zhihu 知乎</a>
            <a class="nav" href="https://www.weibo.com/p/1005055601627311"><i class="fa fa-weibo fa-fw"></i>Weibo 微博</a>
            
            <a class="nav" href="/accounts"><i class="fa fa-ellipsis-h fa-fw"></i>Other accounts</a>
          </div>
          <div>
            
            
            
            
            
            <a class="nav" href="https://github.com/cirosantilli/db/issues/new?title=MySQL+Cheat%20-%20">
              <i class="fa fa-exclamation-circle fa-fw"></i>Report Issue
            </a>
          </div>
        </aside>
        <main>
          <h1 class="page-title">MySQL Cheat</h1>
          
          
          <ol id="markdown-toc">
  <li><a href="#server" id="markdown-toc-server">Server</a></li>
  <li><a href="#interfaces" id="markdown-toc-interfaces">Interfaces</a>    <ol>
      <li><a href="#mysql-utility" id="markdown-toc-mysql-utility">mysql utility</a>        <ol>
          <li><a href="#login" id="markdown-toc-login">Login</a></li>
          <li><a href="#use-modes" id="markdown-toc-use-modes">Use modes</a></li>
          <li><a href="#output-format" id="markdown-toc-output-format">Output format</a></li>
        </ol>
      </li>
      <li><a href="#phpmyadmin" id="markdown-toc-phpmyadmin">phpmyadmin</a></li>
      <li><a href="#api" id="markdown-toc-api">API</a></li>
    </ol>
  </li>
  <li><a href="#help" id="markdown-toc-help">Help</a></li>
  <li><a href="#newlines" id="markdown-toc-newlines">Newlines</a></li>
  <li><a href="#semicolon" id="markdown-toc-semicolon">Semicolon</a></li>
  <li><a href="#comments" id="markdown-toc-comments">Comments</a></li>
  <li><a href="#structure" id="markdown-toc-structure">Structure</a></li>
  <li><a href="#command-case" id="markdown-toc-command-case">Command case</a></li>
  <li><a href="#quotation-types" id="markdown-toc-quotation-types">Quotation types</a></li>
  <li><a href="#error-logging" id="markdown-toc-error-logging">Error logging</a></li>
  <li><a href="#literal-values" id="markdown-toc-literal-values">Literal values</a>    <ol>
      <li><a href="#strings" id="markdown-toc-strings">Strings</a></li>
      <li><a href="#numeric-types" id="markdown-toc-numeric-types">Numeric types</a></li>
      <li><a href="#boolean-types" id="markdown-toc-boolean-types">Boolean types</a></li>
      <li><a href="#true" id="markdown-toc-true">TRUE</a></li>
      <li><a href="#false" id="markdown-toc-false">FALSE</a></li>
      <li><a href="#null-literal" id="markdown-toc-null-literal">NULL literal</a></li>
      <li><a href="#literal-tables" id="markdown-toc-literal-tables">Literal tables</a></li>
    </ol>
  </li>
  <li><a href="#identifiers" id="markdown-toc-identifiers">Identifiers</a></li>
  <li><a href="#special-databases" id="markdown-toc-special-databases">Special databases</a></li>
  <li><a href="#users" id="markdown-toc-users">Users</a></li>
  <li><a href="#flush" id="markdown-toc-flush">FLUSH</a></li>
  <li><a href="#database" id="markdown-toc-database">DATABASE</a>    <ol>
      <li><a href="#use" id="markdown-toc-use">USE</a></li>
    </ol>
  </li>
  <li><a href="#table-operations" id="markdown-toc-table-operations">Table operations</a>    <ol>
      <li><a href="#create-table" id="markdown-toc-create-table">CREATE TABLE</a>        <ol>
          <li><a href="#default-create-table" id="markdown-toc-default-create-table">DEFAULT create table</a></li>
        </ol>
      </li>
      <li><a href="#create-table-select" id="markdown-toc-create-table-select">CREATE TABLE SELECT</a></li>
      <li><a href="#drop-table" id="markdown-toc-drop-table">DROP TABLE</a>        <ol>
          <li><a href="#show-create-table" id="markdown-toc-show-create-table">SHOW CREATE TABLE</a></li>
        </ol>
      </li>
      <li><a href="#alter" id="markdown-toc-alter">ALTER</a></li>
      <li><a href="#table-modifiers" id="markdown-toc-table-modifiers">table modifiers</a></li>
      <li><a href="#indexes" id="markdown-toc-indexes">Indexes</a>        <ol>
          <li><a href="#using" id="markdown-toc-using">USING</a></li>
          <li><a href="#index-data-structure" id="markdown-toc-index-data-structure">Index data structure</a></li>
          <li><a href="#index-name" id="markdown-toc-index-name">Index name</a></li>
          <li><a href="#fulltext" id="markdown-toc-fulltext">FULLTEXT</a></li>
          <li><a href="#show-index" id="markdown-toc-show-index">SHOW INDEX</a></li>
        </ol>
      </li>
      <li><a href="#engine" id="markdown-toc-engine">Engine</a></li>
      <li><a href="#temporary-table" id="markdown-toc-temporary-table">TEMPORARY TABLE</a>        <ol>
          <li><a href="#drop-temporary" id="markdown-toc-drop-temporary">DROP TEMPORARY</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#column-operations" id="markdown-toc-column-operations">Column operations</a>    <ol>
      <li><a href="#data-types" id="markdown-toc-data-types">Data types</a>        <ol>
          <li><a href="#int-types" id="markdown-toc-int-types">Int types</a>            <ol>
              <li><a href="#int-overflow" id="markdown-toc-int-overflow">INT overflow</a></li>
            </ol>
          </li>
          <li><a href="#decimal" id="markdown-toc-decimal">DECIMAL</a></li>
          <li><a href="#bit" id="markdown-toc-bit">BIT</a></li>
          <li><a href="#bool" id="markdown-toc-bool">BOOL</a></li>
          <li><a href="#boolean" id="markdown-toc-boolean">BOOLEAN</a></li>
          <li><a href="#date" id="markdown-toc-date">DATE</a></li>
          <li><a href="#datetime" id="markdown-toc-datetime">DATETIME</a></li>
          <li><a href="#timestamp" id="markdown-toc-timestamp">TIMESTAMP</a></li>
          <li><a href="#char" id="markdown-toc-char">CHAR</a></li>
          <li><a href="#varchar" id="markdown-toc-varchar">VARCHAR</a></li>
          <li><a href="#binary" id="markdown-toc-binary">BINARY</a></li>
          <li><a href="#blob" id="markdown-toc-blob">BLOB</a></li>
          <li><a href="#text" id="markdown-toc-text">TEXT</a></li>
        </ol>
      </li>
      <li><a href="#null" id="markdown-toc-null">NULL</a>        <ol>
          <li><a href="#null-and-operators" id="markdown-toc-null-and-operators">NULL and operators</a>            <ol>
              <li><a href="#is-null" id="markdown-toc-is-null">IS NULL</a></li>
              <li><a href="#is-not-null" id="markdown-toc-is-not-null">IS NOT NULL</a></li>
            </ol>
          </li>
        </ol>
      </li>
      <li><a href="#type-conversion" id="markdown-toc-type-conversion">Type conversion</a></li>
      <li><a href="#column-constraints" id="markdown-toc-column-constraints">Column constraints</a>        <ol>
          <li><a href="#not-null" id="markdown-toc-not-null">NOT NULL</a></li>
          <li><a href="#default" id="markdown-toc-default">DEFAULT</a></li>
          <li><a href="#check" id="markdown-toc-check">CHECK</a></li>
          <li><a href="#auto_increment" id="markdown-toc-auto_increment">AUTO_INCREMENT</a></li>
          <li><a href="#zerofill" id="markdown-toc-zerofill">ZEROFILL</a></li>
        </ol>
      </li>
      <li><a href="#get-column-description" id="markdown-toc-get-column-description">Get column description</a>        <ol>
          <li><a href="#show-columns-from" id="markdown-toc-show-columns-from">SHOW COLUMNS FROM</a></li>
          <li><a href="#describe" id="markdown-toc-describe">DESCRIBE</a></li>
          <li><a href="#desc" id="markdown-toc-desc">DESC</a></li>
          <li><a href="#show-full-columns" id="markdown-toc-show-full-columns">SHOW FULL COLUMNS</a></li>
        </ol>
      </li>
      <li><a href="#character-set" id="markdown-toc-character-set">Character set</a></li>
      <li><a href="#charset" id="markdown-toc-charset">CHARSET</a></li>
      <li><a href="#collation" id="markdown-toc-collation">COLLATION</a></li>
      <li><a href="#column-limitations" id="markdown-toc-column-limitations">Column limitations</a></li>
    </ol>
  </li>
  <li><a href="#row-operations" id="markdown-toc-row-operations">Row operations</a>    <ol>
      <li><a href="#insert" id="markdown-toc-insert">INSERT</a>        <ol>
          <li><a href="#insert-without-any-values" id="markdown-toc-insert-without-any-values">Insert without any values</a></li>
          <li><a href="#insert-default-row" id="markdown-toc-insert-default-row">Insert default row</a></li>
          <li><a href="#ignore" id="markdown-toc-ignore">IGNORE</a></li>
        </ol>
      </li>
      <li><a href="#update" id="markdown-toc-update">UPDATE</a></li>
      <li><a href="#select-for-update" id="markdown-toc-select-for-update">SELECT FOR UPDATE</a></li>
      <li><a href="#delete" id="markdown-toc-delete">DELETE</a></li>
      <li><a href="#truncate" id="markdown-toc-truncate">TRUNCATE</a></li>
      <li><a href="#union" id="markdown-toc-union">UNION</a></li>
    </ol>
  </li>
  <li><a href="#variables" id="markdown-toc-variables">Variables</a>    <ol>
      <li><a href="#ssv" id="markdown-toc-ssv">SSV</a></li>
      <li><a href="#server-system-variables" id="markdown-toc-server-system-variables">Server system variables</a>        <ol>
          <li><a href="#show-variables" id="markdown-toc-show-variables">SHOW VARIABLES</a></li>
          <li><a href="#set-variables" id="markdown-toc-set-variables">SET variables</a></li>
          <li><a href="#variable-types" id="markdown-toc-variable-types">Variable types</a></li>
        </ol>
      </li>
      <li><a href="#variables-1" id="markdown-toc-variables-1">Variables</a></li>
      <li><a href="#user-variables" id="markdown-toc-user-variables">User variables</a></li>
      <li><a href="#user-defined-variable" id="markdown-toc-user-defined-variable">User defined variable</a></li>
    </ol>
  </li>
  <li><a href="#functions-and-operators" id="markdown-toc-functions-and-operators">Functions and operators</a>    <ol>
      <li><a href="#arithmetic-operators" id="markdown-toc-arithmetic-operators">Arithmetic operators</a></li>
      <li><a href="#in" id="markdown-toc-in">IN</a></li>
      <li><a href="#between" id="markdown-toc-between">BETWEEN</a></li>
      <li><a href="#like" id="markdown-toc-like">LIKE</a></li>
      <li><a href="#newlines-1" id="markdown-toc-newlines-1">Newlines</a></li>
      <li><a href="#backslash-escapes" id="markdown-toc-backslash-escapes">Backslash escapes</a></li>
      <li><a href="#regexp" id="markdown-toc-regexp">REGEXP</a></li>
      <li><a href="#replace" id="markdown-toc-replace">REPLACE</a></li>
      <li><a href="#reverse" id="markdown-toc-reverse">REVERSE</a></li>
      <li><a href="#soundex" id="markdown-toc-soundex">SOUNDEX</a></li>
      <li><a href="#sounds-like" id="markdown-toc-sounds-like">SOUNDS LIKE</a></li>
      <li><a href="#greatest" id="markdown-toc-greatest">GREATEST</a></li>
      <li><a href="#control-flow-functions" id="markdown-toc-control-flow-functions">Control flow functions</a>        <ol>
          <li><a href="#if" id="markdown-toc-if">IF</a></li>
          <li><a href="#iff" id="markdown-toc-iff">IFF</a></li>
        </ol>
      </li>
      <li><a href="#aggregate-functions" id="markdown-toc-aggregate-functions">Aggregate functions</a>        <ol>
          <li><a href="#max" id="markdown-toc-max">MAX</a></li>
          <li><a href="#avg" id="markdown-toc-avg">AVG</a>            <ol>
              <li><a href="#find-the-most-frequent-value" id="markdown-toc-find-the-most-frequent-value">Find the most frequent value</a></li>
              <li><a href="#count-how-many-distinct-values-are-there-for-a-row" id="markdown-toc-count-how-many-distinct-values-are-there-for-a-row">Count how many distinct values are there for a row</a></li>
            </ol>
          </li>
        </ol>
      </li>
      <li><a href="#view" id="markdown-toc-view">VIEW</a></li>
    </ol>
  </li>
  <li><a href="#delimiter" id="markdown-toc-delimiter">DELIMITER</a></li>
  <li><a href="#user-defined-functions" id="markdown-toc-user-defined-functions">User defined functions</a></li>
  <li><a href="#triggers" id="markdown-toc-triggers">Triggers</a></li>
  <li><a href="#database-file-format" id="markdown-toc-database-file-format">Database file format</a></li>
  <li><a href="#explain" id="markdown-toc-explain">EXPLAIN</a></li>
  <li><a href="#acid" id="markdown-toc-acid">ACID</a>    <ol>
      <li><a href="#atomicity" id="markdown-toc-atomicity">Atomicity</a></li>
      <li><a href="#transaction" id="markdown-toc-transaction">Transaction</a>        <ol>
          <li><a href="#autocommit" id="markdown-toc-autocommit">autocommit</a></li>
        </ol>
      </li>
      <li><a href="#locks" id="markdown-toc-locks">Locks</a></li>
    </ol>
  </li>
  <li><a href="#prepared-statements" id="markdown-toc-prepared-statements">Prepared statements</a></li>
  <li><a href="#master-slave-replication" id="markdown-toc-master-slave-replication">Master slave replication</a></li>
  <li><a href="#recipes" id="markdown-toc-recipes">Recipes</a>    <ol>
      <li><a href="#levenshtein-distance" id="markdown-toc-levenshtein-distance">Levenshtein distance</a></li>
      <li><a href="#associations" id="markdown-toc-associations">Associations</a>        <ol>
          <li><a href="#many-to-many" id="markdown-toc-many-to-many">Many to many</a></li>
          <li><a href="#many-to-one-two-levels-deep" id="markdown-toc-many-to-one-two-levels-deep">Many to one two levels deep</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#protocol" id="markdown-toc-protocol">Protocol</a></li>
  <li><a href="#internals" id="markdown-toc-internals">Internals</a></li>
  <li><a href="#rank-output" id="markdown-toc-rank-output">Rank output</a></li>
  <li><a href="#sources" id="markdown-toc-sources">Sources</a></li>
</ol>

<ol>
  <li><a href="getting-started">Getting started</a></li>
  <li>Introduction
    <ol>
      <li><a href="sql">SQL</a></li>
    </ol>
  </li>
  <li>Basic commands
    <ol>
      <li><a href="select">SELECT</a>
        <ol>
          <li><a href="order-by">ORDER BY</a></li>
        </ol>
      </li>
      <li><a href="limit">LIMIT</a></li>
      <li><a href="offset">OFFSET</a></li>
      <li><a href="group-by">GROUP BY</a></li>
    </ol>
  </li>
  <li>Row operations</li>
  <li>Aggregate functions
    <ol>
      <li>General concepts
        <ol>
          <li><a href="case-when">CASE WHEN</a></li>
          <li><a href="having">HAVING</a></li>
        </ol>
      </li>
      <li>Specific aggregate functions
        <ol>
          <li><a href="count">COUNT</a></li>
          <li><a href="exists">EXISTS</a></li>
          <li><a href="sum">SUM</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li>Indexes
    <ol>
      <li><a href="index-table">INDEX</a></li>
      <li><a href="unique">UNIQUE</a></li>
      <li><a href="primary-key">PRIMARY KEY</a></li>
      <li><a href="foreign-key">FOREIGN KEY</a></li>
    </ol>
  </li>
  <li><a href="join">JOIN</a></li>
  <li>Utilities
    <ol>
      <li><a href="mysqldump">mysqldump</a></li>
      <li><a href="mysqladmin">mysqladmin</a></li>
    </ol>
  </li>
</ol>

<p>Open source.</p>

<p>As of 2013, MySQL was the most popular server-based DBMS.</p>

<h2 id="server">Server</h2>

<p>MySQL runs on a server. The server executable is often called <code class="highlighter-rouge">mysqld</code>, which stands for MySQL daemon.</p>

<p>This means that either TCP or UDP requests are made on a standard port in order to make requests to MySQL.</p>

<p>The default IANA port for MySQL is 3306.</p>

<p>Clients make CRUD requests to the server to the server using a special language also called MySQL. This language is not a general computer language, but rather a language specialized for making queries. As such, it does not allow for basic features of general languages such as conditionals or loops.</p>

<p>The server holds session state about the connection. For example, a <code class="highlighter-rouge">SHOW WARNINGS</code> query will only show warnings if the last query produced a warning.</p>

<p>Configuration file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>less /etc/mysql/my.cnf
</code></pre></div></div>

<p>Contains info such as: port to listen to.</p>

<h2 id="interfaces">Interfaces</h2>

<h3 id="mysql-utility">mysql utility</h3>

<p>CLI interface to MySQL.</p>

<h4 id="login">Login</h4>

<p>Visualization get messy when tables don’t fit into the terminal width.</p>

<p>One advantage of this interface is the possibility for automation using bash.</p>

<p>Log in as user <code class="highlighter-rouge">root</code> at host <code class="highlighter-rouge">localhost</code> and prompts for password:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -h localhost -p
</code></pre></div></div>

<p>Automatically do a <code class="highlighter-rouge">USE cur_db</code> after logging in.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -h localhost -p cur_db
</code></pre></div></div>

<p>TODO what defaults are taken is <code class="highlighter-rouge">-u</code> and <code class="highlighter-rouge">-l</code> are omitted:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -p
</code></pre></div></div>

<p>Without the <code class="highlighter-rouge">-p</code>, will try to login without using a password, which is likely to fail for the root with default settings:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -h localhost
</code></pre></div></div>

<p>TODO when does login without password not fail?</p>

<p>Log in with given password:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -h localhost -p'pass'
</code></pre></div></div>

<p>There must be no space between <code class="highlighter-rouge">-p</code> and <code class="highlighter-rouge">"pass"</code>. This has obviously the security risk of exposing your password.</p>

<h4 id="use-modes">Use modes</h4>

<p>The <code class="highlighter-rouge">mysql</code> CLI utility can be used either as:</p>

<ul>
  <li>
    <p>an interactive REPL interface to MySQL</p>
  </li>
  <li>
    <p>a batch interface to MySQL, which deals with things such as login for you.</p>
  </li>
  <li>
    <p>Batch mode is used via either the <code class="highlighter-rouge">-e</code> option or by reading commands from a pipe.</p>

    <p>Execute commands from string and exit:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p -e 'SHOW DATABASES;'
</code></pre></div>    </div>

    <p>Execute commands from a file and exit:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p &lt; a.sql
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="output-format">Output format</h4>

<p>If the output is to be given to a terminal, MySQL may process MySQL output to make it more human readable, for example by adding table borders.</p>

<p>If the output is to be put into a pipe, MySQL utility detects this and removes by default those human readability features, separating columns with tab characters, and rows with newlines. This makes sense since it is expected that the output is to be further interpreted by another program, so human readable features should only complicate its task.</p>

<p>It is possible to customize what should be done in each case via command line options.</p>

<p>The following options are relevant:</p>

<p><code class="highlighter-rouge">-s</code>: silent. Does not print table borders. Separates entries with tabs and rows with newlines.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -se 'SHOW DATABSES;'
</code></pre></div></div>

<p><code class="highlighter-rouge">-N</code>: omit table headers containing column names.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -Ne 'SHOW DATABSES;'
</code></pre></div></div>

<p><code class="highlighter-rouge">-r</code>: raw. Controls if the special characters <code class="highlighter-rouge">\0</code>, <code class="highlighter-rouge">\t</code> <code class="highlighter-rouge">\n</code> should be represented as backslash escapes or not.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>If yes, then the backslash character gets printed as `\\` to differentiate it.
</code></pre></div></div>

<h3 id="phpmyadmin">phpmyadmin</h3>

<p>Popular PHP based browser interface for MySQL.</p>

<p>Allows to view and modify databases on a browser.</p>

<h3 id="api">API</h3>

<p>All major programming languages have a MySQL interface.</p>

<p>The following have interfaces which are part of the MySQL project:</p>

<ul>
  <li>C</li>
  <li>Python</li>
  <li>PHP</li>
  <li>Perl</li>
  <li>Ruby</li>
</ul>

<h2 id="help">Help</h2>

<p>The help command queries the server for MySQL help information.</p>

<p>Examples:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HELP DROP;
HELP DROP TABLE;
</code></pre></div></div>

<h2 id="newlines">Newlines</h2>

<p>Newlines only have an effect when inside quotes. In other places, newlines are ignored.</p>

<h2 id="semicolon">Semicolon</h2>

<p>A semicolon is required at the end of each command. Newlines do not work. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 'a'
SELECT 'a';
</code></pre></div></div>

<p>is the same as</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 'a' SELECT 'a';
</code></pre></div></div>

<p>and therefore produces an error.</p>

<h2 id="comments">Comments</h2>

<p>Single line comments can be done with the number sign <code class="highlighter-rouge">#</code>.</p>

<p>Multi line comments can be done as in C++ between <code class="highlighter-rouge">/**/</code> pairs.</p>

<p>If a multiline comment is for example of the form:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*!40100 SHOW TABLES */;
</code></pre></div></div>

<p>then it will <em>not</em> be treated as a comment on MySQL versions equal to or greater than <code class="highlighter-rouge">4.01.00</code> and will get executed normally.</p>

<p>This type of version conditional comments serve a similar purpose to C <code class="highlighter-rouge">__STDC_VERSION__</code> typedefs.</p>

<h2 id="structure">Structure</h2>

<p>MySQL organizes information hierarchically as:</p>

<ul>
  <li><em>databases</em> at the top-level</li>
  <li>each database contains tables</li>
  <li>each table contains columns</li>
  <li>each column holds a single type of information: numbers, characters, text, etc.</li>
</ul>

<h2 id="command-case">Command case</h2>

<p>Commands are case insensitive.</p>

<p>For example, all the following work:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * FROM db.tbl;
select * from db.tbl;
sElEct * fRoM db.tbl;
</code></pre></div></div>

<p>The most common convention is however to use upper case for built-in commands, and lowercase for names given to tables, allowing to distinguish between both easily, while allowing names to be all lowercase, as is usually the convention for variable names in most modern programming languages.</p>

<h2 id="quotation-types">Quotation types</h2>

<p>There are three types of quotations in MySQL:</p>

<ul>
  <li>
    <p>backticks: <code class="highlighter-rouge">`table name`</code></p>

    <p>Can only be used for identifiers such as database or table names.</p>

    <p>Usage is only mandatory if either:</p>

    <ul>
      <li>
        <p>the identifier contain chars other than alphanumeric, underscore <code class="highlighter-rouge">_</code> or dollar <code class="highlighter-rouge">$</code>.</p>
      </li>
      <li>
        <p>the identifier is a MySQL keyword such as <code class="highlighter-rouge">date</code> or <code class="highlighter-rouge">int</code>.</p>
      </li>
    </ul>

    <p>In other SQL implementations, square brackets must be used instead of backticks: <code class="highlighter-rouge">[]</code></p>
  </li>
  <li>
    <p>single quotes: <code class="highlighter-rouge">'asdf'</code>. Represents literal strings.</p>
  </li>
  <li>
    <p>double quotes: <code class="highlighter-rouge">"asdf"</code>. Same as single quotes. Single quotes are more common across DBMSs, so prefer single quotes.</p>
  </li>
</ul>

<h2 id="error-logging">Error logging</h2>

<p>Errors may occur either if a request is ill-formed or if an impossible operation is requested such as dropping an inexistent table:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DROP TABLE idontexist;
</code></pre></div></div>

<p>If one command gives an error, the execution is terminated immediately without doing further commands in the same request. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DROP TABLE idontexist; SELECT 'hello';
</code></pre></div></div>

<p>will not show <code class="highlighter-rouge">hello</code> since an error occurred before that.</p>

<p>Note that the <code class="highlighter-rouge">mysql</code> with the <code class="highlighter-rouge">-e</code> option sends all commands at once to the server even if the commands are on separate lines. Therefore for example the following prints nothing:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u test -h localhost -ppass test "DROP TABLE idontexist;
    SELECT 'hello';"
</code></pre></div></div>

<p>An error does not close the session. Before the session is over, it is possible to retrieve the last error message with the <code class="highlighter-rouge">SHOW WARNINGS</code> function:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DROP TABLE idontexist;
SHOW WARNINGS
</code></pre></div></div>

<p>Besides the <code class="highlighter-rouge">error</code> level, MySQL logging also represents the warning level, and the note level. <code class="highlighter-rouge">SHOW WARNINGS</code> shows the last error, warning or note.</p>

<h2 id="literal-values">Literal values</h2>

<h3 id="strings">Strings</h3>

<p>Literal strings can be either single or double quoted:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 'abc';
SELECT "abc";
</code></pre></div></div>

<p>C-like escape characters such as <code class="highlighter-rouge">\n</code>, <code class="highlighter-rouge">\t</code> and <code class="highlighter-rouge">\0</code> are recognized.</p>

<p>Newlines are included:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 'ab
c';
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ab\nc
</code></pre></div></div>

<h3 id="numeric-types">Numeric types</h3>

<p>C-like.</p>

<p>Decimal:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 123;
</code></pre></div></div>

<p>Hexadecimal:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 0x70;
</code></pre></div></div>

<p>Is treated as a string in this context and Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p
</code></pre></div></div>

<p>Floating point:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 1.23, 1.23E2;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.23 123
</code></pre></div></div>

<p>Can only use upper case <code class="highlighter-rouge">E</code>.</p>

<h3 id="boolean-types">Boolean types</h3>

<h3 id="true">TRUE</h3>

<h3 id="false">FALSE</h3>

<p>Aliases to <code class="highlighter-rouge">0</code> and <code class="highlighter-rouge">1</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT TRUE = 1;
SELECT FALSE = 0;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
1
</code></pre></div></div>

<h3 id="null-literal">NULL literal</h3>

<p>Represents absence of data.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT NULL;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NULL
</code></pre></div></div>

<h3 id="literal-tables">Literal tables</h3>

<p>It seems that it is not possible to directly create literal rows or tables: <a href="http://stackoverflow.com/questions/985295/can-you-define-literal-tables-in-sql">http://stackoverflow.com/questions/985295/can-you-define-literal-tables-in-sql</a></p>

<h2 id="identifiers">Identifiers</h2>

<p>Identifiers are names for things like databases or tables.</p>

<p>It is possible to use identifiers with characters other than alphanumeric, <code class="highlighter-rouge">_</code> or dollar <code class="highlighter-rouge">$</code> in the range <code class="highlighter-rouge">U+0080 .. U+FFFF</code> only if backticks are used.</p>

<p>For example the following are OK:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE `a é 中` (col0 INT);
CREATE TABLE a_$ (col0 INT);
</code></pre></div></div>

<p>But the following are not:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE a b (col0 INT);
CREATE TABLE aé (col0 INT);
</code></pre></div></div>

<h2 id="special-databases">Special databases</h2>

<p>As soon as you install MySQL, certain databases already exist:</p>

<ul>
  <li><code class="highlighter-rouge">mysql</code></li>
  <li><code class="highlighter-rouge">information_schema</code></li>
</ul>

<p>Those databases are special as they contain metadata used by MySQL such as user information, database metadata, etc.</p>

<p>Be very careful when editing those databases directly.</p>

<h2 id="users">Users</h2>

<p>MySQL has the concept of users and permissions analogous to POSIX users and permissions.</p>

<p>Each user/host pair has certain privileges such as view, edit, delete databases, tables and entries.</p>

<p>Those permissions may apply either to specific table/database or to the entire server (global permissions).</p>

<p>By default, a superuser called root is created during server installation.</p>

<p>List users and their <em>global</em> privileges:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * FROM mysql.user;
</code></pre></div></div>

<p>Note that privileges are given to user/host pairs, not just users/hosts separately.</p>

<p>Create a new user with given password:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE USER 'newuser'@'localhost' IDENTIFIED BY 'password';
</code></pre></div></div>

<p>this user has no privileges. He can only log from the <code class="highlighter-rouge">localhost</code> host.</p>

<p>Create a user on all hosts:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE USER 'newuser'@'%' IDENTIFIED BY 'password';
</code></pre></div></div>

<p>Does <em>not</em> include UNIX domain connections such is the case for localhost, but does include all TCP/UDP connections.</p>

<p>Get current user host pair:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT USER();
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ciro@localhost
</code></pre></div></div>

<p>Show all global privileges supported by a server:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW PRIVILEGES;
</code></pre></div></div>

<p>View privileges given for databases to current user:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW GRANTS;
</code></pre></div></div>

<p>To a given user:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW GRANTS FOR user@host;
</code></pre></div></div>

<p>Give all privileges to an user:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GRANT ALL            ON *   .*     TO 'user'@'localhost';
</code></pre></div></div>

<p><em>.</em> means global privileges:</p>

<p>On all tables on DB <code class="highlighter-rouge">mydb</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GRANT ALL            ON mydb.*     TO 'user'@'localhost';
GRANT SELECT, INSERT ON mydb.*     TO 'user'@'localhost';
</code></pre></div></div>

<p>Only for table <code class="highlighter-rouge">mydb.mytbl</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GRANT ALL            ON mydb.mytbl TO 'user'@'localhost';
GRANT SELECT, INSERT ON mydb.mytbl TO 'user'@'localhost';
</code></pre></div></div>

<p>Remove privileges of an user:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REVOKE;
</code></pre></div></div>

<p>Remove users:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DROP USER user@localhost, user2@localhost;
</code></pre></div></div>

<p>Change password for an existing user:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>USE MYSQL
SET PASSWORD FOR 'user-name'@'hostname-name' = PASSWORD('new-password');
</code></pre></div></div>

<p>Some sources mention that <code class="highlighter-rouge">FLUSH PRIVILEGES</code> privileges is needed after <code class="highlighter-rouge">SET PASSWORD</code>, but the 5.0 documentation says that this should be necessary after a <code class="highlighter-rouge">GRANT</code>, <code class="highlighter-rouge">REVOKE</code>, or <code class="highlighter-rouge">SET PASSWORD</code>, and, only if <code class="highlighter-rouge">INSERT</code>, <code class="highlighter-rouge">UPDATE</code> or <code class="highlighter-rouge">DELETE</code> are used directly.</p>

<p>Also consider using the <code class="highlighter-rouge">mysqladmin</code> utility for this task.</p>

<h2 id="flush">FLUSH</h2>

<p>Flush tells MySQL to load to the <code class="highlighter-rouge">mysqld</code> memory metadata that has been modified in the control table <code class="highlighter-rouge">mysql</code>, making it take effect.</p>

<p>For example, <code class="highlighter-rouge">INSERT</code> can be used to modify users and permissions on the <code class="highlighter-rouge">mysql</code> control database, but it does take effect in the running MySQL instance unless a <code class="highlighter-rouge">FLUSH PRIVILEGES</code> is done, which makes the server load this new information and put it into effect.</p>

<h2 id="database">DATABASE</h2>

<p>List all databases:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW DATABASES;
</code></pre></div></div>

<p>Create a database named <code class="highlighter-rouge">name</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE DATABASE name;
</code></pre></div></div>

<p>Delete the database named <code class="highlighter-rouge">name</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DROP name;
</code></pre></div></div>

<p>Needless to say, this is a very drastic operation, that could result in large data loss.</p>

<p>View command that would create a database exactly like the given one:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW CREATE DATABASE test;
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Database    Create Database
test    CREATE DATABASE `test` /*!40100 DEFAULT CHARSET latin1 */
</code></pre></div></div>

<h3 id="use">USE</h3>

<p>Choose default database.</p>

<p>After this command is given, database names may be omitted.</p>

<p>Set the current database to <code class="highlighter-rouge">db</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>USE db;
</code></pre></div></div>

<p>After this is done, one can write for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW TABLES;
</code></pre></div></div>

<p>instead of:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW TABLES IN db;
</code></pre></div></div>

<p>The same goes for example for using <code class="highlighter-rouge">DESC</code> on table <code class="highlighter-rouge">db.tbl</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DESC db.tbl;
</code></pre></div></div>

<p>which after <code class="highlighter-rouge">USE</code> can be written as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DESC tbl;
</code></pre></div></div>

<p>If a default database is not selected, omitting the database will produce an error.</p>

<p>Get current default database:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT DATABASE();
</code></pre></div></div>

<h2 id="table-operations">Table operations</h2>

<p>List all tables in current DB:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW TABLES;
</code></pre></div></div>

<p>List all tables in given DB named <code class="highlighter-rouge">db</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW TABLES IN db;
</code></pre></div></div>

<h3 id="create-table">CREATE TABLE</h3>

<p>Create a new table with the given columns:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE table_name(
    column_name0 INT,
    column_name1 INT
) CHARSET='utf8' ENGINE='InnoDB' COMMENT='table comment';
DROP TABLE table_name;
</code></pre></div></div>

<p>creates a table with 2 columns.</p>

<p>Table options come after the closing <code class="highlighter-rouge">)</code>. The <code class="highlighter-rouge">=</code> sign is optional, so the following would also do the same:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE table_name(
    column_name0 INT,
    column_name1 INT
) CHARSET 'utf8' ENGINE 'InnoDB' COMMENT 'table comment';
DROP TABLE table_name;
</code></pre></div></div>

<p>It is recommended however that the <code class="highlighter-rouge">=</code> sign be used to increase readability by making it clearer which key has which value.</p>

<p>It is not possible to create a table with no columns:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE table_name;
</code></pre></div></div>

<p>produces an error.</p>

<p>If a table already exists, creating it again gives an error. To avoid such errors, it is possible to use the <code class="highlighter-rouge">IF NOT EXISTS</code> option:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t( c0 INT );
CREATE TABLE IF NOT EXISTS t( c0 INT );
</code></pre></div></div>

<p>Creates a new table with same structure as another existing one:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE newtable LIKE oldtable;
</code></pre></div></div>

<h4 id="default-create-table">DEFAULT create table</h4>

<p>Set the default value for a column: <a href="http://stackoverflow.com/questions/5810538/mysql-default-values">http://stackoverflow.com/questions/5810538/mysql-default-values</a></p>

<h3 id="create-table-select">CREATE TABLE SELECT</h3>

<p>Create a table from the result of a <code class="highlighter-rouge">SELECT</code> query.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t0( c INT );
INSERT INTO t0 VALUES (0), (1), (2);
CREATE TABLE t1 SELECT * FROM t0 WHERE c &gt; 0;
SELECT * FROM t1;
DROP TABLE t0,t1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c
1
2
</code></pre></div></div>

<h3 id="drop-table">DROP TABLE</h3>

<p>Delete given tables:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t0 (c0 INT);
CREATE TABLE t1 (c0 INT);
DROP TABLE t0, t1;
SHOW TABLES;
</code></pre></div></div>

<p>The output should contain neither <code class="highlighter-rouge">t0</code> nor <code class="highlighter-rouge">t1</code>.</p>

<h4 id="show-create-table">SHOW CREATE TABLE</h4>

<p>Shows the exact command needed to to create a table, including options that depend on defaults and were not explicitly given at table creation time.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    c0 INT(2) NOT NULL AUTO_INCREMENT,
    c1 CHAR(2) UNIQUE DEFAULT 'ab',
    PRIMARY KEY(c0)
) ENGINE='InnoDB' CHARSET='utf8' COMMENT='table comment';
SHOW CREATE TABLE t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Table    Create Table
t    CREATE TABLE `t` (
  `c0` int(2) NOT NULL AUTO_INCREMENT,
  `c1` char(2) DEFAULT 'ab',
  PRIMARY KEY (`c0`),
  UNIQUE KEY `c1` (`c1`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='table comment'
</code></pre></div></div>

<h3 id="alter">ALTER</h3>

<p>Modify table and column properties.</p>

<p>Add a new column to an existing table:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALTER TABLE contacts ADD new_col_name VARCHAR(60);
</code></pre></div></div>

<p>Drop a column from an existing table:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALTER TABLE contacts DROP new_col_name VARCHAR(60);
</code></pre></div></div>

<p>It is not possible to leave a table without any columns:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c INT);
ALTER TABLE t DROP c;
DROP TABLE t;
</code></pre></div></div>

<p>Modify column properties:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE tbl_name (col_name INT);
ALTER TABLE tbl_name MODIFY COLUMN col_name INT NOT NULL;
DESC tbl_name;
DROP TABLE tbl_name;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>col_name    int(11)    NO        NULL
</code></pre></div></div>

<p>Type conversions:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE tbl_name (col_name INT);
INSERT INTO tbl_name VALUES (0), (1), (2);
ALTER TABLE tbl_name MODIFY COLUMN col_name CHAR(16) NOT NULL;
SELECT * FROM tbl_name;
DROP TABLE tbl_name;
</code></pre></div></div>

<p>Drop constraint from table:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    id INT,
    CONSTRAINT id_unique UNIQUE (id)
);
ALTER TABLE t DROP CONSTRAINT id_unique;
SHOW CREATE TABLE t;
DROP TABLE t;
</code></pre></div></div>

<p>The output should not present the unique constraint anymore.</p>

<p>It is only possible to drop a constraint if you know its name.</p>

<p>If you do not know its name, it is necessary to retrieve it manually with <code class="highlighter-rouge">SHOW CREATE TABLE</code> or to do it automatically one must tamper with <code class="highlighter-rouge">information_schema</code>.</p>

<p>A <code class="highlighter-rouge">FOREIGN KEY</code> constraint can only be removed via <code class="highlighter-rouge">DROP FOREIGN KEY</code>, not <code class="highlighter-rouge">DROP CONSTRAINT</code>.</p>

<h3 id="table-modifiers">table modifiers</h3>

<h3 id="indexes">Indexes</h3>

<p>An index is a technique to speed up searches at the cost of:</p>

<ul>
  <li>more expensive column updates</li>
  <li>larger memory usage</li>
</ul>

<p>Therefore indexes are most useful when there will be more searches than modifications on the data.</p>

<p>Indexes can be created with the following keywords:</p>

<ul>
  <li><code class="highlighter-rouge">INDEX</code></li>
  <li><code class="highlighter-rouge">UNIQUE</code></li>
  <li><code class="highlighter-rouge">PRIMARY KEY</code></li>
  <li><code class="highlighter-rouge">FULLTEXT</code></li>
</ul>

<p>Searches without indexes take $log(n)$ worst case since they mean looking up every row of the table.</p>

<p>Indexed searches can be done either in $O(log(n))$ or $O(1)$ since they are implemented as B-trees or as a hash maps of values to positions.</p>

<p>Each index speeds up searches on the row or the rows it covers. A single table may have more than one index for different columns.</p>

<p>Every data type can be used on indexes, but there are limits on how many bytes can be used for an index, so potentially huge columns like <code class="highlighter-rouge">TEXT</code> and <code class="highlighter-rouge">BLOB</code> types require that the number of bytes to be used be specified.</p>

<h4 id="using">USING</h4>

<h4 id="index-data-structure">Index data structure</h4>

<p>As of 5.5, the only engine that supports hash is <code class="highlighter-rouge">MEMORY</code>. Index type can be specified via <code class="highlighter-rouge">USING {BTREE|HASH}</code>. <code class="highlighter-rouge">USING</code> is ignored in case that the engine does not support the index type.</p>

<p>Because of the nature of the indexes, a hash index is only useful for <code class="highlighter-rouge">=</code> comparison, while a <code class="highlighter-rouge">BTREE</code> can also be used for <code class="highlighter-rouge">&lt;</code>, <code class="highlighter-rouge">&gt;</code>, <code class="highlighter-rouge">LIKE</code> and <code class="highlighter-rouge">ORDER BY</code>.</p>

<p><code class="highlighter-rouge">BTREE</code> indexes can also be specified either <code class="highlighter-rouge">ASC</code> or <code class="highlighter-rouge">DESC</code> order. While it does not make any difference for a single column, PostgreSQL’s manual explains why this exists: <a href="http://www.postgresql.org/docs/8.3/static/indexes-ordering.html">http://www.postgresql.org/docs/8.3/static/indexes-ordering.html</a> it does make a difference for a multi column index. MySQL currently ignores this parameter, and is unable to optimize do mixed ordering queries like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT col0 FROM table0 ORDER BY
</code></pre></div></div>

<h4 id="index-name">Index name</h4>

<p>Every index has an unique name.</p>

<p>If not given explicitly, the name is automatically generated by MySQL.</p>

<p>Two indexes cannot have the same name.</p>

<h4 id="fulltext">FULLTEXT</h4>

<p>Split fields like <code class="highlighter-rouge">VARCHAR</code> or <code class="highlighter-rouge">TEXT</code> into words, and index those words.</p>

<p>Allows for faster <code class="highlighter-rouge">LIKE</code> searches.</p>

<p>As of 5.5 only available on MyISAM tables, not the default InnoDB.</p>

<h4 id="show-index">SHOW INDEX</h4>

<p>Get information about indexes on table.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    pk INT,
    uni INT,
    ft VARCHAR(2),
    ind INT,
    PRIMARY KEY (pk),
    UNIQUE (uni),
    UNIQUE (uni),
    FULLTEXT (ft),
    FULLTEXT (ft),
    INDEX (ind),
    INDEX (ind),
    INDEX USING HASH (ind),
    INDEX name (ind),
    # ERROR: duplicate name
    #INDEX name (ind),
    INDEX (ft(2))
) ENGINE=MyISAM;
SHOW INDEX FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-------+------------+----------+--------------+-------------+-----------+-------------+
| Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality |
+-------+------------+----------+--------------+-------------+-----------+-------------+
| t     |          0 | PRIMARY  |            1 | pk          | A         |           0 |
| t     |          0 | uni      |            1 | uni         | A         |        NULL |
| t     |          0 | uni_2    |            1 | uni         | A         |        NULL |
| t     |          1 | ind      |            1 | ind         | A         |        NULL |
| t     |          1 | ind_2    |            1 | ind         | A         |        NULL |
| t     |          1 | ind_3    |            1 | ind         | A         |        NULL |
| t     |          1 | name     |            1 | ind         | A         |        NULL |
| t     |          1 | ft_3     |            1 | ft          | A         |        NULL |
| t     |          1 | ft       |            1 | ft          | NULL      |        NULL |
| t     |          1 | ft_2     |            1 | ft          | NULL      |        NULL |
+-------+------------+----------+--------------+-------------+-----------+-------------+

----------+--------+------+------------+---------+---------------+
 Sub_part | Packed | Null | Index_type | Comment | Index_comment |
----------+--------+------+------------+---------+---------------+
     NULL | NULL   |      | BTREE      |         |               |
     NULL | NULL   | YES  | BTREE      |         |               |
     NULL | NULL   | YES  | BTREE      |         |               |
     NULL | NULL   | YES  | BTREE      |         |               |
     NULL | NULL   | YES  | BTREE      |         |               |
     NULL | NULL   | YES  | BTREE      |         |               |
     NULL | NULL   | YES  | BTREE      |         |               |
     NULL | NULL   | YES  | BTREE      |         |               |
     NULL | NULL   | YES  | FULLTEXT   |         |               |
     NULL | NULL   | YES  | FULLTEXT   |         |               |
----------+--------+------+------------+---------+---------------+
</code></pre></div></div>

<h3 id="engine">Engine</h3>

<p>Each table has an engine assigned to it.</p>

<p>The engine determines exactly how data is stored and retrieved in the table.</p>

<p>Starting from 5.1, engines can be plugged into a running instance of MySQL
without restarting it.</p>

<p>List all available engines and their main capacities:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW ENGINES;
</code></pre></div></div>

<p>Sample output (shortened):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+--------------------+---------+---------------------------------
| Engine             | Support | Comment
+--------------------+---------+---------------------------------
| MyISAM             | YES     | MyISAM storage engine
| FEDERATED          | NO      | Federated MySQL storage engine
| InnoDB             | DEFAULT | Supports transactions, row-level
+--------------------+---------+---------------------------------

-------------------------------+--------------+------+------------+
                               | Transactions | XA   | Savepoints |
-------------------------------+--------------+------+------------+
                               | NO           | NO   | NO         |
                               | NULL         | NULL | NULL       |
 locking, and foreign keys     | YES          | YES  | YES        |
-------------------------------+--------------+------+------------+
</code></pre></div></div>

<p>Under <code class="highlighter-rouge">support</code> we see:</p>

<ul>
  <li><code class="highlighter-rouge">YES</code> the engine is currently supported.</li>
  <li><code class="highlighter-rouge">NO</code>  not supported.</li>
  <li><code class="highlighter-rouge">DEFAULT</code> the engine is the default one for new tables.</li>
</ul>

<p><code class="highlighter-rouge">XA</code> is a transaction standard by X/Open that is not specific for databases,
but could also be used in other types of systems.</p>

<p>The engine of a table can be specified at creation time via the <code class="highlighter-rouge">ENGINE</code> table option:</p>

<p>If is possible to retrieve the table type via <code class="highlighter-rouge">SHOW CREATE TABLE</code>;</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t(c INT) ENGINE=InnoDB;
SHOW CREATE TABLE t;
DROP TABLE t;
</code></pre></div></div>

<h3 id="temporary-table">TEMPORARY TABLE</h3>

<p>A table that only exists per session and expires at the end of a session.</p>

<p><code class="highlighter-rouge">SHOW TABLES</code> does not show temporary tables. TODO how to list them?</p>

<p>Useful to store subqueries that will be reused several times.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TEMPORARY TABLE tt (c INT);
INSERT INTO tt VALUES (0), (1);
SELECT * FROM tt;
SHOW TABLES;
EXIT;
</code></pre></div></div>

<p>Now to verify that the table does not exist anymore
so the following should give an error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DESC tt;
</code></pre></div></div>

<p>It is possible (but horribly confusing) to have a temporary table
with the same name as a non temporarily table.
The table that is created last will override the old one
which becomes inaccessible on the current session.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c INT);
INSERT INTO t VALUES (0);
CREATE TEMPORARY TABLE t (c INT);
DROP TABLE t;
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>The above should output <code class="highlighter-rouge">0</code>, meaning that the non temporary table remains.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TEMPORARY TABLE t (c INT);
CREATE TABLE t (c INT);
DROP TABLE t;
SHOW TABLES;
</code></pre></div></div>

<p>The output should not contain <code class="highlighter-rouge">t</code>, since only the temporary table exists now.</p>

<h4 id="drop-temporary">DROP TEMPORARY</h4>

<p>It is preferred to use <code class="highlighter-rouge">DROP TEMPORARY TABLE</code>
instead of just <code class="highlighter-rouge">DROP TABLE</code> to delete temporary tables
because the former only deletes temporary tables,
and if there are two tables with the same name it always deletes the temporary one.</p>

<p>The following output should contain <code class="highlighter-rouge">t</code>, as <code class="highlighter-rouge">DROP TEMPORARY</code> targeted the temporary table directly.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TEMPORARY TABLE t (c INT);
CREATE TABLE t (c INT);
DROP TEMPORARY TABLE t;
SHOW TABLES;
</code></pre></div></div>

<p>The following code should give an error,
since it is not possible to <code class="highlighter-rouge">DROP TEMPORARY</code> on a non temporary table.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c INT);
DROP TEMPORARY TABLE t;
DROP TABLE t;
</code></pre></div></div>

<h2 id="column-operations">Column operations</h2>

<h3 id="data-types">Data types</h3>

<p>Each column holds a specific data type.</p>

<h4 id="int-types">Int types</h4>

<ul>
  <li><code class="highlighter-rouge">TINYINT</code>  : 1 byte</li>
  <li><code class="highlighter-rouge">SMALLINT</code> : 2 bytes</li>
  <li><code class="highlighter-rouge">MEDIUMINT</code>: 3 bytes</li>
  <li><code class="highlighter-rouge">INT</code>      : 4 bytes</li>
  <li><code class="highlighter-rouge">BIGINT</code>   : 8 bytes</li>
</ul>

<p>Note that not all of those types are available across all SQL implementations.
<code class="highlighter-rouge">SMALLINT</code>, <code class="highlighter-rouge">INT</code> and <code class="highlighter-rouge">BIGINT</code> are the most portable.</p>

<p>MySQL offers unsigned versions to those types, but this is not SQL portable.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    si SMALLINT,
    i INT,
    bi BIGINT,
    iu SMALLINT UNSIGNED,
);
INSERT INTO t VALUES (0x8FFF, 0x8FFFFFFF, 0x8FFFFFFFFFFFFFFF, 0xFFFF);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<h5 id="int-overflow">INT overflow</h5>

<p>In case of overflow, the server silently stores the largest possible value:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t ( si SMALLINT );
INSERT INTO t VALUES ( 0x9000 );
INSERT INTO t VALUES ( 0x8FFF );
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>32767
32767
</code></pre></div></div>

<p>since <code class="highlighter-rouge">32767 == 0x8FFF</code> is the largest possible value.</p>

<h4 id="decimal">DECIMAL</h4>

<p>Represents decimal fractions precisely unlike floats.</p>

<p>For example, 0.3 cannot be represented precisely with floating point numbers since its binary representation is infinite.</p>

<p>This is important for example in financial computations, where errors can add up and make a big difference on the resulting output.</p>

<h4 id="bit">BIT</h4>

<p>Introduced in 5.3: truly capable of storing a bit in one bit of memory.</p>

<p><a href="http://stackoverflow.com/questions/289727/which-mysql-datatype-to-use-for-storing-boolean-values">http://stackoverflow.com/questions/289727/which-mysql-datatype-to-use-for-storing-boolean-values</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t ( b BIT );
INSERT INTO t VALUES ( FALSE );
INSERT INTO t VALUES ( TRUE );
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>b
</code></pre></div></div>

<p>Before it, best option was <code class="highlighter-rouge">BOOL</code> or <code class="highlighter-rouge">BOOLEAN</code></p>

<h4 id="bool">BOOL</h4>

<h4 id="boolean">BOOLEAN</h4>

<p>Aliases for <code class="highlighter-rouge">TINYINT</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t ( b BOOL );
INSERT INTO t VALUES ( FALSE );
INSERT INTO t VALUES ( TRUE );
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>b
0
1
</code></pre></div></div>

<h4 id="date">DATE</h4>

<p>Holds a year / month / day date.</p>

<p>Any punctuation char can be used as input delimiters:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE dates (d DATE);
INSERT INTO dates VALUES ('2001-01-03');
INSERT INTO dates VALUES ('2001/01/03');
INSERT INTO dates VALUES ('20010203');
INSERT INTO dates VALUES ('010127');
INSERT INTO dates VALUES ('2001+01+03');
INSERT INTO dates VALUES ('2001_01/03');
SELECT * FROM dates;
DROP TABLE dates;
</code></pre></div></div>

<p>The following are not OK:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO dates VALUES ('2001a01a03');
INSERT INTO dates VALUES ('2001 01 03');
</code></pre></div></div>

<p>The output is always of the form: <code class="highlighter-rouge">YYYY-MM-DD</code>.</p>

<p>The default value for a <code class="highlighter-rouge">DATE</code> row is <code class="highlighter-rouge">NULL</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (d DATE, i INT);
INSERT INTO t (i) VALUES (1);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NULL    1
</code></pre></div></div>

<p>Range: <code class="highlighter-rouge">'1000-01-01'</code> to <code class="highlighter-rouge">'9999-12-31'</code>.</p>

<p>Bounds checking is not done automatically.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (d DATE);
INSERT INTO t VALUES ('1000-01-01');
INSERT INTO t VALUES ('999-01-01');
INSERT INTO t VALUES ('10000-01-01');
INSERT INTO t VALUES ('1000-12-01');
INSERT INTO t VALUES ('1000-13-01');
INSERT INTO t VALUES ('1000-01-31');
INSERT INTO t VALUES ('1000-01-32');
INSERT INTO t VALUES ('1000-04-30');
INSERT INTO t VALUES ('1000-04-31');
INSERT INTO t VALUES ('1000-04-32');
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>d
1000-01-01
0999-01-01
0000-00-00
1000-12-01
0000-00-00
1000-01-31
0000-00-00
1000-04-30
0000-00-00
0000-00-00
</code></pre></div></div>

<h4 id="datetime">DATETIME</h4>

<p>Holds a <code class="highlighter-rouge">YYYY-MM-DD HH:mm:SS</code> time.</p>

<p>Like for <code class="highlighter-rouge">date</code>, any punctuation char is acceptable as separator.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (d DATETIME);
INSERT INTO t VALUES ('2001-02-03 04:05:06');
INSERT INTO t VALUES ('2001.02-03?04!05*06');
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Range: <code class="highlighter-rouge">1000-01-01 00:00:00</code> to <code class="highlighter-rouge">9999-12-31 23:59:59</code>.</p>

<h4 id="timestamp">TIMESTAMP</h4>

<p>Vs <code class="highlighter-rouge">datetime</code>: <a href="http://stackoverflow.com/questions/409286/datetime-vs-timestamp">http://stackoverflow.com/questions/409286/datetime-vs-timestamp</a></p>

<p>Similar to <code class="highlighter-rouge">datetime</code> but:</p>

<ul>
  <li>
    <p>much smaller range: <code class="highlighter-rouge">'1970-01-01 00:00:01'</code> UTC to <code class="highlighter-rouge">'2038-01-09 03:14:07'</code> UTC</p>
  </li>
  <li>
    <p>occupies 4 bytes instead of 8</p>
  </li>
  <li>
    <p>is automatically affected by the <code class="highlighter-rouge">TIME_ZONE</code> variable</p>
  </li>
  <li>
    <p>The default value is the current time, not <code class="highlighter-rouge">NULL</code> as in <code class="highlighter-rouge">DATE</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">UPDATE</code> updates it to current time.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (d TIMESTAMP, i INT);
INSERT INTO t (i) VALUES (1);
SELECT * FROM t;
</code></pre></div>    </div>
  </li>
</ul>

<p>wait, and then:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO t (i) VALUES (2);
SELECT * FROM t;
</code></pre></div></div>

<p>wait, and then:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UPDATE t SET i=i+1;
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<h4 id="char">CHAR</h4>

<h4 id="varchar">VARCHAR</h4>

<p><code class="highlighter-rouge">CHAR</code> and <code class="highlighter-rouge">VARCHAR</code> both store strings of characters in the given column encoding and collation.</p>

<p><code class="highlighter-rouge">CHAR</code> and <code class="highlighter-rouge">VARCHAR</code> store and retrieve the strings differently leading to slightly different behaviors and different time/space performance characteristics.</p>

<p><code class="highlighter-rouge">CHAR</code> has range 0 to 255. <code class="highlighter-rouge">VARCHAR</code> has range 0 to 65,535.</p>

<p><code class="highlighter-rouge">CHAR</code> always uses up the same number of characters. If all the entries on a table use the same number of characters, or almost the same number <code class="highlighter-rouge">CHAR</code> has two advantages over <code class="highlighter-rouge">VARCHAR</code>:</p>

<ul>
  <li>
    <p>may be slightly faster</p>
  </li>
  <li>
    <p>uses slightly less space since <code class="highlighter-rouge">CHAR</code> requires 1 or 2 bytes per entry to store the length of that entry.</p>

    <p>More precisely, <code class="highlighter-rouge">VARCHAR</code> requires on extra byte if the length is <code class="highlighter-rouge">255</code> or less, and 2 bytes if it is 256 or more.</p>

    <p>Note that this is <code class="highlighter-rouge">255</code> and not <code class="highlighter-rouge">256</code>, since the <code class="highlighter-rouge">255</code> already includes the 1 length byte so that everything will align nicely to 256 bytes.</p>
  </li>
</ul>

<p><code class="highlighter-rouge">VARCHAR</code> however, may use less bytes than the maximum to represent each string.</p>

<p>In general, the performance gain of <code class="highlighter-rouge">CHAR</code> is small, and the flexibility of <code class="highlighter-rouge">VARCHAR</code> is preferred. Only use <code class="highlighter-rouge">CHAR</code> if you are very sure that the size of data will always be the same or almost the same.</p>

<p>Why ever use <code class="highlighter-rouge">CHAR</code> instead of <code class="highlighter-rouge">VARCHAR</code>: <a href="http://stackoverflow.com/questions/59667/why-would-i-ever-pick-char-over-varchar-in-sql">http://stackoverflow.com/questions/59667/why-would-i-ever-pick-char-over-varchar-in-sql</a></p>

<p>Why ever use <code class="highlighter-rouge">VARCHAR(20)</code> instead of <code class="highlighter-rouge">VARCHAR(255)</code> if both will get one extra byte: <a href="http://stackoverflow.com/questions/262238/are-there-disadvantages-to-using-a-generic-varchar255-for-all-text-based-field">http://stackoverflow.com/questions/262238/are-there-disadvantages-to-using-a-generic-varchar255-for-all-text-based-field</a> In MySQL, there is a RAM memory performance difference, so stick with the smallest value possible.</p>

<p>Overflows are treated silently and truncation happens:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (val VARCHAR(2));
INSERT INTO t VALUES ('a');
INSERT INTO t VALUES ('ab');
INSERT INTO t VALUES ('abc');
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>val
a
ab
ab
</code></pre></div></div>

<h4 id="binary">BINARY</h4>

<p>Similar to <code class="highlighter-rouge">CHAR</code>, except that the column is not affected by encoding and collation: bytes are stored as is.</p>

<p>Mostly useful for non-textual data.</p>

<h4 id="blob">BLOB</h4>

<h4 id="text">TEXT</h4>

<p><code class="highlighter-rouge">BLOB</code> and <code class="highlighter-rouge">TEXT</code> are very similar to <code class="highlighter-rouge">VARBINARY</code> and <code class="highlighter-rouge">VARCHAR</code>: <a href="http://stackoverflow.com/questions/2023481/mysql-large-varchar-vs-text">http://stackoverflow.com/questions/2023481/mysql-large-varchar-vs-text</a>. The main difference is that <code class="highlighter-rouge">TEXT</code> is stored as a reference to outside the table, while <code class="highlighter-rouge">VARCHAR</code> is stored inline. <code class="highlighter-rouge">VARCHAR</code> may be faster to search since it avoids the dereference, but there are limits to row size. Prefer <code class="highlighter-rouge">TEXT</code> when data can be arbitrarily large.</p>

<p>The difference between <code class="highlighter-rouge">BLOB</code> and <code class="highlighter-rouge">TEXT</code> is the same as that between <code class="highlighter-rouge">BINARY</code> and <code class="highlighter-rouge">CHAR</code>: <code class="highlighter-rouge">BLOB</code> stores a string of bytes and has no encoding or collation.</p>

<h3 id="null">NULL</h3>

<p><code class="highlighter-rouge">NULL</code> can be inserted in place of any value that is not marked <code class="highlighter-rouge">NOT NULL</code>.</p>

<p>It represents absence of data.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (a INT, b INT);
INSERT INTO t VALUES (0, 1);
INSERT INTO t VALUES (0, NULL);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<h4 id="null-and-operators">NULL and operators</h4>

<p><a href="http://dev.mysql.com/doc/refman/5.0/en/working-with-null.html">http://dev.mysql.com/doc/refman/5.0/en/working-with-null.html</a></p>

<p>Some functions and <code class="highlighter-rouge">NULL</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT NULL + 0;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NULL
</code></pre></div></div>

<h5 id="is-null">IS NULL</h5>

<h5 id="is-not-null">IS NOT NULL</h5>

<p><a href="http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#operator_is-null">http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#operator_is-null</a></p>

<p><a href="http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#operator_is-not-null">http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#operator_is-not-null</a></p>

<p>You should not use arithmetic comparison operators with <code class="highlighter-rouge">NULL</code> <a href="http://dev.mysql.com/doc/refman/5.0/en/working-with-null.html">http://dev.mysql.com/doc/refman/5.0/en/working-with-null.html</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT NULL = NULL;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NULL
</code></pre></div></div>

<p>Use the <code class="highlighter-rouge">IS NULL</code> and <code class="highlighter-rouge">IS NOT NULL</code> operators instead:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT NULL IS NULL;
SELECT NULL IS NOT NULL;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
0
</code></pre></div></div>

<h3 id="type-conversion">Type conversion</h3>

<p>TODO what happens here:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (a INT);
INSERT INTO t VALUES ('abc');
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<h3 id="column-constraints">Column constraints</h3>

<p>Besides the data type, each column may have one or more of several constraints.</p>

<p>There are two syntaxes for defining constraints:</p>

<ul>
  <li>
    <p>on the same line as the row.</p>

    <p>Example:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id INT UNIQUE
</code></pre></div>    </div>

    <p>Advantage:</p>

    <ul>
      <li>no need to repeat the column name (<code class="highlighter-rouge">id</code>)</li>
    </ul>

    <p>Disadvantage:</p>

    <ul>
      <li>
        <p>it is not possible to define a constraint name.
This name is needed to remove a constraint afterwards.</p>
      </li>
      <li>
        <p>less portable. TODO check.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>on a separate line.</p>

    <p>Example:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id INT UNIQUE,
CONSTRAINT id_unique UNIQUE (id)
</code></pre></div>    </div>

    <p>or:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id INT UNIQUE,
UNIQUE (id)
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="not-null">NOT NULL</h4>

<p>With <code class="highlighter-rouge">NOT NULL</code>, attempt to insert <code class="highlighter-rouge">NULL</code> given an error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (a INT NOT NULL);
INSERT INTO t VALUES (NULL);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR 1048 (23000): Column 'a' cannot be null
</code></pre></div></div>

<h4 id="default">DEFAULT</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (a INT, b INT DEFAULT -1);
INSERT INTO t VALUES (0, 1);
INSERT INTO t VALUES (0, DEFAULT);
INSERT INTO t VALUES (DEFAULT(b), 0);
INSERT INTO t VALUES (DEFAULT(a), 0);
# ERROR:
INSERT INTO t VALUES (0);
INSERT INTO t (a) VALUES (0);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Note that:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">DEFAULT</code> is the default value for the current column. It is mandatory on the ordered mode.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">DEFAULT(col_name)</code> is the default value for the current column.</p>

    <p>It is mandatory on the list form, but not on the dictionary form.</p>

    <p><code class="highlighter-rouge">INT</code> columns have a default <code class="highlighter-rouge">NULL</code> value if none is explicitly set.</p>
  </li>
</ul>

<p>It seems that the default for a <code class="highlighter-rouge">DATETIME</code> row cannot be <code class="highlighter-rouge">NOW()</code>: <a href="http://stackoverflow.com/questions/5818423/set-now-as-default-value-for-datetime-datatype">http://stackoverflow.com/questions/5818423/set-now-as-default-value-for-datetime-datatype</a></p>

<p>Default can be a function:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (d DATETIME DEFAULT NOW());
INSERT INTO t VALUES (DEFAULT);
INSERT INTO t VALUES (DEFAULT);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<h4 id="check">CHECK</h4>

<p>Gets parsed, but is ignored since it is not implemented!</p>

<p>Enforces certain conditions on rows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    a INT,
    b INT,
    CHECK (a + b &lt; 3)
);
INSERT INTO t VALUES (0, 1);
INSERT INTO t VALUES (1, 1);
INSERT INTO t VALUES (2, 0);
INSERT INTO t VALUES (3, -1);
# should be error if it were implemented:
INSERT INTO t VALUES (4, 0);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<h4 id="auto_increment">AUTO_INCREMENT</h4>

<p>The value of the column is always generated by MySQL by incrementing the last value.</p>

<p>Count starts at <code class="highlighter-rouge">1</code>.</p>

<p>Major application: primary keys.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    id INT AUTO_INCREMENT,
    val VARCHAR(16),
    KEY (id)
);
INSERT INTO t (val) VALUES ('one'), ('two'), ('three');
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>The <code class="highlighter-rouge">AUTO_INCREMENT</code> column must be a <code class="highlighter-rouge">KEY</code>, otherwise error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    id INT AUTO_INCREMENT,
    val VARCHAR(16),
);
</code></pre></div></div>

<p>Auto increment starts from the last largest value on the column.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    id INT AUTO_INCREMENT,
    val VARCHAR(16),
    KEY (id)
);
INSERT INTO t VALUES (2, 'two');
INSERT INTO t (val) VALUES ('three'), ('four');
INSERT INTO t VALUES (6, 'six');
INSERT INTO t (val) VALUES ('seven'), ('eight');
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>It is possible to explicitly tell <code class="highlighter-rouge">AUTO_INCREMENT</code> where to start:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    id INT AUTO_INCREMENT,
    val VARCHAR(16),
    KEY (id)
) AUTO_INCREMENT=3;
INSERT INTO t (val) VALUES ('three'), ('four'), ('five');
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3    three
4    four
5    five
</code></pre></div></div>

<p>If another larger value is inserted, it will be used instead of the one given to <code class="highlighter-rouge">AUTO_INCREMENT</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    id INT AUTO_INCREMENT,
    val VARCHAR(16),
    KEY (id)
) AUTO_INCREMENT=3;
INSERT INTO t VALUES (4, 'four');
INSERT INTO t (val) VALUES ('five'), ('six');
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4    four
5    five
6    six
</code></pre></div></div>

<h4 id="zerofill">ZEROFILL</h4>

<p>Controls how numbers will be output.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (i INT, i0 INT(4) ZEROFILL);
INSERT INTO t VALUES (12, 12);
INSERT INTO t VALUES (123456, 123456);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>12    0012
123456    123456
</code></pre></div></div>

<p>The <code class="highlighter-rouge">(4)</code> mens that the minimum output width is <code class="highlighter-rouge">4</code>.</p>

<p>The difference of using it can only be noticed if <code class="highlighter-rouge">ZEROFILL</code> is set for the column.</p>

<p>Floating point types have two display parameters: minimum width (including point and decimals) and number of decimal cases:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (f FLOAT, f0 FLOAT(10, 2) ZEROFILL);
INSERT INTO t VALUES (12.3456, 12.3456);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<h3 id="get-column-description">Get column description</h3>

<h4 id="show-columns-from">SHOW COLUMNS FROM</h4>

<h4 id="describe">DESCRIBE</h4>

<h4 id="desc">DESC</h4>

<p>Same as <code class="highlighter-rouge">SHOW COLUMNS FROM</code> and <code class="highlighter-rouge">DESCRIBE</code>.</p>

<p>Get short description of all columns of a table or temporary table:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    c0 INT(2) NOT NULL AUTO_INCREMENT,
    c1 CHAR(2) UNIQUE DEFAULT 'ab',
    PRIMARY KEY(c0)
);
DESC t;
DESC SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-------+---------+------+-----+---------+----------------+
| Field | Type    | Null | Key | Default | Extra          |
+-------+---------+------+-----+---------+----------------+
| c0    | int(2)  | NO   | PRI | NULL    | auto_increment |
| c1    | char(2) | YES  | UNI | ab      |                |
+-------+---------+------+-----+---------+----------------+

+----+-------------+-------+-------+---------------+------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+------+---------+------+------+-------------+
|  1 | SIMPLE      | t     | index | NULL          | c1   | 7       | NULL |    1 | Using index |
+----+-------------+-------+-------+---------------+------+---------+------+------+-------------+
</code></pre></div></div>

<h4 id="show-full-columns">SHOW FULL COLUMNS</h4>

<p>Get more info than <code class="highlighter-rouge">DESC</code> including:</p>

<ul>
  <li>
    <p>column collation</p>
  </li>
  <li>
    <p>privileges</p>
  </li>
  <li>
    <p>comment</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    c0 INT(2) NOT NULL AUTO_INCREMENT COMMENT 'my comment!',
    c1 CHAR(2) UNIQUE DEFAULT 'ab',
    PRIMARY KEY(c0)
);
SHOW FULL COLUMNS FROM t;
DROP TABLE t;
</code></pre></div>    </div>
  </li>
</ul>

<p>Sample output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-------+---------+-------------------+------+-----+
| Field | Type    | Collation         | Null | Key |
+-------+---------+-------------------+------+-----+
| c0    | int(2)  | NULL              | NO   | PRI |
| c1    | char(2) | latin1_swedish_ci | YES  | UNI |
+-------+---------+-------------------+------+-----+

---------+----------------+---------------------------------+-------------+
 Default | Extra          | Privileges                      | Comment     |
---------+----------------+---------------------------------+-------------+
 NULL    | auto_increment | select,insert,update,references | my comment! |
 ab      |                | select,insert,update,references |             |
---------+----------------+---------------------------------+-------------+
</code></pre></div></div>

<h3 id="character-set">Character set</h3>

<h3 id="charset">CHARSET</h3>

<p>The encoding to use for text columns such as <code class="highlighter-rouge">CHAR</code> columns.</p>

<p>Does not apply to other types of columns such as <code class="highlighter-rouge">INT</code> or <code class="highlighter-rouge">DATE</code>.</p>

<p>Each column may have a different encoding. It is possible to set default charactersets for databases and tables, which are then used for columns if not explicitly overridden.</p>

<p>Unless you are absolutely sure that the database will contain only ASCII characters (for example it will not contain a natural language), make all databases UTF8. Do this even if the database is intended to be English only, since even in English contexts it may be useful to use non-ASCII characters.</p>

<p>List all possible character sets:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW CHARSET;
</code></pre></div></div>

<p>Use default UTF8 charset on a database. Default in 5.5 is <code class="highlighter-rouge">latin1</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE DATABASE name CHARSET utf8;
</code></pre></div></div>

<p><code class="highlighter-rouge">DEFAULT</code> is optional:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE DATABASE name DEFAULT CHARSET utf8;
</code></pre></div></div>

<p>Use default UTF8 charset on a table:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    c0 CHAR(1),
    c1 CHAR(1) CHARSET ascii
) CHARSET utf8;
SHOW FULL COLUMNS FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>View default charset for given DB/TABLE/COLUMN: <a href="http://stackoverflow.com/questions/1049728/how-do-i-see-what-character-set-a-database-table-column-is-in-mysql">http://stackoverflow.com/questions/1049728/how-do-i-see-what-character-set-a-database-table-column-is-in-mysql</a></p>

<h3 id="collation">COLLATION</h3>

<p>Collation determines how strings in a given charset are compared for equal, smaller, larger.</p>

<p>Like <code class="highlighter-rouge">CHARSET</code>, each column has its own collation, and defaults can be set for databases and tables.</p>

<p>Examples: case sensitive, case insensitive, uppercase comes first (<code class="highlighter-rouge">ABC...abc</code>)</p>

<p>View all possible collations for each charset:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW COLLATION;
</code></pre></div></div>

<h3 id="column-limitations">Column limitations</h3>

<p>Length.</p>

<p>There are length limitation on <em>row</em> size (sum of all columns).</p>

<p>$2**16-1 = 8k-1$</p>

<p>This means $8k-1/256 = 85$ <code class="highlighter-rouge">CHAR(256)</code> fields are permitted.</p>

<p><code class="highlighter-rouge">TEXT</code> field not stored on the table: each occupies up to 12 bytes on their row.</p>

<p>Copies data from old table to new table:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO $newtable SELECT * FROM $oldtable;
</code></pre></div></div>

<h2 id="row-operations">Row operations</h2>

<p>This section describes operations which act on the row level (most of them).</p>

<h3 id="insert">INSERT</h3>

<p>Insert one or more rows into a table.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (
    i INT,
    v VARCHAR(16)
);
</code></pre></div></div>

<p>Insert into the same order as parameters given:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO t VALUES (1, 'ab');
</code></pre></div></div>

<p>Insert into several at once:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO t VALUES (1, 'ab'), (2, 'bc');
</code></pre></div></div>

<p>The number of columns must match. The following produces an error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO t VALUES (1);
</code></pre></div></div>

<p>If no data is present, one solution is to use <code class="highlighter-rouge">NULL</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO t VALUES (1, NULL);
</code></pre></div></div>

<p>Specify order by row name:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO t (v, i) VALUES ('cd', 2);
</code></pre></div></div>

<p>If column names are given, not all column values need to be given:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO t (i) VALUES (2);
</code></pre></div></div>

<p>Missing values assume their default value.</p>

<h4 id="insert-without-any-values">Insert without any values</h4>

<h4 id="insert-default-row">Insert default row</h4>

<p><a href="http://stackoverflow.com/questions/7077113/how-to-insert-a-row-without-values">http://stackoverflow.com/questions/7077113/how-to-insert-a-row-without-values</a></p>

<h4 id="ignore">IGNORE</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (a INT UNIQUE, b INT);
INSERT INTO t VALUES (0, 0), (1, 0);
INSERT IGNORE INTO t VALUES (0, 1);
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Ignores constraint errors like <code class="highlighter-rouge">UNIQUE</code> double insertion.</p>

<h3 id="update">UPDATE</h3>

<p>Modify the selected rows.</p>

<p>Modify all rows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c0 INT, c1 INT);
INSERT INTO t VALUES (1, 1), (2, 4), (3, 9);
UPDATE t SET c1=c1+1;
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    2
2    5
3    10
</code></pre></div></div>

<p>Select certain rows to update with <code class="highlighter-rouge">WHERE</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c0 INT, c1 INT);
INSERT INTO t VALUES (1, 1), (2, 4), (3, 9);
UPDATE t SET c1=c1+1 WHERE c0&lt;3;
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    2
2    5
3    9
</code></pre></div></div>

<h3 id="select-for-update">SELECT FOR UPDATE</h3>

<p>TODO looks like a synchronization mechanism.</p>

<h3 id="delete">DELETE</h3>

<p>Delete selected rows.</p>

<p>Delete all rows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c0 INT, c1 INT);
INSERT INTO t VALUES (1, 1), (2, 4), (3, 9);
DELETE FROM t;
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>outputs nothing.</p>

<p>Delete selected rows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c0 INT, c1 INT);
INSERT INTO t VALUES (1, 1), (2, 4), (3, 9);
DELETE FROM t WHERE c0=3;
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    1
2    4
</code></pre></div></div>

<h3 id="truncate">TRUNCATE</h3>

<p>Removes all entries from a table:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TRUNCATE TABLE table_name;
</code></pre></div></div>

<p>Similar to <code class="highlighter-rouge">DELETE FROM table_name</code>, but with some subtle differences, in particular a possible performance gain, since <code class="highlighter-rouge">TRUNCATE</code> actually drops and recreates the table.</p>

<h3 id="union">UNION</h3>

<p>Unite the resulting rows of two queries.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t0 (c0 INT);
INSERT INTO t0 VALUES (0), (2);
CREATE TABLE t1 (c1 INT);
INSERT INTO t1 VALUES (1), (3);
SELECT c0 FROM t0
    UNION
    SELECT c1 FROM t1
    ORDER BY c0;
DROP TABLE t0, t1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c0
0
1
2
3
</code></pre></div></div>

<p>The column is named after the first column. This name can be changed with <code class="highlighter-rouge">AS</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t0 (c0 INT);
CREATE TABLE t1 (c1 INT);
INSERT INTO t0 VALUES (0), (2);
INSERT INTO t1 VALUES (1), (3);
SELECT c0 AS c FROM t0
    UNION
    SELECT c1 FROM t1
    ORDER BY c;
DROP TABLE t0, t1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c
0
1
2
3
</code></pre></div></div>

<p>Both selects must have the same number of columns or an error is generated:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t0 (c0 INT);
CREATE TABLE t1 (c1 INT);
INSERT INTO t0 VALUES (0), (2);
INSERT INTO t1 VALUES (1), (3);
# Ok:
SELECT c0, c0 AS c0_2 FROM t0
    UNION
    SELECT c1, c1 + 10 FROM t1;
# ERROR:
SELECT c0, c0 AS c FROM t0
    UNION
    SELECT c1 FROM t1;
DROP TABLE t0, t1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c0  c0_2
0   0
2   2
1   11
3   13

ERROR 1222 (21000): The used SELECT statements have a different number of columns
</code></pre></div></div>

<p>Duplicates are omitted:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t0 (c0 INT);
CREATE TABLE t1 (c1 INT);
INSERT INTO t0 VALUES (0), (1);
INSERT INTO t1 VALUES (1), (2);
SELECT c0, c0+1 AS `c0+1` FROM t0
    UNION
    SELECT c1, c1+1 FROM t1
    ORDER BY c0, `c0+1`;
DROP TABLE t0, t1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c0   c0+1
0    1
1    2
2    3
</code></pre></div></div>

<p>Duplicates are <em>not</em> omitted if at least one of the values differ:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t0 (c0 INT);
CREATE TABLE t1 (c1 INT);
INSERT INTO t0 VALUES (0), (1);
INSERT INTO t1 VALUES (1), (2);
SELECT c0, c0+1 AS `c0+1` FROM t0
    UNION
    SELECT c1, c1+10 FROM t1
    ORDER BY c0, `c0+1`;
DROP TABLE t0, t1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c0   c0+1
0    1
1    2
1    11
2    12
</code></pre></div></div>

<p>To consider duplicates, use <code class="highlighter-rouge">UNION ALL</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t0 (c0 INT);
CREATE TABLE t1 (c1 INT);
INSERT INTO t0 VALUES (0), (1);
INSERT INTO t1 VALUES (1), (2);
SELECT c0 FROM t0
    UNION ALL
    SELECT c1 FROM t1
    ORDER BY c0;
DROP TABLE t0, t1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c0
0
1
1
2
</code></pre></div></div>

<p>TODO what happens if types don’t match?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t0 (c0 INT);
CREATE TABLE t1 (c1 CHAR(2));
INSERT INTO t0 VALUES (0), (1);
INSERT INTO t1 VALUES ('ab'), ('cd');
SELECT c0 FROM t0
    UNION
    SELECT c1 FROM t1;
DROP TABLE t0, t1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c0
0
1
ab
cd
</code></pre></div></div>

<h2 id="variables">Variables</h2>

<h3 id="ssv">SSV</h3>

<h3 id="server-system-variables">Server system variables</h3>

<p>Variables that affect the operation of the server.</p>

<h4 id="show-variables">SHOW VARIABLES</h4>

<p>List variables and their values.</p>

<p>List all current SSVs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW VARIABLES;
</code></pre></div></div>

<p>List all current SSVs that match a given MySQL regexp:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW VARIABLES LIKE "%version%";
</code></pre></div></div>

<p>Filter SSVs by any method accepted by <code class="highlighter-rouge">WHERE</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHOW VARIABLES WHERE Variable_name LIKE "%version%";
</code></pre></div></div>

<p><code class="highlighter-rouge">WHERE</code> operates on a table of type:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Variable_name    Value
</code></pre></div></div>

<p>This method is more general and verbose than using <code class="highlighter-rouge">LIKE</code>.</p>

<h4 id="set-variables">SET variables</h4>

<p>The <code class="highlighter-rouge">SET</code> command may be used to set the values of variables.</p>

<p>Note that <code class="highlighter-rouge">SET</code> can also appear on other contexts such as <code class="highlighter-rouge">SET PASSWORD</code>, which have no relation to variables.</p>

<h4 id="variable-types">Variable types</h4>

<p>Table of all server system variables: <a href="http://dev.mysql.com/doc/refman/4.1/en/server-system-variables.html">http://dev.mysql.com/doc/refman/4.1/en/server-system-variables.html</a></p>

<p>On that tables, variables have different properties:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">Cmd-Line</code>: variable can be set from command line when starting <code class="highlighter-rouge">mysqld</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">Option file</code>: variable can be set from a configuration file</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">System Var</code>: TODO</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">Var Scope</code>: Session, global or both.</p>

    <p>Each variable can have one or two versions:</p>

    <ul>
      <li>
        <p>session: a version of the variable which affect the current session only.</p>

        <p>Those variables can be accessed and modified via <code class="highlighter-rouge">SHOW VARIABLES</code> and <code class="highlighter-rouge">SET</code>.</p>
      </li>
      <li>
        <p>global:  a version of the variable that is the same across the server.</p>

        <p>Those variables can be accessed and modified via <code class="highlighter-rouge">SHOW GLOBAL VARIABLES</code> and <code class="highlighter-rouge">SET GLOBAL</code>.</p>

        <p>Since those variables affect the behavior of the entire server, modifying them requires the <code class="highlighter-rouge">super</code> privilege, and they are intended to modify server operation without restarting it.</p>
      </li>
    </ul>

    <p>Some variables can exist in both global and session versions.</p>

    <p>The session version takes precedence over the global version.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">Dynamic</code>: If yes, the variables can be modified at runtime and take effect immediately.</p>

    <p>Attempting to modify non-dynamic variables results in an error. Example:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set proxy_user := 'asdf';
</code></pre></div>    </div>
  </li>
</ul>

<p>Variables that control the server configuration.</p>

<p>Those variables are set at startup depending on how <code class="highlighter-rouge">mysqld</code> is compiled and configured, but from 4.0.3 onwards they can also be modified without restarting the server via <code class="highlighter-rouge">SET</code> commands.</p>

<p>List <code class="highlighter-rouge">mysqld</code> variables and values after reading the configuration files:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqld --verbose --help
</code></pre></div></div>

<h3 id="variables-1">Variables</h3>

<h3 id="user-variables">User variables</h3>

<h3 id="user-defined-variable">User defined variable</h3>

<p>User defined variables are variables defined by clients on the server, which last only until the end of the current session.</p>

<p>User defined variables must be prefixed by the at sign <code class="highlighter-rouge">@</code>.</p>

<p>A user defined variable can be defined either via a <code class="highlighter-rouge">SET</code> command or inside another commands.</p>

<p>Both <code class="highlighter-rouge">:=</code> and <code class="highlighter-rouge">=</code> are equivalent if <code class="highlighter-rouge">SET</code> is used. In other cases, such in a <code class="highlighter-rouge">SELECT</code>, <code class="highlighter-rouge">:=</code> is mandatory.</p>

<p>User defined variables can be used anywhere other literals could.</p>

<p>Initialize user variables with set:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT @v1, @v2;
SET @v1 := 1, @v2 = 2;
SELECT @v1, @v2;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@v1  @v2
1    2
</code></pre></div></div>

<p>Initialize user variables inside a <code class="highlighter-rouge">SELECT</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SET @v1 := 1, @v2 = 2;
SELECT @v1 := 2, @v2 = 2;
SELECT @v1, @v2;
SELECT @v1 := 1, @v1 + 1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@v1 := 2    @v2 = 2
2           1

@v1  @v2
2    2

@v1 := 1  @v1 + 1
1         2
</code></pre></div></div>

<p>Note how <code class="highlighter-rouge">SELECT @v1 := 2, @v2 = 2;</code> only changes the value of <code class="highlighter-rouge">@v1</code>, while all that the second part of the statement does is to compare <code class="highlighter-rouge">@v2</code> to <code class="highlighter-rouge">2</code>.</p>

<p>Assign user variables in <code class="highlighter-rouge">SELECT</code> from an aggregate function:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c INT);
INSERT INTO t VALUES (0), (1), (2);
SELECT @max := MAX(c) FROM t;
SELECT @max;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@max := MAX(c)
2

@max
2
</code></pre></div></div>

<p>Assign user variables in <code class="highlighter-rouge">SELECT</code> from non-aggregate function. Only the last value stays at the end.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c INT);
INSERT INTO t VALUES (0), (2), (1);
SELECT @v := c FROM t;
SELECT @v;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@v
1
</code></pre></div></div>

<p>because <code class="highlighter-rouge">1</code> was the last value.</p>

<p>It is likely that you will only want to do this kind of operation if you are sure that there is only a single <code class="highlighter-rouge">SELECT</code> output row, either because of a <code class="highlighter-rouge">WHERE unique_col = val</code> or <code class="highlighter-rouge">LIMIT 1</code>.</p>

<p>Assign multiple variables at once:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c INT);
INSERT INTO t VALUES (0), (1), (2);
SELECT @max := MAX(c), @min := MIN(c) FROM t;
SELECT @max;
DROP TABLE t;
</code></pre></div></div>

<h2 id="functions-and-operators">Functions and operators</h2>

<p>Be aware that the presence of <code class="highlighter-rouge">NULL</code> can create many exceptions on the expected behavior of functions.</p>

<h3 id="arithmetic-operators">Arithmetic operators</h3>

<p>Basically C like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 1 + 1;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2
</code></pre></div></div>

<p>In MySQL, integer division generates floats:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 1 / 2;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.5
</code></pre></div></div>

<p>Not true for T-SQL, which requires a <code class="highlighter-rouge">CAST(col AS float)</code>: <a href="http://stackoverflow.com/questions/11719044/how-to-get-a-float-result-by-dividing-two-integer-values">http://stackoverflow.com/questions/11719044/how-to-get-a-float-result-by-dividing-two-integer-values</a> <code class="highlighter-rouge">CAST</code> exists in MySQL but seems to different operations.</p>

<h3 id="in">IN</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 0 IN(0, 2);
SELECT 1 IN(0, 2);
SELECT 2 IN(0, 2);
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
0
1
</code></pre></div></div>

<h3 id="between">BETWEEN</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 0 BETWEEN 0 AND 2;
SELECT 1 BETWEEN 0 AND 2;
SELECT 2 BETWEEN 0 AND 2;
SELECT 3 BETWEEN 0 AND 2;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
1
1
0
</code></pre></div></div>

<h3 id="like">LIKE</h3>

<p><a href="http://dev.mysql.com/doc/refman/5.0/en/string-comparison-functions.html#operator_like">http://dev.mysql.com/doc/refman/5.0/en/string-comparison-functions.html#operator_like</a></p>

<p>Regex subset:</p>

<ul>
  <li><code class="highlighter-rouge">%</code> is Perl <code class="highlighter-rouge">.*</code></li>
  <li><code class="highlighter-rouge">_</code> is Perl <code class="highlighter-rouge">.</code></li>
</ul>

<p><code class="highlighter-rouge">\%</code> and <code class="highlighter-rouge">\_</code> escape.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 'a'    LIKE 'ab';
SELECT 'ac'   LIKE 'a%c';
SELECT 'abc'  LIKE 'a%c';
SELECT 'abbc' LIKE 'a%c';
SELECT 'ac'   LIKE 'a_c';
SELECT 'abc'  LIKE 'a_c';
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
1
1
1
0
1
</code></pre></div></div>

<p>Case insensitive.</p>

<h3 id="newlines-1">Newlines</h3>

<h3 id="backslash-escapes">Backslash escapes</h3>

<p>TODO: possible?</p>

<h3 id="regexp">REGEXP</h3>

<p>Similar to <code class="highlighter-rouge">LIKE</code> but uses Perl-like regexps, so it is strictly more powerful.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 'a'   REGEXP 'ab';
SELECT 'abc' REGEXP '^a.(c|d)$';
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
1
</code></pre></div></div>

<h3 id="replace">REPLACE</h3>

<p>Replace literals in strings.</p>

<p>Not possible with regex: <a href="http://stackoverflow.com/questions/986826/how-to-do-a-regular-expression-replace-in-mysql">http://stackoverflow.com/questions/986826/how-to-do-a-regular-expression-replace-in-mysql</a></p>

<p>Sometimes possible with <code class="highlighter-rouge">INSTR</code> + <code class="highlighter-rouge">SUBSTRING</code> + <code class="highlighter-rouge">SUBSTRING_INDEX</code>: <a href="http://stackoverflow.com/questions/11114638/mysql-need-to-cut-a-part-of-a-string">http://stackoverflow.com/questions/11114638/mysql-need-to-cut-a-part-of-a-string</a></p>

<h3 id="reverse">REVERSE</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT REVERSE('abcd');
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcba
</code></pre></div></div>

<h3 id="soundex">SOUNDEX</h3>

<p><a href="http://en.wikipedia.org/wiki/Soundex">http://en.wikipedia.org/wiki/Soundex</a></p>

<p>English words to similar sounds representation.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT SOUNDEX('Robert');
SELECT SOUNDEX('Rupert');
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>R163
R163
</code></pre></div></div>

<h3 id="sounds-like">SOUNDS LIKE</h3>

<p>Compare <code class="highlighter-rouge">SOUNDEX</code> of two strings:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT 'Robert' SOUNDS LIKE 'Rupert';
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
</code></pre></div></div>

<h3 id="greatest">GREATEST</h3>

<p><a href="http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#function_greatest">http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#function_greatest</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT GREATEST(1, 2);
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2
</code></pre></div></div>

<p>Not in T-SQL.</p>

<h3 id="control-flow-functions">Control flow functions</h3>

<h4 id="if">IF</h4>

<p><a href="http://dev.mysql.com/doc/refman/5.1/en/control-flow-functions.html#function_if">http://dev.mysql.com/doc/refman/5.1/en/control-flow-functions.html#function_if</a></p>

<p>Note that this is a function: there is also an <code class="highlighter-rouge">IF</code> statement.</p>

<p>Ternary if:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT IF(TRUE, 0, 1);
SELECT IF(FALSE, 0, 1);
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
1
</code></pre></div></div>

<h4 id="iff">IFF</h4>

<p><code class="highlighter-rouge">IF</code> function in T-SQL.</p>

<h3 id="aggregate-functions">Aggregate functions</h3>

<p>Aggregate functions are function that operate on entire (subquery) columns instead of individual values.</p>

<h4 id="max">MAX</h4>

<p>Maximum value of a column.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c0 INT, c1 INT);
INSERT INTO t VALUES (1, 9), (2, 4), (3, 1);
SELECT MAX(c0) FROM t;
SELECT MAX(c1) FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3
9
</code></pre></div></div>

<h4 id="avg">AVG</h4>

<p>Average value of a column.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (c0 INT, c1 INT);
INSERT INTO t VALUES (1, 1), (2, 4), (3, 9);
SELECT AVG(c0) FROM t;
SELECT AVG(c1) FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2.0000
4.6667
</code></pre></div></div>

<h5 id="find-the-most-frequent-value">Find the most frequent value</h5>

<ul>
  <li><a href="http://stackoverflow.com/questions/12235595/find-most-frequent-value-in-sql-column">http://stackoverflow.com/questions/12235595/find-most-frequent-value-in-sql-column</a></li>
  <li><a href="http://stackoverflow.com/questions/344665/get-most-common-value-in-sql">http://stackoverflow.com/questions/344665/get-most-common-value-in-sql</a></li>
</ul>

<h5 id="count-how-many-distinct-values-are-there-for-a-row">Count how many distinct values are there for a row</h5>

<p><a href="http://stackoverflow.com/questions/16697215/mysql-count-number-of-unique-values">http://stackoverflow.com/questions/16697215/mysql-count-number-of-unique-values</a></p>

<h3 id="view">VIEW</h3>

<p>A view is simply pre prepared SQL query that is run whenever the view name is used.</p>

<p>It is intended to look like a table in some respects, for example it occupies the same namespace as tables.</p>

<p>It is <em>not</em> a temporary table: the query is done every time the view is used.</p>

<p>Views are useful to factor out code much like functions do, except views cannot take arguments.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t(c INT);
INSERT INTO t VALUES (0), (1), (2);
CREATE VIEW v AS SELECT * FROM t WHERE c &gt; 0;
# Exact same:
SELECT * FROM ( SELECT * FROM t WHERE c &gt; 0 ) AS v;
SELECT * FROM v;
DROP TABLE t;
DROP VIEW v;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c
1
2

c
1
2
</code></pre></div></div>

<p>The line:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * FROM v;
</code></pre></div></div>

<p>is exactly the same as doing:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * FROM ( SELECT * FROM t WHERE c &gt; 0 ) AS v;
</code></pre></div></div>

<p>It is not possible to name a view as an existing table:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t(c INT);
# Error
CREATE VIEW t AS SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Views show in <code class="highlighter-rouge">SHOW TABLES</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t(c INT);
CREATE VIEW v AS SELECT * FROM t;
SHOW TABLES;
DROP TABLE t;
DROP VIEW v;
</code></pre></div></div>

<p>the output should contain <code class="highlighter-rouge">v</code> and <code class="highlighter-rouge">t</code></p>

<p>Views cannot be deleted with <code class="highlighter-rouge">DROP TABLE</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t(c INT);
CREATE VIEW v AS SELECT * FROM t;
DROP TABLE t;
# ERROR:
DROP TABLE v;
DROP VIEW v;
</code></pre></div></div>

<h2 id="delimiter">DELIMITER</h2>

<p>By default the semicolon <code class="highlighter-rouge">;</code> is used to separate different commands.</p>

<p>It is possible to change this to any string.</p>

<p>The following example changes the delimiter to <code class="highlighter-rouge">a bé</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DELIMITER 'a bé'
SELECT 'a' a bé
DELIMITER ;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a
a
</code></pre></div></div>

<p>Note that the <code class="highlighter-rouge">DELIMITER</code> command does not need to be delimited by any delimiter.</p>

<p>Delimiter changing can be useful when defining functions or triggers when we want the delimiter sequence <code class="highlighter-rouge">;</code> to appear in the middle of the function.</p>

<p>It is common practice to change the delimiter to <code class="highlighter-rouge">$$</code> in those cases, and restore it immediately after the function definition.</p>

<h2 id="user-defined-functions">User defined functions</h2>

<p>TODO</p>

<h2 id="triggers">Triggers</h2>

<p>Triggers are like user defined functions that happen automatically before or after a row is <code class="highlighter-rouge">INSERTED</code>, <code class="highlighter-rouge">UPDATED</code> or <code class="highlighter-rouge">DELETED</code>.</p>

<p>One advantage of triggers is that they require less query transfer to the server. Triggers could be replaced by consistent use of an API that does the two operations, but that API has to transfer two commands to the server every time.</p>

<p>Good tutorial on triggers: <a href="http://net.tutsplus.com/tutorials/databases/introduction-to-mysql-triggers/">http://net.tutsplus.com/tutorials/databases/introduction-to-mysql-triggers/</a></p>

<p>TODO</p>

<h2 id="database-file-format">Database file format</h2>

<p>MySQL allows to use the file format exemplified in <code class="highlighter-rouge">./tbl.txt</code> to represent tables.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t (i INT, v VARCHAR(4), d DATE);
LOAD DATA LOCAL INFILE './tbl.txt' INTO TABLE t;
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>This may fail if MySQL is not configured to allow access to local files.</p>

<p>Note how:</p>

<ul>
  <li><code class="highlighter-rouge">\N</code>: represents <code class="highlighter-rouge">NULL</code>.</li>
  <li><code class="highlighter-rouge">\n</code>: and other escapes are interpreted as a newlines.</li>
  <li><code class="highlighter-rouge">\\</code>: must be escaped to be a newline.</li>
</ul>

<h2 id="explain">EXPLAIN</h2>

<p>Show internal information on how the query will be carried out after it has been optimized.</p>

<p>Useful to help the optimizer optimize queries.</p>

<h2 id="acid">ACID</h2>

<p>Four properties that describe how databases deal with messy situations like power-offs and concurrent access.</p>

<p>The following are ACID related MySQL features.</p>

<p><a href="http://stackoverflow.com/questions/21584207/are-mysql-queries-atomic">http://stackoverflow.com/questions/21584207/are-mysql-queries-atomic</a></p>

<h3 id="atomicity">Atomicity</h3>

<p><code class="highlighter-rouge">UPDATE</code>: <a href="http://stackoverflow.com/questions/3821468/sql-atomic-increment-and-locking-strategies-is-this-safe">http://stackoverflow.com/questions/3821468/sql-atomic-increment-and-locking-strategies-is-this-safe</a></p>

<h3 id="transaction">Transaction</h3>

<p>Sometimes many queries are part of a single logical step, and if one of the queries fails, then what we want to do is to go back to the state before the initial step. This is the function of transaction commands.</p>

<p>Only certain engines support transactions. To find out which, use <code class="highlighter-rouge">SHOW ENGINES</code>; As of MySQL 5.5 the only engine that supports transactions is InnoDB.</p>

<h4 id="autocommit">autocommit</h4>

<p>The <code class="highlighter-rouge">autocommit</code> server system variable determines if each command is committed immediately or not.</p>

<p>By default it is usually <code class="highlighter-rouge">TRUE</code>.</p>

<p>After a transaction starts with <code class="highlighter-rouge">START TRANSACTION</code>, it is automatically set to <code class="highlighter-rouge">FALSE</code>, and when a transaction ends it assumes the value before the <code class="highlighter-rouge">START TRANSACTION</code> command.</p>

<p>Therefore, there is normally no need to set it explicitly.</p>

<p>TODO what is the difference between <code class="highlighter-rouge">SET autocommit = TRUE</code> and <code class="highlighter-rouge">START TRANSACTION</code>?</p>

<hr />

<p>After a <code class="highlighter-rouge">START TRANSACTION</code>, changes are not saved immediately to disk. This only happens in case a <code class="highlighter-rouge">COMMIT</code> is issued on the same session.</p>

<p>Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t(c INT) ENGINE=InnoDB;
SHOW VARIABLES LIKE 'autocommit';
INSERT INTO t VALUES (0);
SELECT * FROM t;
START TRANSACTION;
SHOW VARIABLES LIKE 'autocommit';
INSERT INTO t VALUES (1);
SELECT * FROM t;
COMMIT;
SHOW VARIABLES LIKE 'autocommit';
START TRANSACTION;
INSERT INTO t VALUES (2);
ROLLBACK;
SELECT * FROM t;
DROP TABLE t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Variable_name   Value
autocommit      ON

c
0

Variable_name   Value
autocommit      ON

c
0
1

Variable_name   Value
autocommit      ON

c
0
1
</code></pre></div></div>

<p>Note that:</p>

<ul>
  <li>
    <p>the <code class="highlighter-rouge">SELECT</code> before the <code class="highlighter-rouge">COMMIT</code> already shows the updated data.</p>

    <p>This does not however mean that the data has been saved to disk, only that <code class="highlighter-rouge">SELECT</code> looks at the updated version.</p>

    <p>To see that, try:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t(c INT) ENGINE=InnoDB;
START TRANSACTION;
INSERT INTO t VALUES (0);
EXIT;
</code></pre></div>    </div>

    <p>Then:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>COMMIT;
SELECT * FROM t;
DROP TABLE t;
</code></pre></div>    </div>

    <p>And the output is empty.</p>

    <p>The <code class="highlighter-rouge">COMMIT</code> does nothing, since it only has effect if it is done on the same session as the <code class="highlighter-rouge">START TRANSACTION</code>.</p>
  </li>
</ul>

<p>TODO why does <code class="highlighter-rouge">autocommit</code> never change?</p>

<h3 id="locks">Locks</h3>

<p>Synchronization method when multiple session attempt to access a single table.</p>

<p>To prevent other sessions from using a table, one session acquires certain locks, and while those are acquired other session cannot do anything.</p>

<p>If a lock is owned by another session, the blocked session waits until the lock is freed.</p>

<p>There are two types of locks:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">READ</code>: the locking session is only going to do <code class="highlighter-rouge">READ</code> operations.</p>

    <p>Therefore it is OK for other threads to do parallel read operations, but not read operations.</p>

    <p>The thread that has the <code class="highlighter-rouge">READ</code> lock cannot do write operations, as this would modify what is seen by other sessions.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">WRITE</code>: the locking session is only going to do both <code class="highlighter-rouge">READ</code> and <code class="highlighter-rouge">WRITE</code> operations.</p>

    <p>Other sessions can neither read nor write to the table.</p>
  </li>
</ul>

<p>On session 0:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE t(c INT);
INSERT INTO t VALUES (0);
LOCK TABLES t READ;
SELECT * FROM t;
INSERT INTO t VALUES (0);
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c
0

ERROR 1099 (HY000): Table 't' was locked with a READ lock and can't be updated
</code></pre></div></div>

<p>On session 1;</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * FROM t;
INSERT INTO t VALUES (1);
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c
0
</code></pre></div></div>

<p>Session 1 hangs on the <code class="highlighter-rouge">INSERT</code>.</p>

<p>On session 0:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * FROM t;
UNLOCK TABLES;
SELECT * FROM t;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c
0

c
0
1
</code></pre></div></div>

<p>and session one is active again.</p>

<h2 id="prepared-statements">Prepared statements</h2>

<p>Before MySQL 5.0, <code class="highlighter-rouge">?</code> meant nothing to MySQL, only to several external interfaces such as PHP stdlib and web frameworks, in which the feature is commonly known as a “prepared statement”.</p>

<p>Starting from MySQL 5.0, it is also possible to use prepared statements directly inside MySQL as described <a href="http://dev.mysql.com/doc/refman/5.0/en/sql-syntax-prepared-statements.html">in the docs</a>.</p>

<p>Example from the docs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PREPARE stmt1 FROM 'SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse';
SET @a = 3;
SET @b = 4;
EXECUTE stmt1 USING @a, @b;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hypotenuse
5
</code></pre></div></div>

<h2 id="master-slave-replication">Master slave replication</h2>

<p>Backup the database to a second identical one as queries are being made.</p>

<p>Useful to make backups of the database, possibly to safely do processing operations while on in a sandboxed mode.</p>

<ul>
  <li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-master-slave-replication-in-mysql">https://www.digitalocean.com/community/tutorials/how-to-set-up-master-slave-replication-in-mysql</a></li>
</ul>

<h2 id="recipes">Recipes</h2>

<h3 id="levenshtein-distance">Levenshtein distance</h3>

<p>No built-in way.</p>

<p>An implementation: <a href="http://openquery.com.au/blog/levenshtein-mysql-stored-function">http://openquery.com.au/blog/levenshtein-mysql-stored-function</a></p>

<h3 id="associations">Associations</h3>

<p>This section is not about MySQL itself, but common multi-table design patterns using MySQL.</p>

<h4 id="many-to-many">Many to many</h4>

<p>Many to many get all pairs can be done in two ways, either with <code class="highlighter-rouge">WHERE</code> (delta style) or <code class="highlighter-rouge">JOIN</code> (ANSI style).</p>

<p>It seems that the (ANSI) style is preferred for clarity, and both are usually as fast:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE medics       (id INT, name VARCHAR(16));
CREATE TABLE patients     (id INT, name VARCHAR(16));
CREATE TABLE appointments (medic_id INT, patient_id INT);
INSERT INTO medics       VALUES (1, 'm1'), (2, 'm2'), (3, 'p3');
INSERT INTO patients     VALUES (1, 'p1'), (2, 'p2');
INSERT INTO appointments VALUES (1, 1), (1, 2), (2, 1);
# WHERE version:
SELECT medics.name AS `medics.name`, patients.name AS `patients.name`
    FROM medics, patients, appointments
    WHERE   medics.id   = appointments.medic_id
        AND patients.id = appointments.patient_id
    ORDER BY medics.name, patients.name;
# JOIN version:
SELECT medics.name AS `medics.name`, patients.name AS `patients.name`
    FROM medics
    INNER JOIN appointments ON appointments.medic_id = medics.id
    INNER JOIN patients     ON patients.id           = appointments.patient_id
    ORDER BY medics.name, patients.name;
DROP TABLE medics, patients, appointments;
</code></pre></div></div>

<p>Output of both:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>medics.name  patients.name
m1           p1
m1           p2
m2           p1
</code></pre></div></div>

<h4 id="many-to-one-two-levels-deep">Many to one two levels deep</h4>

<p>Many to one 2 levels deep all pairs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE countrys (id INT,                 name VARCHAR(16));
CREATE TABLE states   (id INT, country_id INT, name VARCHAR(16));
CREATE TABLE citys    (id INT, state_id   INT, name VARCHAR(16));
INSERT INTO countrys VALUES (1, 'a'), (2, 'b'), (3, 'c');
INSERT INTO states   VALUES (1, 1, 'aa'), (2, 1, 'ab'), (3, 2, 'ba');
INSERT INTO citys    VALUES (1, 1, 'aaa'), (2, 1, 'aab'), (3, 3, 'baa');
SELECT countrys.name AS `countrys.name`, citys.name AS `citys.name`
    FROM countrys
    INNER JOIN states ON states.country_id = countrys.id
    INNER JOIN citys  ON citys.state_id    = states.id
    ORDER BY countrys.name, citys.name;
DROP TABLE countrys, states, citys;
</code></pre></div></div>

<p>Output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>countrys.name    citys.name
a                aaa
a                aab
b                baa
</code></pre></div></div>

<h2 id="protocol">Protocol</h2>

<p><a href="http://dev.mysql.com/doc/internals/en/client-server-protocol.html">http://dev.mysql.com/doc/internals/en/client-server-protocol.html</a></p>

<p>TODO. Possible from Netcat? :)</p>

<h2 id="internals">Internals</h2>

<p><a href="http://dev.mysql.com/doc/internals/en/index.html">http://dev.mysql.com/doc/internals/en/index.html</a></p>

<p>Source:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/mysql/mysql-server.git
</code></pre></div></div>

<p>Coded half in C++, half in C.</p>

<h2 id="rank-output">Rank output</h2>

<ul>
  <li><a href="http://stackoverflow.com/questions/1895110/row-number-in-mysql">http://stackoverflow.com/questions/1895110/row-number-in-mysql</a></li>
  <li><a href="http://stackoverflow.com/questions/2520357/mysql-get-row-number-on-select">http://stackoverflow.com/questions/2520357/mysql-get-row-number-on-select</a></li>
  <li><a href="http://dba.stackexchange.com/questions/13703/get-the-rank-of-a-user-in-a-score-table">http://dba.stackexchange.com/questions/13703/get-the-rank-of-a-user-in-a-score-table</a></li>
  <li><a href="http://stackoverflow.com/questions/431053/what-is-the-best-way-to-generate-ranks-in-mysql">http://stackoverflow.com/questions/431053/what-is-the-best-way-to-generate-ranks-in-mysql</a></li>
</ul>

<p>Variables seem to be the only way. In tsql, it’s harder:</p>

<h2 id="sources">Sources</h2>

<ul>
  <li>
    <p><a href="http://dev.mysql.com/doc/">http://dev.mysql.com/doc/</a></p>

    <p>The official docs.</p>

    <p>The official tutorial is too short and incomplete.</p>

    <p>The documentation in general is very good.</p>
  </li>
  <li>
    <p><a href="http://www.tutorialspoint.com/mysql/index.htm">http://www.tutorialspoint.com/mysql/index.htm</a></p>

    <p>Quite complete tutorial. Also suitable for beginners.</p>
  </li>
  <li>
    <p><a href="http://www.w3schools.com/sql/">http://www.w3schools.com/sql/</a></p>

    <p>A bit too simple, but good to start with.</p>
  </li>
  <li>
    <p><a href="http://www.pantz.org/software/mysql/mysqlcommands.html">http://www.pantz.org/software/mysql/mysqlcommands.html</a></p>

    <p>Good way to get started.</p>
  </li>
</ul>

        </main>
      </div>
      <footer>
        <p>Content licence: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> unless otherwise noted on the article.</p>
        <p>Website powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a> and <a href="https://pages.github.com/">GitHub Pages</a>. Source at: <a href="https://github.com/cirosantilli/db">https://github.com/cirosantilli/db</a></p>
        <p>To contact me publicly about any general subject, including saying hi or suggestions about this website, please <a href="https://github.com/cirosantilli/db/issues/new">create a GitHub issue in the cirosantilli.github.io repo</a>.</p>
        <p>
          For comments about China, please first read
          <a href="https://github.com/cirosantilli/china-dictatorship#faq">the FAQ</a> and
          <a href="https://github.com/cirosantilli/china-dictatorship/blob/master/CONTRIBUTING.md">the CONTRIBUTING</a> and then
          <a href="https://github.com/cirosantilli/china-dictatorship/issues/new">create a GitHub issue in the china-dictatorship repo</a>.
        </p>
        <p>If you absolutely need private contact, extract my email from my GitHub repos or use LinkedIn.</p>
        <p>
          <a href="https://en.wikipedia.org/wiki/Disqus">Disqus comments</a> were removed from this website in 2019-05-04,
          a manual dump is <a href="/disqus-archive/">available here</a>.
          <a href="https://github.com/cirosantilli/cirosantilli.github.io/tree/fee98be02a34d5d4ccf829c4df89f1a5140881fc#why-i-removed-disqus-comments-from-the-website-in-2019-05-04">Rationale</a>.
        </p>
        <p>Opinions and content are my own, not my employer's.</p>
      </footer>
        
    </div>
    <!-- Scripts -->
      <!--data table-->
        <script src="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js" ></script>
        <script>
          $('.data-table').dataTable({
            //"aaSorting": [[0,'asc'], [1,'asc'], [2, 'asc'], [3, 'asc']],
            "aaSorting": [],
            "bFilter": false,
            "bInfo": false,
            "bPaginate": false
          });
        </script>
      <!--mathjax-->
        <script
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
        ></script>
        <script>
          MathJax.Hub.Config({
              jax: ["input/TeX","output/HTML-CSS"],
              displayAlign: "left",
              displayIndent: "20px"
          });
        </script>
      <!--google analytics-->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-47867706-1', 'auto');
          ga('require', 'displayfeatures');
          ga('send', 'pageview');

        </script>
  </body>
</html>
